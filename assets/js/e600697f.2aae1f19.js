"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[9422],{69292:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var s=t(74848),i=t(28453),a=t(78924);const r={title:"Moodle 4.4 developer update",tags:["Core development","Moodle 4.4"]},o=void 0,l={id:"devupdate",title:"Moodle 4.4 developer update",description:"This page highlights the important changes that are coming in Moodle 4.4 for developers.",source:"@site/docs/devupdate.md",sourceDirName:".",slug:"/devupdate",permalink:"/moodledevdocs/docs/4.4/devupdate",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/docs/devupdate.md",tags:[{label:"Core development",permalink:"/moodledevdocs/docs/4.4/tags/core-development"},{label:"Moodle 4.4",permalink:"/moodledevdocs/docs/4.4/tags/moodle-4-4"}],version:"current",lastUpdatedBy:"Andrew Lyons",lastUpdatedAt:1713800034e3,frontMatter:{title:"Moodle 4.4 developer update",tags:["Core development","Moodle 4.4"]},sidebar:"docs",previous:{title:"xAPI (Experience API)",permalink:"/moodledevdocs/docs/4.4/apis/subsystems/xapi/"}},c={},d=[{value:"Core changes",id:"core-changes",level:2},{value:"Dependency Injection",id:"dependency-injection",level:3},{value:"Attributes",id:"attributes",level:3},{value:"Hooks",id:"hooks",level:3},{value:"Hook interfaces",id:"hook-interfaces",level:4},{value:"Callable notation",id:"callable-notation",level:4},{value:"String formatting",id:"string-formatting",level:3},{value:"Deprecation of format_* parameters",id:"deprecation-of-format_-parameters",level:4},{value:"New \\core\\formatting class",id:"new-coreformatting-class",level:4},{value:"Tasks API",id:"tasks-api",level:3},{value:"JavaScript",id:"javascript",level:3},{value:"Parameters",id:"parameters",level:2},{value:"API Change",id:"api-change",level:3},{value:"Deprecations",id:"deprecations",level:3},{value:"Introduction of <code>deprecated</code> attribute",id:"introduction-of-deprecated-attribute",level:2},{value:"Clock interface",id:"clock-interface",level:3},{value:"Enrolment",id:"enrolment",level:2},{value:"Meta enrolment support in CSV course upload",id:"meta-enrolment-support-in-csv-course-upload",level:3},{value:"Support for multiple instances in csv course upload",id:"support-for-multiple-instances-in-csv-course-upload",level:3},{value:"Refactoring BS4 features dropped in BS5",id:"refactoring-bs4-features-dropped-in-bs5",level:2},{value:"New course section page",id:"new-course-section-page",level:2},{value:"Activity icons",id:"activity-icons",level:2},{value:"New designs",id:"new-designs",level:3},{value:"Activity purposes",id:"activity-purposes",level:3},{value:"Branded icons",id:"branded-icons",level:3},{value:"PHPUnit 9.6 update",id:"phpunit-96-update",level:2},{value:"Intention",id:"intention",level:3},{value:"Deprecated stuff",id:"deprecated-stuff",level:3},{value:"Developer metadata",id:"developer-metadata",level:2},{value:"Previous versions",id:"previous-versions",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{Details:o,InvalidExample:c,Since:d,TabItem:h,Tabs:p,ValidExample:m}=n;return o||u("Details",!0),c||u("InvalidExample",!0),d||u("Since",!0),h||u("TabItem",!0),p||u("Tabs",!0),m||u("ValidExample",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.A,{frontMatter:r,metadata:l}),"\n",(0,s.jsx)(n.p,{children:"This page highlights the important changes that are coming in Moodle 4.4 for developers."}),"\n",(0,s.jsx)(n.h2,{id:"core-changes",children:"Core changes"}),"\n",(0,s.jsx)(n.h3,{id:"dependency-injection",children:"Dependency Injection"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-80072"}),"\n",(0,s.jsxs)(n.p,{children:["Support for PSR-11 compatible Containers has been introduced and can be accessed via the ",(0,s.jsx)(n.code,{children:"\\core\\di"})," class. Read the ",(0,s.jsx)(n.a,{href:"/moodledevdocs/docs/4.4/apis/core/di/",children:"full documentation"})," for information on how to use Moodle's DI infrastructure."]}),"\n",(0,s.jsx)(n.h3,{id:"attributes",children:"Attributes"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-81011"}),"\n",(0,s.jsx)(n.p,{children:"PHP 8.0 introduced support for the Attribute language feature and Moodle is beginning to make use of this in small but helpful ways."}),"\n",(0,s.jsxs)(n.p,{children:["To simplify this adoption, a new ",(0,s.jsx)(n.code,{children:"\\core\\attribute_helper"})," class has been created with methods to quickly and easily fetch the ",(0,s.jsx)(n.code,{children:"\\ReflectionAttribute"})," for any relevant attributes."]}),"\n",(0,s.jsx)(n.p,{children:"The new methods can search for an attribute using a reference, which can be:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"a string, whose name represents a global function, a class, or a class combined with a method, property, constant, or enum"}),"\n",(0,s.jsx)(n.li,{children:"an instantiated object"}),"\n",(0,s.jsx)(n.li,{children:"an array whose first value is either a string or object, and whose optional second value is a child of the first value"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="Fetching attributes"',children:"<?php\n\nuse core\\attribute_helper;\nuse core\\attribute\\{label, tags};\n\n// Get a label on the \\some_function_name() method.\n$label = attribute_helper::one_from('some_function_name', label::class)?->newInstance();\n\n// Get an instance of a label on the \\example class.\n$label = attribute_helper::one_from(example::class, label::class)?->newInstance();\n\n// Get an instance of a label on an instance of\xa0the \\example class.\n$example = new example();\n$label = attribute_helper::one_from($example, label::class)?->newInstance();\n\n// Get an instance of a label on a constant, property, or method of the \\example class.\n$label = attribute_helper::one_from([example::class, 'some_child'], label::class)?->newInstance();\n\n// Get an instance of a label on a constant, property, or method of an instance of\xa0the \\example class.\n$example = new example();\n$label = attribute_helper::one_from([$example, 'some_child'], label::class)?->newInstance();\n"})}),"\n",(0,s.jsx)(n.p,{children:"Other variations of the above are also possible."}),"\n",(0,s.jsx)(n.h3,{id:"hooks",children:"Hooks"}),"\n",(0,s.jsx)(n.h4,{id:"hook-interfaces",children:"Hook interfaces"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-81011"}),"\n",(0,s.jsxs)(n.p,{children:["Attribute-based alternatives to the ",(0,s.jsx)(n.code,{children:"\\core\\hook\\described_hook"}),", and ",(0,s.jsx)(n.code,{children:"\\core\\hook\\deprecated_callback_replacement"})," interfaces are now supported."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["the ",(0,s.jsx)(n.code,{children:"\\core\\attribute\\label"})," attribute can be used to add a string-based description of the hook."]}),"\n",(0,s.jsxs)(n.li,{children:["the ",(0,s.jsx)(n.code,{children:"\\core\\attribute\\tags"})," attribute can be used to add one or more tags to describe the hook."]}),"\n",(0,s.jsxs)(n.li,{children:["the ",(0,s.jsx)(n.code,{children:"\\core\\attribute\\hook\\replaces_callbacks"})," attribute can be used to add one or more replaced callbacks."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace core\\hook;\n\nuse core\\attribute;\n\n#[attribute\\label('This is a description of the hook')]\n#[attribute\\tags('examples', 'navigation', 'authentication')]\n#[attribute\\hook\\replaces_callbacks('an_old_callback_that_is_replaced_here')]\nclass before_navigation_render {\n    public function __construct(\n        public readonly \\navigation_node $navigation,\n    ) {\n    }\n}\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["It is still possible to use the ",(0,s.jsx)(n.code,{children:"\\core\\hook\\described_hook"})," and ",(0,s.jsx)(n.code,{children:"\\core\\hook\\deprecated_callback_replacement"})," interfaces. The attribute approach is provided as a more light-weight alternative."]})}),"\n",(0,s.jsx)(n.h4,{id:"callable-notation",children:"Callable notation"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-81180"}),"\n",(0,s.jsx)(n.p,{children:"When specifying the callback for a hook, you can now do so using the callable array notation, for example:"}),"\n",(0,s.jsxs)(p,{children:[(0,s.jsx)(h,{value:"array-notation",label:"Array notation",default:!0,children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$callbacks = [\n    [\n        'hook' => 'test_plugin\\\\hook\\\\hook',\n        // Array notation:\n        'callback' => [\\test_plugin\\callbacks::class, 'test1'],\n    ],\n];\n"})})}),(0,s.jsx)(h,{value:"string-notation-using-class",label:"String notation",default:!0,children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$callbacks = [\n    [\n        'hook' => 'test_plugin\\\\hook\\\\hook',\n        // String notation:\n        'callback' => \\test_plugin\\callbacks::class . '::test1',\n    ],\n];\n"})})}),(0,s.jsx)(h,{value:"string-notation-using-string",label:"Alternate string notation (discouraged)",default:!0,children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$callbacks = [\n    [\n        'hook' => 'test_plugin\\\\hook\\\\hook',\n        // Strongly discouraged:\n        'callback' => '\\\\test_plugin\\\\callbacks::test1',\n    ],\n];\n"})})})]}),"\n",(0,s.jsx)(n.admonition,{title:"Callbacks in earlier versions of Moodle",type:"danger",children:(0,s.jsxs)(n.p,{children:["If writing a callback for Moodle 4.3, you ",(0,s.jsx)(n.strong,{children:"must"})," use the string notation."]})}),"\n",(0,s.jsx)(n.h3,{id:"string-formatting",children:"String formatting"}),"\n",(0,s.jsx)(n.h4,{id:"deprecation-of-format_-parameters",children:"Deprecation of format_* parameters"}),"\n",(0,s.jsxs)(n.p,{children:["A number of legacy features and ways of calling ",(0,s.jsx)(n.code,{children:"format_text"}),", and ",(0,s.jsx)(n.code,{children:"format_string"})," now emit deprecation notices. These were all deprecated a long time ago but did not emit:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Changes to ",(0,s.jsx)(n.code,{children:"format_string"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"$options"})," array ",(0,s.jsx)(n.em,{children:"must not"})," be a ",(0,s.jsx)(n.code,{children:"\\context"})," or ",(0,s.jsx)(n.code,{children:"\\core\\context"})," object. This was never supported and behaviour was previously undetected"]}),"\n",(0,s.jsxs)(n.li,{children:["Unknown values passed to the ",(0,s.jsx)(n.code,{children:"$options"})," parameter will now emit appropriate debugging notices"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Changes to ",(0,s.jsx)(n.code,{children:"format_text"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The fourth parameter, ",(0,s.jsx)(n.code,{children:"$courseiddonotuse"})," now emits a deprecation notice if provided. This was deprecated for Moodle 2.0 in ",(0,s.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-22001",children:"MDL-22001"})]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"smiley"})," option now emits a deprecation notice. This was deprecated for Moodle 2.0."]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"nocache"})," option now emits a deprecation notice. This was deprecated for Moodle 2.3 in ",(0,s.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-34347",children:"MDL-34347"})]}),"\n",(0,s.jsxs)(n.li,{children:["The use of ",(0,s.jsx)(n.code,{children:"FORMAT_WIKI"})," as a source format now throws an exception. Previously it added debugging information to the rendered content. This was deprecated in Moodle 1.5."]}),"\n",(0,s.jsxs)(n.li,{children:["Unknown values passed to the ",(0,s.jsx)(n.code,{children:"$options"})," parameter will now emit appropriate debugging notices"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"new-coreformatting-class",children:"New \\core\\formatting class"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-80072"}),"\n",(0,s.jsxs)(n.p,{children:["A new ",(0,s.jsx)(n.code,{children:"\\core\\formatting"})," class has been introduced with new ",(0,s.jsx)(n.code,{children:"format_string()"}),", and ",(0,s.jsx)(n.code,{children:"format_text()"})," methods."]}),"\n",(0,s.jsxs)(n.p,{children:["These methods no longer user the ",(0,s.jsx)(n.code,{children:"array $options"})," style configuration, instead expanding options into method parameters."]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["The existing ",(0,s.jsx)(n.code,{children:"\\format_string()"}),", and ",(0,s.jsx)(n.code,{children:"\\format_text()"})," methods remain in place, and are ",(0,s.jsx)(n.em,{children:"not currently deprecated"}),". At this time ",(0,s.jsx)(n.em,{children:"you do"})," not need to migrate to the APIs."]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="New \\core\\formatting methods"',children:"namespace core;\n\nclass formatting {\n    public function format_string(\n        ?string $string,\n        bool $striplinks = true,\n        ?context $context = null,\n        bool $filter = true,\n        bool $escape = true,\n    ): string;\n\n    public function format_text(\n        ?string $text,\n        string $format = FORMAT_MOODLE,\n        ?context $context = null,\n        bool $trusted = false,\n        ?bool $clean = null,\n        bool $filter = true,\n        bool $para = true,\n        bool $newlines = true,\n        bool $overflowdiv = false,\n        bool $blanktarget = false,\n        bool $allowid = false,\n    ): string;\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If choosing to use these new methods you ",(0,s.jsx)(n.strong,{children:"must"})," use Dependency Injection either via injection into the class, or via the ",(0,s.jsx)(n.code,{children:"\\core\\di"})," container. You ",(0,s.jsx)(n.strong,{children:"must not"})," instantiate the ",(0,s.jsx)(n.code,{children:"\\core\\formatting"})," class directly."]}),"\n",(0,s.jsxs)(p,{children:[(0,s.jsx)(h,{value:"di-usage",label:"Usage via Dependency Injection",default:!0,children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="Usage in an injected class"',children:"namespace core;\n\nclass example {\n    public function __construct(\n        protected readonly \\core\\formatting $formatter,\n    ) {\n    }\n\n    public function do_something(string $input): string {\n        return $this->formatter->format_string($input, ...);\n    }\n}\n"})})}),(0,s.jsx)(h,{value:"container-usage",label:"Usage via the \\core\\di container",default:!0,children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="Usage via the \\core\\di container"',children:"$formatter = \\core\\di::get(\\core\\formatting::class);\necho $formatter->format_string($input, ...);\n"})})})]}),"\n",(0,s.jsx)(n.admonition,{title:"Named Parameters",type:"info",children:(0,s.jsxs)(p,{children:[(0,s.jsxs)(h,{value:"named",label:"Recommended usage",default:!0,children:[(0,s.jsxs)(n.p,{children:["It is ",(0,s.jsx)(n.em,{children:"strongly recommended"})," that you make use of named parameters for all but the first argument when calling them, rather than using positional arguments."]}),(0,s.jsx)(m,{title:"Named arguments",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'$formatter = \\core\\di::get(\\core\\formatting::class);\n\n$formatter->format_string(\n    "The content to be formatted",\n    context: \\core\\context\\course::instance($courseid),\n    filter: false,\n);\n\n$formatter->format_text(\n    "The content to be formatted",\n    context: \\core\\context\\course::instance($courseid),\n    filter: false,\n    blanktarget: true,\n);\n'})})})]}),(0,s.jsxs)(h,{value:"positional",label:"Alternative approach",children:[(0,s.jsx)(n.p,{children:"The use of positional arguments to the format methods is strongly discouraged."}),(0,s.jsx)(c,{title:"Positional arguments",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'$formatter = \\core\\di::get(\\core\\formatting::class);\n\n$formatter->format_string(\n    "The content to be formatted",\n    true,\n    \\core\\context\\course::instance($courseid),\n    false,\n);\n\n$formatter->format_text(\n    "The content to be formatted",\n    FORMAT_MOODLE,\n    \\core\\context\\course::instance($courseid),\n    false,\n    null,\n    false,\n    true,\n    true,\n    false,\n    true,\n);\n'})})})]})]})}),"\n",(0,s.jsx)(n.h3,{id:"tasks-api",children:"Tasks API"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-67667"}),"\n",(0,s.jsx)(n.p,{children:"Support for tasks which block all other tasks has been removed. The ability to configure a task as blocking is no longer supported and will not work."}),"\n",(0,s.jsx)(n.p,{children:"This functionality had the ability to cause significant performance issues, and contained a number of serious bugs."}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsx)(n.p,{children:"If you are using this functionality in older versions of Moodle you are advised to move away from it as soon as possible in all Moodle versions."})}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-79128"}),"\n",(0,s.jsxs)(n.p,{children:["The behaviour of the task runner has been changed to limit the number of retries allowed before a failing ",(0,s.jsx)(n.em,{children:"adhoc"})," task is removed. Scheduled tasks are not affected."]}),"\n",(0,s.jsxs)(n.p,{children:["The default value for the maximum retry limit on an Ad-hoc task is ",(0,s.jsx)(n.strong,{children:"12"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Retries can be entirely disabled by passing a value of ",(0,s.jsx)(n.code,{children:"0"}),", for example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$task = new example_task();\n// This task wil not be retried at all.\n$task->set_attempts_available(0);\n\\core\\task\\manager::queue_task($task);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["See the ",(0,s.jsx)(n.a,{href:"./apis/subsystems/task/adhoc#retrying-failing-tasks",children:"detailed documentation"})," on how to use these new APIs."]}),"\n",(0,s.jsx)(n.h3,{id:"javascript",children:"JavaScript"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-80850"}),"\n",(0,s.jsxs)(n.p,{children:["A new JS module, ",(0,s.jsx)(n.code,{children:"core/dropzone"}),", has been introduced to provide a standardised way to create a Drop-zone in Moodle. Read the ",(0,s.jsx)(n.a,{href:"/moodledevdocs/docs/4.4/guides/javascript/#dropzone",children:"full documentation"})," for information on how to use it."]}),"\n",(0,s.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n",(0,s.jsx)(n.h3,{id:"api-change",children:"API Change"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-80005"}),"\n",(0,s.jsxs)(n.p,{children:["Parameter constants, and the cleaning of values using these parameters, has been moved to a new enum in ",(0,s.jsx)(n.code,{children:"\\core\\param"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"The enum contains relevant associated methods for fetching, validating, and cleaning the content of values, for example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="Examples of enum-based parameters"',children:"// Clean an existing variable.\n$value = \\core\\param::ALPHANUMEXT->clean($value);\n$value = \\core\\param::ALPHANUMEXT->validate_param($value);\n$value = \\core\\param::ALPHANUMEXT->clean_param_array($value);\n\n// Require a param (replaced required_param).\n$value = \\core\\param::ALPHANUMEXT->required_param('someparamname');\n$value = \\core\\param::ALPHANUMEXT->optional_param('someparamname', 'defaultvalue');\n$value = \\core\\param::ALPHANUMEXT->required_param_array('someparamname');\n$value = \\core\\param::ALPHANUMEXT->optional_param_array('someparamname', []);\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["The existing ",(0,s.jsx)(n.code,{children:"PARAM_*"})," constants, and related methods (",(0,s.jsx)(n.code,{children:"required_param"}),", ",(0,s.jsx)(n.code,{children:"optional_param()"}),", ",(0,s.jsx)(n.code,{children:"clean_param()"}),", and so on) remain in place, and are ",(0,s.jsx)(n.em,{children:"not currently deprecated"}),". At this time ",(0,s.jsx)(n.em,{children:"you do"})," not need to migrate to the APIs."]})}),"\n",(0,s.jsx)(n.h3,{id:"deprecations",children:"Deprecations"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-80005"}),"\n",(0,s.jsx)(n.p,{children:"A number of deprecated parameter types have been deprecated, these include:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PARAM_CLEAN"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PARAM_INTEGER"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PARAM_NUMBER"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PARAM_ACTION"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PARAM_FORMAT"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PARAM_MULTILANG"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PARAM_CLEANFILE"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"These param types have all been deprecated since Moodle 2.0."}),"\n",(0,s.jsxs)(n.h2,{id:"introduction-of-deprecated-attribute",children:["Introduction of ",(0,s.jsx)(n.code,{children:"deprecated"})," attribute"]}),"\n",(0,s.jsxs)(n.p,{children:["A new ",(0,s.jsx)(n.code,{children:"\\core\\attribute\\deprecated"})," attribute, and related ",(0,s.jsx)(n.code,{children:"\\core\\deprecation"})," class have been introduced to provide a standardised way to emit deprecation notices."]}),"\n",(0,s.jsx)(n.p,{children:"The attribute can be applied to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"classes, traits, interfaces, and enums"}),"\n",(0,s.jsx)(n.li,{children:"enum cases"}),"\n",(0,s.jsx)(n.li,{children:"global functions"}),"\n",(0,s.jsx)(n.li,{children:"class constants, properties, and methods"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The attribute can be used to specify information including:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"the version that a feature was deprecated"}),"\n",(0,s.jsx)(n.li,{children:"the relevant MDL"}),"\n",(0,s.jsx)(n.li,{children:"the reason for deprecation"}),"\n",(0,s.jsx)(n.li,{children:"any replacement"}),"\n",(0,s.jsx)(n.li,{children:"whether the deprecation is final"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"\\core\\deprecation"})," class contains helper methods to inspect for use of the deprecated attribute and allows usage including:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"checking if a feature is deprecated"}),"\n",(0,s.jsx)(n.li,{children:"emitting a deprecation notice if a feature is deprecated"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="Examples of usage"',children:"// A method which has been initially deprecated and should show debugging.\n/** @deprecated since 4.3 */\n#[\\core\\attribute\\deprecated(replacement: 'random_bytes', since: '4.3')]\nfunction random_bytes_emulate($length) {\n    \\core\\deprecation::emit_deprecation_if_present(__FUNCTION__);\n    return random_bytes($length);\n}\n\n// A method which has been finally deprecated and should throw an exception.\n/** @deprecated since 2.7 */\n#[\\core\\attribute\\deprecated(replacement: 'Events API', since: '2.3', final: true)]\nfunction add_to_log() {\n    \\core\\deprecation::emit_deprecation_if_present(__FUNCTION__);\n}\n\n// Checking when an enum case is deprecated:\n\\core\\deprecation::is_deprecated(\\core\\param::RAW); // Returns false.\n\\core\\deprecation::is_deprecated(\\core\\param::INTEGER); // Returns true.\n\n// Checking if a class is deprecated:\n\\core\\deprecation::is_deprecated(\\core\\task\\manager::class); // Returns false.\n\n// Checking if an instantiated class is deprecated:\n\\core\\deprecation::is_deprecated(new \\moodle_url('/example/'));\n\n// Checking if a class method is deprecated:\n\\core\\deprecation::is_deprecated([\\moodle_url::class, 'out']);\n\\core\\deprecation::is_deprecated([new \\moodle_url('/example/'), 'out']);\n"})}),"\n",(0,s.jsx)(n.p,{children:"This functionality is intended to simplify deprecation of features such as constants, enums, and related items which are called from centralised APIs and difficult to detect as deprecated."}),"\n",(0,s.jsxs)(n.p,{children:["This functionality does not replace the phpdoc ",(0,s.jsx)(n.code,{children:"@deprecated"})," docblock."]}),"\n",(0,s.jsx)(n.h3,{id:"clock-interface",children:"Clock interface"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-80838"}),"\n",(0,s.jsx)(n.p,{children:"Moodle now supports use of a PSR-20 compliant Clock Interface, accessed via Dependency Injection."}),"\n",(0,s.jsxs)(n.p,{children:["See the ",(0,s.jsx)(n.a,{href:"/moodledevdocs/docs/4.4/apis/core/clock/",children:"detailed documentation"})," on how to use this new interface."]}),"\n",(0,s.jsx)(n.h2,{id:"enrolment",children:"Enrolment"}),"\n",(0,s.jsx)(n.h3,{id:"meta-enrolment-support-in-csv-course-upload",children:"Meta enrolment support in CSV course upload"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-73852"}),"\n",(0,s.jsx)(n.p,{children:"It is now possible to use meta enrolment when uploading courses using CSV file. Here is an example of CSV file that can be used to upload a course with meta enrolment:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="Example of CSV for meta enrolment"',children:"shortname,fullname,category_idnumber,enrolment_1,enrolment_1_metacoursename\ncourse1,Course 1,CAT1,meta,course2\n"})}),"\n",(0,s.jsx)(n.h3,{id:"support-for-multiple-instances-in-csv-course-upload",children:"Support for multiple instances in csv course upload"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-43820"}),"\n",(0,s.jsx)(n.p,{children:"It is now possible to upload a CSV file with multiple enrol instances of the same type in same course. This is useful for example when you want to enrol users in a course using two different cohorts."}),"\n",(0,s.jsx)(n.p,{children:"To support this, a new method has been added to allow the UI to locate existing enrolment instances:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"/**\n * Finds matching instances for a given course.\n *\n * @param array $enrolmentdata enrolment data.\n * @param int $courseid Course ID.\n * @return stdClass|null Matching instance\n */\npublic function find_instance(\n    array $enrolmentdata,\n    int $courseid,\n) : ?stdClass;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If your enrolment plugins supports multiple instances within the same course, you should implement ",(0,s.jsx)(n.a,{href:"./apis/plugintypes/enrol#enrol_pluginfind_instance-stdclass",children:"this method"}),"."]}),"\n",(0,s.jsxs)(o,{children:[(0,s.jsx)("summary",{children:"Format of the CSV file"}),(0,s.jsxs)(n.p,{children:["Each line of the CSV should only have data for ",(0,s.jsx)(n.em,{children:"one"})," enrolment instance."]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csv",metastring:'title="best-example.csv"',children:"shortname,fullname,category_idnumber,enrolment_1,enrolment_1_role,enrolment_1_cohortidnumber\nC1,Course 1,CAT1,cohort,student,CV1\nC1,Course 1,CAT1,cohort,teacher,CV4\n"})}),(0,s.jsxs)(n.admonition,{type:"warning",children:[(0,s.jsxs)(n.p,{children:["If a single line format is used, only the ",(0,s.jsx)(n.em,{children:"final"})," enrolment instance will be updated. For example in the following example only the second enrolment instance will be updated:"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csv",metastring:'title="not-recommended-example.csv"',children:"shortname,fullname,category,summary,enrolment_1,enrolment_1_role,enrolment_2,enrolment_2_role\nshortname,fullname,category,summary,cohort,student,cohort,teacher\n"})})]})]}),"\n",(0,s.jsx)(n.h2,{id:"refactoring-bs4-features-dropped-in-bs5",children:"Refactoring BS4 features dropped in BS5"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-71979"}),"\n",(0,s.jsx)(n.p,{children:"Some of the Bootstrap 4 classes will be deprecated or dropped in its version 5. To prepare for this, some of the current Bootstrap 4 classes usages have been replaced with version 5 compatible classes. This will help us to upgrade to Bootstrap 5 in the future."}),"\n",(0,s.jsxs)(n.p,{children:["See more information in ",(0,s.jsx)(n.a,{href:"/moodledevdocs/docs/4.4/guides/bs5migration/",children:"Bootstrap 5 migration"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"new-course-section-page",children:"New course section page"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-79986"}),"\n",(0,s.jsxs)(n.p,{children:["The new course/section.php page is designed exclusively for displaying individual section content. It only requires ",(0,s.jsx)(n.code,{children:"sectionid"}),", eliminating the need for the legacy ",(0,s.jsx)(n.code,{children:"sectionnumber"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Enhancements to this page:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The General section will no longer appear above the selected section, ensuring a focused display of content for the specified section id."}),"\n",(0,s.jsx)(n.li,{children:'Regardless of the Course layout ("All sections on one page" vs "One section per page"), all section names in the main course page content will now link to the new page (excluding editing mode).'}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"$CFG->linkcoursesections"})," setting has been entirely removed. Initially used for the Classic theme to empower admins in deciding whether section names in the Navigation block should be linked, this setting is now obsolete. With the introduction of the course/section.php page, dedicated to displaying content for any single section, and a convenient link from the main course page, users can seamlessly focus on section content without the need for this setting."]}),"\n",(0,s.jsxs)(n.li,{children:["The methods ",(0,s.jsx)(n.code,{children:"core_courseformat\\base::set_section_number()"})," and ",(0,s.jsx)(n.code,{children:"core_courseformat\\base::get_section_number()"})," have been deprecated and replaced by ",(0,s.jsx)(n.code,{children:"core_courseformat\\base::set_sectionnum()"})," and ",(0,s.jsx)(n.code,{children:"core_courseformat\\base::get_sectionnum()"}),". The new methods use the null value when all the sections must be displayed (instead of 0). That way, section 0 (General), can be displayed on a single page too."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"activity-icons",children:"Activity icons"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-78284"}),"\n",(0,s.jsx)(n.h3,{id:"new-designs",children:"New designs"}),"\n",(0,s.jsx)(n.p,{children:"The activity icons have been updated to prioritize readability and transform the existing filled square shapes with white icons into outlined colored icons against a transparent background. This modification ensures that the icons are not only more accessible but also easily distinguishable for users.\nWhen upgrading the SVG files, the .png files have been removed."}),"\n",(0,s.jsx)(n.admonition,{title:"Considerations for creating/updating SVG icons",type:"tip",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Please make sure that the icons are filled with ",(0,s.jsx)(n.code,{children:"#212529"})," and that the background is transparent."]}),"\n",(0,s.jsx)(n.li,{children:"The icons should be 24x24px. It's recommended to define width and height into the SVG files to guarantee that the icons are displayed correctly."}),"\n"]})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"New activity icons",src:t(15121).A+"",width:"1440",height:"1024"})}),"\n",(0,s.jsx)(n.h3,{id:"activity-purposes",children:"Activity purposes"}),"\n",(0,s.jsxs)(n.p,{children:["Since Moodle 4.0, in places like the course page and the activity chooser icons have a more prominent role which is defined using the ",(0,s.jsx)(n.code,{children:"FEATURE_MOD_PURPOSE"})," feature flag."]}),"\n",(0,s.jsx)(n.p,{children:"The available activity purposes for this feature are:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Administration (",(0,s.jsx)(n.code,{children:"MOD_PURPOSE_ADMINISTRATION"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Assessment (",(0,s.jsx)(n.code,{children:"MOD_PURPOSE_ASSESSMENT"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Collaboration (",(0,s.jsx)(n.code,{children:"MOD_PURPOSE_COLLABORATION"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Communication (",(0,s.jsx)(n.code,{children:"MOD_PURPOSE_COMMUNICATION"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Interactive content (",(0,s.jsx)(n.code,{children:"MOD_PURPOSE_INTERACTIVECONTENT"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Resource (",(0,s.jsx)(n.code,{children:"MOD_PURPOSE_CONTENT"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Other (",(0,s.jsx)(n.code,{children:"MOD_PURPOSE_OTHER"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"Changes in purposes for Moodle 4.4",type:"danger",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"MOD_PURPOSE_INTERFACE"})," has been deprecated, so it's not recommended to use it."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"MOD_PURPOSE_INTERACTIVECONTENT"})," has been added. In core, it's used for activities like H5P, Lesson, SCORM and IMS package."]}),"\n"]})}),"\n",(0,s.jsx)(n.h3,{id:"branded-icons",children:"Branded icons"}),"\n",(0,s.jsxs)(n.p,{children:["A new callback, ",(0,s.jsx)(n.code,{children:"<modname>_is_branded()"})," has been added to the modules. Branded icons are displayed with their original colours and they are not affected by the activity purpose colours. By default, none of the modules are branded."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"/**\n * Whether the activity is branded.\n * This information is used, for instance, to decide if a filter should be applied to the icon or not.\n *\n * @return bool True if the activity is branded, false otherwise.\n */\nfunction h5pactivity_is_branded(): bool {\n    return true;\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"phpunit-96-update",children:"PHPUnit 9.6 update"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-81266"}),"\n",(0,s.jsx)(n.h3,{id:"intention",children:"Intention"}),"\n",(0,s.jsxs)(n.p,{children:["The main goal of this minor update, from ",(0,s.jsx)(n.strong,{children:"PHPUnit 9.5 to 9.6"}),", is to start informing to developers in advance about the functionality that has been deprecated in the 9.x series and will be removed completely with the next PHPUnit 10.x update."]}),"\n",(0,s.jsx)(n.h3,{id:"deprecated-stuff",children:"Deprecated stuff"}),"\n",(0,s.jsx)(n.p,{children:"Here you can find all the functionality that has been deprecated in PHPUnit 9.x and needs to be fixed, converted or removed in order to allow the tests to continue working once Moodle gets upgraded to PHPUnit 10.x:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["A number of attribute-related assertions have been deprecated, will be removed with PHPUnit 10. Alternatives for ",(0,s.jsx)(n.em,{children:"some"})," of them are available (Ref. ",(0,s.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-81281",children:"MDL-81281"}),"):","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"assertClassHasAttribute()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"assertClassNotHasAttribute()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"assertClassHasStaticAttribute()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"assertClassNotHasStaticAttribute()"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"assertObjectHasAttribute()"}),"        => ",(0,s.jsx)(n.code,{children:"assertObjectHasProperty()"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"assertObjectNotHasAttribute()"}),"      => ",(0,s.jsx)(n.code,{children:"assertObjectNotHasProperty()"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["A number of deprecation, notice, warning and error expectations have been deprecated, will be removed with PHPUnit 10. No alternative exists. A working replacement is available in the linked issue, hopefully there aren't many cases (Ref. ",(0,s.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-81266",children:"MDL-81266"}),"):","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"expectDeprecation()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"expectDeprecationMessage()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"expectDeprecationMessageMatches()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"expectError()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"expectErrorMessage()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"expectErrorMessageMatches()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"expectNotice()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"expectNoticeMessage()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"expectNoticeMessageMatches()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"expectWarning()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"expectWarningMessage()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"expectWarningMessageMatches()"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"->withConsecutive()"})," functionality on PHPUnit mocks has been ",(0,s.jsx)(n.strong,{children:"silently"})," deprecated, will be removed with PHPUnit 10. Note that this won't affect PHPUnit 9.6 runs and an alternative path will be proposed in the linked issue, part of the PHPUnit 10 epic (Ref. ",(0,s.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-81308",children:"MDL-81308"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"PHPUnit\\Framework\\TestCase::getMockClass()"})," has been deprecated, will be removed with PHPUnit 10. No clear alternative exists and won't be investigated, because there aren't cases in core."]}),"\n",(0,s.jsxs)(n.li,{children:["Cannot use the ",(0,s.jsx)(n.code,{children:"Test"})," suffix on abstract test case classes anymore. Proceed to rename them to end with ",(0,s.jsx)(n.code,{children:"TestCase"})," instead."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"developer-metadata",children:"Developer metadata"}),"\n",(0,s.jsx)(d,{version:"4.4",issueNumber:"MDL-81084"}),"\n",(0,s.jsxs)(n.p,{children:["The list of plugins which are shipped with Moodle core is now available in a JSON format and located at ",(0,s.jsx)(n.code,{children:"/lib/plugins.json"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["The schema for this format can be found at ",(0,s.jsx)(n.code,{children:"/lib/plugins.schema.json"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"/general/development/tools/metadata",children:"Developer metadata"})," for more information on available metadata."]}),"\n",(0,s.jsx)(n.h2,{id:"previous-versions",children:"Previous versions"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/4.3/devupdate",children:"Moodle 4.3 developer update"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/4.2/devupdate",children:"Moodle 4.2 developer update"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/4.1/devupdate",children:"Moodle 4.1&4.0 developer update"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}function u(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},15121:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/activity-icons-d6ebc5a5be4e1ed6641e13a561f15aa9.png"}}]);