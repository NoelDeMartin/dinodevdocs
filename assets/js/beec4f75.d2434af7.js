"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[48874],{17155:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>i,contentTitle:()=>d,default:()=>p,frontMatter:()=>l,metadata:()=>a,toc:()=>c});var r=n(74848),s=n(28453),t=n(78924);const l={title:"Composer",tags:["tools"]},d=void 0,a={id:"development/tools/composer",title:"Composer",description:"Use composer to download Moodle code",source:"@site/general/development/tools/composer.md",sourceDirName:"development/tools",slug:"/development/tools/composer",permalink:"/moodledevdocs/general/development/tools/composer",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/general/development/tools/composer.md",tags:[{label:"tools",permalink:"/moodledevdocs/general/tags/tools"}],version:"current",lastUpdatedBy:"Sara Arjona",lastUpdatedAt:1684855259e3,frontMatter:{title:"Composer",tags:["tools"]},sidebar:"coding",previous:{title:"Component library",permalink:"/moodledevdocs/general/development/tools/component-library"},next:{title:"Exception Tracing",permalink:"/moodledevdocs/general/development/tools/exceptiontracing"}},i={},c=[{value:"Use composer to download Moodle code",id:"use-composer-to-download-moodle-code",level:2},{value:"How to prepare and submit composer changes",id:"how-to-prepare-and-submit-composer-changes",level:2}];function h(e){const o={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.A,{frontMatter:l,metadata:a}),"\n",(0,r.jsx)(o.h2,{id:"use-composer-to-download-moodle-code",children:"Use composer to download Moodle code"}),"\n",(0,r.jsxs)(o.p,{children:[(0,r.jsx)(o.code,{children:"Composer.json"})," now includes meta information and hence composer can be used to download the Moodle code base.\nYou can do it by creating ",(0,r.jsx)(o.code,{children:"composer.json"})," file with following information"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-json",children:'{\n    "repositories": [\n        {\n            "type": "vcs",\n            "url": "https://github.com/moodle/moodle.git"\n        }\n    ],\n    "require": {\n        "moodle/moodle": "v4.2.0"\n    }\n}\n'})}),"\n",(0,r.jsx)(o.p,{children:"And then execute:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-sh",children:"php composer.phar install\n"})}),"\n",(0,r.jsx)(o.h2,{id:"how-to-prepare-and-submit-composer-changes",children:"How to prepare and submit composer changes"}),"\n",(0,r.jsxs)(o.p,{children:["There are a number of situations where we need to update the bundled ",(0,r.jsx)(o.a,{href:"https://github.com/moodle/moodle/blob/master/composer.json",children:"composer.json"}),"] in core. When we upgrade, for a given branch, ",(0,r.jsx)(o.a,{href:"https://tracker.moodle.org/browse/MDL-71036",children:"the phpunit"})," or ",(0,r.jsx)(o.a,{href:"https://tracker.moodle.org/browse/MDL-70637",children:"the behat-extension"})," versions... we also have to update the ",(0,r.jsx)(o.a,{href:"https://github.com/moodle/moodle/blob/master/composer.lock",children:"composer.lock"})," file, in order to guarantee that all the tests will run in a stable, verified environment."]}),"\n",(0,r.jsx)(o.p,{children:"As far as there are a number of variables affecting how that lock file will be generated, here there are some standard steps to follow, in order to guarantee that any change to composer will be always applied in the same, standard and verified way."}),"\n",(0,r.jsxs)(o.ol,{children:["\n",(0,r.jsxs)(o.li,{children:["Pre-requisite: Always use the ",(0,r.jsx)(o.strong,{children:"lower PHP version supported"})," in the branch the changes are happening. So, if a given branch (",(0,r.jsx)(o.code,{children:"MOODLE_37_STABLE"}),") works with PHP 7.1, 7.2 and 7.3, all the following steps will be executed using PHP 7.1 (the lower version supported)."]}),"\n",(0,r.jsxs)(o.li,{children:["Perform the required changes to the ",(0,r.jsx)(o.code,{children:"composer.json"})," file. Normally."]}),"\n",(0,r.jsxs)(o.li,{children:["Remove the composer.lock file that is going to be regenerated.",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(o.code,{children:"rm composer.lock"})]}),"\n",(0,r.jsxs)(o.li,{children:["Remove completely the vendor directory.",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(o.code,{children:"rm -fr vendor"})]}),"\n",(0,r.jsxs)(o.li,{children:["Clean all composer caches.",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(o.code,{children:"php composer.phar clearcache"})]}),"\n",(0,r.jsxs)(o.li,{children:["Run ",(0,r.jsx)(o.code,{children:"php composer.phar update"}),", a new ",(0,r.jsx)(o.code,{children:"composer.lock"})," will be regenerated."]}),"\n",(0,r.jsxs)(o.li,{children:["Check that the ",(0,r.jsx)(o.code,{children:"composer.lock"})," file, together with other changes, does include the changes you've performed in the ",(0,r.jsx)(o.code,{children:"composer.json"})," file."]}),"\n",(0,r.jsx)(o.li,{children:"Ideally, run both phpunit and behat tests and verify that there isn't any problem, using all the supported PHP versions."}),"\n",(0,r.jsx)(o.li,{children:"Done, you can send the changes for review, integration and, if everything goes ok, will be applied upstream without problem."}),"\n"]})]})}function p(e={}){const{wrapper:o}={...(0,s.R)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);