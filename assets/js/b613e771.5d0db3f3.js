"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[97499],{27615:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var o=t(74848),i=t(28453),s=t(78924);const r={title:"Moodle Development Kit",tags:["tools"]},a=void 0,l={id:"development/tools/mdk",title:"Moodle Development Kit",description:"Every developer creates simple tools to avoid repeating cumbersome and/or boring tasks, and that is precisely why MDK has been created: to pack all those useful tools in a portable way across systems. Initially developed in Bash, the project moved to Python to avoid dealing with inconsistencies between Unix platforms, and eventually to support Windows.",source:"@site/general/development/tools/mdk.md",sourceDirName:"development/tools",slug:"/development/tools/mdk",permalink:"/moodledevdocs/general/development/tools/mdk",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/general/development/tools/mdk.md",tags:[{label:"tools",permalink:"/moodledevdocs/general/tags/tools"}],version:"current",lastUpdatedBy:"Andrew Lyons",lastUpdatedAt:1712762084e3,frontMatter:{title:"Moodle Development Kit",tags:["tools"]},sidebar:"coding",previous:{title:"Gitpod",permalink:"/moodledevdocs/general/development/tools/gitpod"},next:{title:"Metadata",permalink:"/moodledevdocs/general/development/tools/metadata/"}},d={},c=[{value:"Key concept",id:"key-concept",level:2},{value:"Typical workflows using MDK",id:"typical-workflows-using-mdk",level:2},{value:"Installing a new instance",id:"installing-a-new-instance",level:3},{value:"Fixing an issue",id:"fixing-an-issue",level:3},{value:"Peer reviewing a patch",id:"peer-reviewing-a-patch",level:3},{value:"Backporting a fix",id:"backporting-a-fix",level:3},{value:"Upgrading the instances",id:"upgrading-the-instances",level:3},{value:"Executing behat tests",id:"executing-behat-tests",level:3},{value:"Features",id:"features",level:2},{value:"Installation",id:"installation",level:2},{value:"Upgrading MDK",id:"upgrading-mdk",level:2},{value:"The MDK Suite",id:"the-mdk-suite",level:2},{value:"MDK Browser Extension",id:"mdk-browser-extension",level:3},{value:"MDK Authentication",id:"mdk-authentication",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.A,{frontMatter:r,metadata:l}),"\n",(0,o.jsx)(n.p,{children:"Every developer creates simple tools to avoid repeating cumbersome and/or boring tasks, and that is precisely why MDK has been created: to pack all those useful tools in a portable way across systems. Initially developed in Bash, the project moved to Python to avoid dealing with inconsistencies between Unix platforms, and eventually to support Windows."}),"\n",(0,o.jsx)(n.h2,{id:"key-concept",children:"Key concept"}),"\n",(0,o.jsx)(n.p,{children:"The most important concept of MDK is that it works with Moodle instances. An instance of Moodle is a directory in which you have checked out a particular version together with a database using a specific database engine. This means that if you want to work on Moodle 4.3 and 4.2, using both MySQL and PostgreSQL, you will have four separate instance directories. This choice was made because it is the safest, clearest, and most straightforward solution."}),"\n",(0,o.jsx)(n.h2,{id:"typical-workflows-using-mdk",children:"Typical workflows using MDK"}),"\n",(0,o.jsxs)(n.p,{children:["To discover what MDK can do for you, here are a few common tasks it can achieve. More on ",(0,o.jsx)(n.a,{href:"https://github.com/FMCorz/mdk/wiki/Typical-workflows",children:"MDK's wiki"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"installing-a-new-instance",children:"Installing a new instance"}),"\n",(0,o.jsx)(n.p,{children:"Say we need to create a new instance of Moodle 2.4 and install it with PostgreSQL. We also want the instance to be ready for development with appropriate config settings. We also want to create a bunch of user accounts."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"mdk create -i -v 24 -e pgsql -r dev users\n"})}),"\n",(0,o.jsx)(n.p,{children:"or the equivalent long form:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"mdk create --install --version 24 --engine pgsql --run dev users\n"})}),"\n",(0,o.jsx)(n.p,{children:"These options include:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--install"}),": launch the installation script after creating the instance"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--engine"}),": database engine to install the instance on (must be used with ",(0,o.jsx)(n.code,{children:"--install"}),"), default: ",(0,o.jsx)(n.code,{children:"mysqli"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--version"}),": version of Moodle create an instance of (default: '",(0,o.jsx)(n.code,{children:"master'"}),")"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--run"}),": scripts to run after installation (default: ",(0,o.jsx)(n.code,{children:"none"}),")"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["More information about scripts is available here: ",(0,o.jsx)(n.a,{href:"https://github.com/FMCorz/mdk/tree/master/mdk/scripts",children:"https://github.com/FMCorz/mdk/tree/master/mdk/scripts"})]}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"This is equivalent to doing"}),(0,o.jsx)("div",{children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'mkdir /dir/to/stable_24/moodle\nmkdir /dir/to/stable_24/moodledata\nln -s /dir/to/stable_24/moodle /var/www/stable_24\ngit clone git://git.moodle.org/moodle.git /dir/to/moodle\ncd /dir/to/stable_24/moodle\nphp admin/cli/install.php --wwwroot## "http://localhost/stable_24" --dataroot/dir/to/stable_24/moodledata --dbtype## pgsql --dbnamestable24 --dbuser## root --dbpassroot --dbhost## localhost --fullname"Stable 24 PostgreSQL" --shortname## stable_24 --adminuseradmin --adminpass=test --allow-unstable --agree-license --non-interactive\nvim config.php\n# Add the following settings:\n# - $CFG->sessioncookiepath: /stable_24/\n# - $CFG->debug: DEBUG_DEVELOPER\n# - $CFG->debugdisplay: 1\n# - $CFG->passwordpolicy: 0\n# - $CFG->perfdebug: 15\n# - $CFG->debugpageinfo: 1\n# - $CFG->allowthemechangeonurl: 1\n# - $CFG->cachejs: 0\n# - $CFG->yuicomboloading: 0\n# Include FirePHP Core\n# Login to Moodle\n# Create 10 students, 3 teachers and 3 managers\n'})})})]}),"\n",(0,o.jsx)(n.p,{children:"You also can specify the name of the instance using the --name or -n parameter. This is necessary to avoid name conflicts when trying to create same Moodle version with different database engines:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"mdk create -i -v 24 -e mysqli -r dev users -n stable_24-mysql\n"})}),"\n",(0,o.jsx)(n.h3,{id:"fixing-an-issue",children:"Fixing an issue"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"mdk fix 12345\n# Committing your patch\nmdk push -t\n"})}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"This is equivalent to doing"}),(0,o.jsx)("div",{children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"git branch --track MDL-12345-24 origin/MOODLE_24_STABLE\ngit checkout MDL-12345-24\n# Committing your patch\ngit push github MDL-12345-24\n# Editing the tracker issue to add\n# - Git repository URL\n# - Git branch for 2.4\n# - Git compare URL for 2.4\n"})})})]}),"\n",(0,o.jsx)(n.h3,{id:"peer-reviewing-a-patch",children:"Peer reviewing a patch"}),"\n",(0,o.jsx)(n.p,{children:"Here we want to pull a patch from a tracker issue into a new testing branch, and then run the PHPUnit tests."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"mdk pull 12345 -t\nmdk phpunit -r\n"})}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"This is equivalent to doing"}),(0,o.jsx)("div",{children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"cd /dir/to/stable_24/moodle\ngit branch --tracker MDL-12345-24-test MOODLE_24_STABLE\ngit checkout MDL-12345-24-test\ngit pull git://github.org/Someone/moodle.git MDL-12345-24\n# And now the PHPUnit part\nmkdir /dir/to/stable_24/moodledata_phpu\nvim config.php\n# To add\n# - $CFG->phpunit_dataroot = '/dir/to/stable_24/moodledata_phpu';\n# - $CFG->phpunit_prefix = 'phpu_';\nphp admin/tool/phpunit/cli/init.php\nphpunit\n"})})})]}),"\n",(0,o.jsx)(n.p,{children:"For executing only the testcases in a file you can use:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"mdk phpunit -r -u repository/tests/repository_test.php\n"})}),"\n",(0,o.jsx)(n.h3,{id:"backporting-a-fix",children:"Backporting a fix"}),"\n",(0,o.jsx)(n.p,{children:'MDK could handle for you most of the cherry-picking work when you backport a fix. To do so, you need to have installed locally instances called "stable_XX" for each version you want to backport your fix. To do so you can use commands like:'}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"mdk create -v 38 -i -r dev users makecourse -n stable_38\nmdk create -v 37 -i -r dev users makecourse -n stable_37\n"})}),"\n",(0,o.jsx)(n.p,{children:"Once you have the stable_XX versions, go to the instance where you have the branch you want to backport and execute:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"mdk backport --versions 37 38 --push --update-tracker\n"})}),"\n",(0,o.jsx)(n.p,{children:"The example params are:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"-v 37 38"})," backports the patch to the versions 3.7 and 3.8"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--push"})," pushes the branch to github"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--update-tracker"})," updates the tracker issue"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"After the execution, your stable_XX instances will be on the fix branch, commits are pushed to you github project and backport links will be updated in the tracker."}),"\n",(0,o.jsx)(n.p,{children:"If for some reason one cherry pick could not finish successfully, mdk will ask you if you want to keep this backport or no. If you choose to keep the partial backport, your stable_XX instance will be in cherry-picking state. In that case you need to solve any conflict and use mdk to push your changes:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"go to your stable_XX with cherry pick conflict"}),"\n",(0,o.jsxs)(n.li,{children:["solve conflicts with ",(0,o.jsx)(n.code,{children:"git mergetool"})," or any other tool"]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"git cherry-pick --continue"})}),"\n",(0,o.jsx)(n.li,{children:"once all conflicts are solved, push to your repository and tracker using"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"mdk push -t\n"})}),"\n",(0,o.jsx)(n.h3,{id:"upgrading-the-instances",children:"Upgrading the instances"}),"\n",(0,o.jsx)(n.p,{children:"Say we need to upgrade our instances, as a new weekly release has just been made available."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"mdk upgrade -u --all\n"})}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"This is equivalent to doing"}),(0,o.jsx)("div",{children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"# For each instance of Moodle...\ncd /dir/to/stable_24/moodle\ngit checkout MOODLE_24_STABLE\ngit fetch origin\ngit reset --hard origin/MOODLE_24_STABLE\nphp admin/cli/upgrade.php --non-interactive --allow-unstable\n"})})})]}),"\n",(0,o.jsx)(n.h3,{id:"executing-behat-tests",children:"Executing behat tests"}),"\n",(0,o.jsx)(n.p,{children:"In order to get the instance ready for acceptance testing (Behat) and run the test feature(s):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"mdk behat -r --tags=@core_completion\n"})}),"\n",(0,o.jsx)(n.p,{children:"For running only one feature or specific scenario:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'mdk behat -r -n "Name of the feature/scenario"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,o.jsxs)(n.p,{children:["For a complete list of the commands MDK has to offer, read through the ",(0,o.jsx)(n.a,{href:"https://github.com/FMCorz/mdk#command-list",children:"MDK README file"})," and the ",(0,o.jsx)(n.a,{href:"https://github.com/FMCorz/mdk/wiki",children:"MDK wiki"}),". For more detail about each command, simply run them with the flag '--help'."]}),"\n",(0,o.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,o.jsxs)(n.p,{children:["Please follow the instructions from the ",(0,o.jsx)(n.a,{href:"https://github.com/FMCorz/mdk#installation",children:"README file"}),"."]}),"\n",(0,o.jsxs)(n.admonition,{type:"note",children:[(0,o.jsx)(n.p,{children:"When you install MDK, you will be asked for the following information (with default responses indicated in square brackets):"}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"What user are you initialising MDK for? [default - your current username]"}),"\n",(0,o.jsxs)(n.li,{children:["What is the ",(0,o.jsx)(n.code,{children:"DocumentRoot"})," of your virtual host? [",(0,o.jsx)(n.code,{children:"~/www"}),"] <- ",(0,o.jsx)(n.strong,{children:"See note below"})]}),"\n",(0,o.jsxs)(n.li,{children:["Where do you want to store your Moodle instances? [",(0,o.jsx)(n.code,{children:"~/moodles"}),"] <- This can be in your home directory (the default) because a symlink will be created using ",(0,o.jsx)(n.code,{children:"DocumentRoot"})]}),"\n",(0,o.jsx)(n.li,{children:"What is your Github username? (Leave blank if not using Github)"}),"\n",(0,o.jsxs)(n.li,{children:["What is your MySQL user? [",(0,o.jsx)(n.code,{children:"root"}),"]"]}),"\n",(0,o.jsxs)(n.li,{children:["What is your MySQL password? [",(0,o.jsx)(n.code,{children:"root"}),"]"]}),"\n",(0,o.jsxs)(n.li,{children:["What is your PostgreSQL user? [",(0,o.jsx)(n.code,{children:"root"}),"]"]}),"\n",(0,o.jsxs)(n.li,{children:["What is your PostgreSQL password? [",(0,o.jsx)(n.code,{children:"root"}),"]"]}),"\n"]}),(0,o.jsxs)(n.p,{children:["By default, MDK will install instances to your home directory. A symlink will be created from your ",(0,o.jsx)(n.code,{children:"DocumentRoot"})," to the install location. You will need to either change the ",(0,o.jsx)(n.code,{children:"DocumentRoot"})," of your host to the path to your html root directory, for example ",(0,o.jsx)(n.code,{children:"/var/www/html"}),", or create a file in ",(0,o.jsx)(n.code,{children:"/etc/httpd/conf.d/moodlehq.conf"})," that configures a virtual host in your home directory."]}),(0,o.jsx)(n.p,{children:"You may need to set the path variable to null:"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'mdk config set path ""\n'})})]}),"\n",(0,o.jsx)(n.h2,{id:"upgrading-mdk",children:"Upgrading MDK"}),"\n",(0,o.jsx)(n.p,{children:"Every Moodle release, a new version of MDK is also being released in order to prepare for the development of the next Moodle version. To upgrade MDK:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Update all of the Moodle instances: ",(0,o.jsx)(n.code,{children:"mdk update --all"})]}),"\n",(0,o.jsxs)(n.li,{children:["Check out the master branch for all of your master instances, e.g. in your stable_master branch: ",(0,o.jsx)(n.code,{children:"git checkout master"})]}),"\n",(0,o.jsxs)(n.li,{children:["Upgrade MDK","\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Via pip: ",(0,o.jsx)(n.code,{children:"sudo pip install moodle-sdk --upgrade"})]}),"\n",(0,o.jsxs)(n.li,{children:["Via Homebrew: ",(0,o.jsx)(n.code,{children:"brew upgrade moodle-sdk"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Run MDK doctor to fix its ",(0,o.jsx)(n.code,{children:"masterBranch"})," configuration. ",(0,o.jsx)(n.code,{children:"mdk doctor --fix --masterbranch"})]}),"\n",(0,o.jsxs)(n.li,{children:["Run MDK doctor to check the master instances. ",(0,o.jsx)(n.code,{children:"mdk doctor --all"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"If you don't see an error saying something like \"stable_master is on branch master instead of MOODLE_XX_STABLE\", then you're all good. Otherwise, do a hard reset your master instances:"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"mdk update -c\ncd ~/moodles/[integration/stable]_master\ngit checkout master\ngit fetch `mdk config show upstreamRemote`\ngit reset --hard `mdk config show upstreamRemote`/master\n"})}),"\n",(0,o.jsx)(n.h2,{id:"the-mdk-suite",children:"The MDK Suite"}),"\n",(0,o.jsxs)(n.p,{children:["Some other tools have been developed using the name MDK as they are considered as part of the development kit but are often mistaken with the ",(0,o.jsx)(n.strong,{children:"real"})," MDK. The ",(0,o.jsx)(n.strong,{children:"real"})," MDK is the command line tool described above."]}),"\n",(0,o.jsx)(n.h3,{id:"mdk-browser-extension",children:"MDK Browser Extension"}),"\n",(0,o.jsxs)(n.p,{children:["Available for both ",(0,o.jsx)(n.a,{href:"https://addons.mozilla.org/en-US/firefox/addon/mdk-browser-extension/",children:"Firefox"})," and ",(0,o.jsx)(n.a,{href:"https://chrome.google.com/webstore/detail/mdk-browser-extension/iadpkkojcdoflinpncpkbonnhdlaicnc",children:"Chrome"}),", this is a browser extension that allows quick access to useful user-scripts. The scripts add functionality to Moodle.org, Moodle Tracker and your Moodle instances. You can find more information about it on its ",(0,o.jsx)(n.a,{href:"https://github.com/danpoltawski/userscripts-moodle",children:"public repository"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"mdk-authentication",children:"MDK Authentication"}),"\n",(0,o.jsxs)(n.p,{children:["This is an authentication plugin for Moodle 2.x, which not only creates the user if it does not exist in the database yet, but also enrols it as a student, teacher or manager in all the available courses. More information about this plugin is available on the ",(0,o.jsx)(n.a,{href:"https://github.com/FMCorz/moodle-auth_mdk",children:"public repository"}),"."]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}}}]);