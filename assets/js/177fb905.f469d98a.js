"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[57022],{20015:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>a,contentTitle:()=>d,default:()=>m,frontMatter:()=>t,metadata:()=>r,toc:()=>c});var l=n(74848),i=n(28453),s=n(78924);const t={title:"PHP CodeSniffer",tags:["coding style","policies","tools"]},d=void 0,r={id:"development/tools/phpcs",title:"PHP CodeSniffer",description:"PHPCodeSniffer is a tool used to analyse PHP code using a set of rules. In many cases these rules can be used to automatically fix the errors they identify.",source:"@site/general/development/tools/phpcs.md",sourceDirName:"development/tools",slug:"/development/tools/phpcs",permalink:"/moodledevdocs/general/development/tools/phpcs",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/general/development/tools/phpcs.md",tags:[{label:"coding style",permalink:"/moodledevdocs/general/tags/coding-style"},{label:"policies",permalink:"/moodledevdocs/general/tags/policies"},{label:"tools",permalink:"/moodledevdocs/general/tags/tools"}],version:"current",lastUpdatedBy:"Andrew Nicols",lastUpdatedAt:1713332374e3,frontMatter:{title:"PHP CodeSniffer",tags:["coding style","policies","tools"]},sidebar:"coding",previous:{title:"NodeJS and Grunt",permalink:"/moodledevdocs/general/development/tools/nodejs"},next:{title:"PHPUnit",permalink:"/moodledevdocs/general/development/tools/phpunit"}},a={},c=[{value:"Installation",id:"installation",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Moodle 3.10 and earlier",id:"moodle-310-and-earlier",level:4},{value:"Community plugins, and older Moodle versions",id:"community-plugins-and-older-moodle-versions",level:4},{value:"System-side default standard",id:"system-side-default-standard",level:4},{value:"Editor integrations",id:"editor-integrations",level:2},{value:"Advanced Usage",id:"advanced-usage",level:2},{value:"Ignoring warnings",id:"ignoring-warnings",level:3},{value:"Recursive analysis",id:"recursive-analysis",level:3},{value:"Other report formats",id:"other-report-formats",level:3},{value:"See also",id:"see-also",level:2}];function h(e){const o={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{Since:n}=o;return n||function(e,o){throw new Error("Expected "+(o?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Since",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.A,{frontMatter:t,metadata:r}),"\n",(0,l.jsxs)(o.p,{children:[(0,l.jsx)(o.a,{href:"https://github.com/squizlabs/PHP_CodeSniffer",children:"PHPCodeSniffer"})," is a tool used to analyse PHP code using a set of rules. In many cases these rules can be used to automatically fix the errors they identify."]}),"\n",(0,l.jsxs)(o.p,{children:["Moodle has two sets of published rule-sets intended to meet the ",(0,l.jsx)(o.a,{href:"/moodledevdocs/general/development/policies/codingstyle/",children:"Moodle Coding Style"}),", and identify any parts of the code do not conform to this style. These are:"]}),"\n",(0,l.jsxs)(o.ul,{children:["\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"moodle"})," - The standard ruleset which meets all variants of the coding style"]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"moodle-extra"})," - The extended standard which includes recommended best practices"]}),"\n"]}),"\n",(0,l.jsxs)(o.p,{children:["We recommend use of the ",(0,l.jsx)(o.code,{children:"moodle-extra"})," standard, particularly when writing new code."]}),"\n",(0,l.jsx)(o.h2,{id:"installation",children:"Installation"}),"\n",(0,l.jsx)(o.p,{children:"The recommended method of installation is via the global composer command:"}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-console",children:"composer global config minimum-stability dev\ncomposer global require moodlehq/moodle-cs\n"})}),"\n",(0,l.jsx)(o.p,{children:"This ensures that you have a single copy of the standard used for all code."}),"\n",(0,l.jsx)(o.p,{children:"Updates to the CodeSniffer are not applied automatically. To determine if updates are required, run the following via the command line:"}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-console",children:"composer global show -l\n"})}),"\n",(0,l.jsx)(o.p,{children:"To apply updates:"}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-console",children:"composer global update\n"})}),"\n",(0,l.jsx)(o.h3,{id:"configuration",children:"Configuration"}),"\n",(0,l.jsx)(n,{versions:["4.1.0","4.0.1","3.11.7"],issueNumber:"MDL-74511"}),"\n",(0,l.jsx)(o.p,{children:"A PHPCS configuration is included in the Moodle codebase and ensures that the correct phpcs ruleset is always used for the Moodle codebase."}),"\n",(0,l.jsxs)(o.p,{children:["This can be further extended by generating an additional configuration to ignore all third-party libraries using the ",(0,l.jsx)(o.code,{children:"grunt ignorefiles"})," command. See ",(0,l.jsx)(o.a,{href:"/moodledevdocs/general/development/tools/nodejs#grunt",children:"grunt"})," for further information on using Grunt."]}),"\n",(0,l.jsxs)(o.p,{children:["If you would like to make use of the ",(0,l.jsx)(o.code,{children:"moodle-extra"})," standard then you should create a ",(0,l.jsx)(o.code,{children:".phpcs.xml"})," file with the following content:"]}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8"?>\n<ruleset name="MoodleCore">\n  <rule ref="./phpcs.xml"/>\n  <rule ref="moodle-extra"/>\n</ruleset>\n'})}),"\n",(0,l.jsx)(o.p,{children:"This will extend the standard configuration, and apply the extra standard on top of it."}),"\n",(0,l.jsx)(o.h4,{id:"moodle-310-and-earlier",children:"Moodle 3.10 and earlier"}),"\n",(0,l.jsx)(o.p,{children:"The easiest way to have PHP CodeSniffer pick up your preferred style is via a local configuration file."}),"\n",(0,l.jsxs)(o.p,{children:["You can create a file named ",(0,l.jsx)(o.code,{children:".phpcs.xml"})," with the following contents:"]}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8"?>\n<ruleset name="MoodleCore">\n  <rule ref="moodle"/>\n</ruleset>\n'})}),"\n",(0,l.jsxs)(o.p,{children:["If you wish to use the ",(0,l.jsx)(o.code,{children:"moodle-extra"})," coding style, then you can use the following content:"]}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8"?>\n<ruleset name="MoodleCore">\n  <rule ref="moodle-extra"/>\n</ruleset>\n'})}),"\n",(0,l.jsx)(o.admonition,{type:"info",children:(0,l.jsx)(o.p,{children:"Third-party library code will not be ignored with these versions of Moodle."})}),"\n",(0,l.jsx)(o.admonition,{title:"Ignoring the file with Git",type:"tip",children:(0,l.jsxs)(o.p,{children:["We recommend configuring your code checkout to ignore the ",(0,l.jsx)(o.code,{children:".phpcs.xml"})," file by adding a local ignore record to ",(0,l.jsx)(o.code,{children:".git/info/exclude"})]})}),"\n",(0,l.jsx)(o.h4,{id:"community-plugins-and-older-moodle-versions",children:"Community plugins, and older Moodle versions"}),"\n",(0,l.jsxs)(o.p,{children:["If you are developing your own plugin outside of the main Moodle directory, or you are working with an older version of Moodle, the easiest way to configure phpcs to use the Moodle ruleset is by creating a local ",(0,l.jsx)(o.code,{children:"phpcs.xml.dist"})," configuration at the root directory of your repository with the following content:"]}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8"?>\n<ruleset name="MoodleCore">\n  <rule ref="moodle"/>\n</ruleset>\n'})}),"\n",(0,l.jsx)(o.p,{children:"If you do not wish to include this file in your repository, or you are using an older version of Moodle, then you should add this to your local gitignore files. On a Unix-like system this can be achieved with:"}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-console",children:"echo phpcs.xml.dist >> .git/info/exclude\n"})}),"\n",(0,l.jsxs)(o.admonition,{type:"info",children:[(0,l.jsxs)(o.p,{children:["The ",(0,l.jsx)(o.code,{children:".git/info/exclude"})," file is a per-repository version of the ",(0,l.jsx)(o.code,{children:".gitignore"})," file. Whilst ",(0,l.jsx)(o.code,{children:".gitignore"})," is tracked within the Moodle codebase and a version is shipped with Moodle, the ",(0,l.jsx)(o.code,{children:".git/info/exclude"})," file is local to your git clone."]}),(0,l.jsxs)(o.p,{children:["See the ",(0,l.jsx)(o.a,{href:"https://git-scm.com/docs/gitignore",children:"gitignore"})," documentation for more information on the gitignore feature."]})]}),"\n",(0,l.jsx)(o.h4,{id:"system-side-default-standard",children:"System-side default standard"}),"\n",(0,l.jsx)(o.p,{children:"Although not recommended, you can configure the Moodle ruleset as the system-wide default for phpcs:"}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-php",children:"phpcs --config-set default_standard moodle\n"})}),"\n",(0,l.jsx)(o.admonition,{title:"Not recommended",type:"important",children:(0,l.jsxs)(o.p,{children:["This approach is ",(0,l.jsx)(o.strong,{children:"not recommended"})," and is only preserved for reference."]})}),"\n",(0,l.jsx)(o.h2,{id:"editor-integrations",children:"Editor integrations"}),"\n",(0,l.jsx)(o.p,{children:"Many modern editors and IDEs will natively integrate with PHPCodeSniffer, and since Moodle versions 3.11.7, 4.0.1, and 4.1.0, no additional configuration is required."}),"\n",(0,l.jsxs)(o.p,{children:["For older versions many editors will allow you to manually configure the PHPCodeSniffer standard to use, for example, the ",(0,l.jsx)(o.a,{href:"https://marketplace.visualstudio.com/items?itemName=obliviousharmony.vscode-php-codesniffer",children:"VS Code PHPCodeSniffer extension"})," can be configured in this way."]}),"\n",(0,l.jsx)(o.p,{children:'If you get the error: \'ERROR: Referenced sniff "moodle" does not exist\', you may need to specify the location of the CodeSniffer in your IDE. Note the location when installing, and add that to the settings. e.g. "Exec: Linux": "/home/xxxx/.config/composer/vendor/bin/phpcs"; and select "Automatic" as the Standard.'}),"\n",(0,l.jsx)(o.h2,{id:"advanced-usage",children:"Advanced Usage"}),"\n",(0,l.jsx)(o.h3,{id:"ignoring-warnings",children:"Ignoring warnings"}),"\n",(0,l.jsx)(o.p,{children:"You can run the CodeSniffer with the -n flag to ignore warnings:"}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-console",children:"phpcs -n index.php\n--------------------------------------------------------------------------------\nFOUND 139 ERROR(S) AFFECTING 125 LINE(S)\n--------------------------------------------------------------------------------\n  28 | ERROR | line indented incorrectly; expected 0 spaces, found 4\n  50 | ERROR | line indented incorrectly; expected 0 spaces, found 4\n...\n"})}),"\n",(0,l.jsx)(o.h3,{id:"recursive-analysis",children:"Recursive analysis"}),"\n",(0,l.jsx)(o.p,{children:"If you give the name of a folder instead of a file, it will search, analyse and report on all PHP files found in this folder and all its subfolders. This will produce a full report for each PHP file. Since this is likely to be too much information, you may want to print only a summary report, by using the following syntax (search the files/ folder as an example):"}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-console",children:"phpcs --report=summary blocks/html\nPHP CODE SNIFFER REPORT SUMMARY\n-----------------------------------------------------------------------------------------------------------------------\nFILE                                                                                                   ERRORS  WARNINGS\n-----------------------------------------------------------------------------------------------------------------------\n/var/www/html/moodle/blocks/html/block_html.php                                       24      0\n/var/www/html/moodle/blocks/html/edit_form.php                                        16      0\n/var/www/html/moodle/blocks/html/lib.php                                              11      0\n/var/www/html/moodle/blocks/html/settings.php                                         6       0\n/var/www/html/moodle/blocks/html/backup/moodle2/backup_html_block_task.class.php      2       0\n/var/www/html/moodle/blocks/html/backup/moodle2/restore_html_block_task.class.php     3       0\n/var/www/html/moodle/blocks/html/classes/privacy/provider.php                         13      0\n/var/www/html/moodle/blocks/html/classes/search/content.php                           6       0\n/var/www/html/moodle/blocks/html/tests/search_content_test.php                        6       0\n-----------------------------------------------------------------------------------------------------------------------\nA TOTAL OF 87 ERRORS AND 0 WARNINGS WERE FOUND IN 9 FILES\n-----------------------------------------------------------------------------------------------------------------------\nPHPCBF CAN FIX 75 OF THESE SNIFF VIOLATIONS AUTOMATICALLY\n-----------------------------------------------------------------------------------------------------------------------\n\nTime: 626ms; Memory: 16MB\n"})}),"\n",(0,l.jsx)(o.h3,{id:"other-report-formats",children:"Other report formats"}),"\n",(0,l.jsx)(o.p,{children:"CodeSniffer can export its reports in the following formats:"}),"\n",(0,l.jsxs)(o.ol,{children:["\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"full"}),": default, shown first above"]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"summary"}),": also shown above"]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"xml"}),": Simple XML format"]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"csv"}),": Comma-separated list"]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"checkstyle"}),": XML format intended for use with CruiseControl"]}),"\n"]}),"\n",(0,l.jsx)(o.h2,{id:"see-also",children:"See also"}),"\n",(0,l.jsxs)(o.ol,{children:["\n",(0,l.jsx)(o.li,{children:(0,l.jsx)(o.a,{href:"/moodledevdocs/general/development/policies",children:"Coding"})}),"\n",(0,l.jsx)(o.li,{children:(0,l.jsx)(o.a,{href:"/moodledevdocs/general/development/policies/codingstyle/",children:"Coding style"})}),"\n"]})]})}function m(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,l.jsx)(o,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}}}]);