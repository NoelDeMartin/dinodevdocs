"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[75558],{99538:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var o=i(74848),t=i(28453),s=i(78924);const a={title:"YUI Modules",tags:["Javascript","YUI"]},r=void 0,l={id:"guides/javascript/yui/modules",title:"YUI Modules",description:"As of Moodle 2.9 we are transitioning away from YUI to AMD modules. This transition will take a long time, but it is important because the YUI team have stopped all new development on the YUI library. See JavaScript Modules for more information.",source:"@site/versioned_docs/version-4.1/guides/javascript/yui/modules.md",sourceDirName:"guides/javascript/yui",slug:"/guides/javascript/yui/modules",permalink:"/moodledevdocs/docs/4.1/guides/javascript/yui/modules",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/versioned_docs/version-4.1/guides/javascript/yui/modules.md",tags:[{label:"Javascript",permalink:"/moodledevdocs/docs/4.1/tags/javascript"},{label:"YUI",permalink:"/moodledevdocs/docs/4.1/tags/yui"}],version:"4.1",lastUpdatedBy:"Andrew Nicols",lastUpdatedAt:1713332374e3,frontMatter:{title:"YUI Modules",tags:["Javascript","YUI"]},sidebar:"docs",previous:{title:"YUI",permalink:"/moodledevdocs/docs/4.1/guides/javascript/yui/"},next:{title:"YUI Namespacing",permalink:"/moodledevdocs/docs/4.1/guides/javascript/yui/namespacing"}},d={},c=[{value:"YUI modules",id:"yui-modules",level:2},{value:"What is a module and why would I want to use one?",id:"what-is-a-module-and-why-would-i-want-to-use-one",level:3},{value:"Structure and naming",id:"structure-and-naming",level:3},{value:"Including your module from your PHP code",id:"including-your-module-from-your-php-code",level:3},{value:"Passing arguments from your PHP to your module",id:"passing-arguments-from-your-php-to-your-module",level:4},{value:"A basic module",id:"a-basic-module",level:3},{value:"Namespacing",id:"namespacing",level:4},{value:"Initialisation",id:"initialisation",level:4},{value:"Separation of code from configuration and style (loose coupling)",id:"separation-of-code-from-configuration-and-style-loose-coupling",level:4},{value:"Additional functions instead of anonymous functions",id:"additional-functions-instead-of-anonymous-functions",level:4}];function u(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components},{DeprecatedSince:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("DeprecatedSince",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.A,{frontMatter:a,metadata:l}),"\n",(0,o.jsx)(i,{versions:["2.9"]}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsxs)(n.p,{children:["As of Moodle 2.9 we are transitioning away from YUI to AMD modules. This transition will take a long time, but it is important because the YUI team have ",(0,o.jsx)(n.a,{href:"http://yahooeng.tumblr.com/post/96098168666/important-announcement-regarding-yui",children:"stopped all new development on the YUI library"}),". See ",(0,o.jsx)(n.a,{href:"https://docs.moodle.org/dev/_Javascript_Modules_",children:"JavaScript Modules"})," for more information."]})}),"\n",(0,o.jsx)(n.h2,{id:"yui-modules",children:"YUI modules"}),"\n",(0,o.jsxs)(n.p,{children:["You may want to ",(0,o.jsx)(n.a,{href:"#additional-functions-instead-of-anonymous-functions",children:"Jump straight to the complete example"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"what-is-a-module-and-why-would-i-want-to-use-one",children:"What is a module and why would I want to use one?"}),"\n",(0,o.jsxs)(n.p,{children:["Many people are used to writing their JavaScript code either inline, or in a separate file included using ",(0,o.jsx)(n.code,{children:"<script>"})," tags in their HTML. Although both of these are supported within Moodle, we highly recommend investing a little time in looking into the ",(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.1/guides/javascript/yui/",children:"YUI"})," module system as it offers some really great features which will benefit you in the long run."]}),"\n",(0,o.jsx)(n.p,{children:"These features and benefits include:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"a host of existing modules that you can hook into and use; which offer"}),"\n",(0,o.jsx)(n.li,{children:"code sandboxing to ensure that you always have a good/clean copy of the code; with"}),"\n",(0,o.jsx)(n.li,{children:"powerful dependency management; which can utilise"}),"\n",(0,o.jsx)(n.li,{children:"asynchronous loading to load dependencies in parallel; and"}),"\n",(0,o.jsx)(n.li,{children:"loading of dependencies in any order (you don't have to include script tags in a set order); and"}),"\n",(0,o.jsx)(n.li,{children:"separation of loading from execution; and"}),"\n",(0,o.jsx)(n.li,{children:"combo loading to reduce the number of individual HTTP transactions."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"By using existing modules in your code, you can benefit in other ways too, such as:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"a consistent look and feel across Moodle; and"}),"\n",(0,o.jsx)(n.li,{children:"most of the edge cases already catered for."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The Moodle community is in the process of improving much of its JavaScript in areas such as code, documentation, and processes. This includes updating older code, adding documentation, seeding dependency information for modules to improve load efficiency for browsers, and much more."}),"\n",(0,o.jsx)(n.p,{children:"You may find the following resources particularly helpful:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.1/guides/javascript/yui/",children:"YUI"}),"; and"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"structure-and-naming",children:"Structure and naming"}),"\n",(0,o.jsx)(n.p,{children:"A YUI module is structured in a particular way, both on file, and in the file itself. Before you start writing your module, you need to know a few pieces of information:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["what is the ",(0,o.jsx)(n.a,{href:"/general/development/policies/codingstyle/frankenstyle",children:"Frankenstyle"})," name of your Moodle plugin;"]}),"\n",(0,o.jsx)(n.li,{children:"what does your YUI module do in a single word."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"You can use these pieces of information to work out the namespace for your\nplugin. This namespace fits into the template:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"moodle-FRANKENSTYLE-MODULENAME\n"})}),"\n",(0,o.jsxs)(n.p,{children:["As an example, writing a plugin for the fictional ",(0,o.jsx)(n.code,{children:"fruit"})," ",(0,o.jsx)(n.strong,{children:"block"})," which offers fruit to users:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["you may decide to call this module the ",(0,o.jsx)(n.code,{children:"fruitbowl"})," as the module offers fruit to users, and presents it in an appealing way so that they can see it."]}),"\n",(0,o.jsx)(n.li,{children:"The block is fruit, therefore the frankenstyle name is block_fruit."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Therefor the name for this module will be:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"moodle-block_fruit-fruitbowl\n"})}),"\n",(0,o.jsx)(n.p,{children:"The other thing that you need to know in order to create your first module is where in your plugin the code needs to be."}),"\n",(0,o.jsxs)(n.p,{children:["The code will need to go in your plugin directory inside a ",(0,o.jsx)(n.code,{children:"yui"})," directory. Since Moodle 2.5, the structure for this directory is:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"yui/\n|-- src\n    |-- fruitbowl\n        |-- build.json\n        |-- js\n        |   |-- fruitbowl.js\n        |-- meta\n        |   |-- fruitbowl.json\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"Note: Moodle 2.5 onwards is backwards compatibly with the previous structure."})}),"\n",(0,o.jsxs)(n.p,{children:["So in the case of ",(0,o.jsx)(n.code,{children:"moodle-block_fruit-fruitbowl"}),", the JavaScript code will need to go into:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"/block/fruit/yui/src/fruitbowl/js/fruitbowl.js\n"})}),"\n",(0,o.jsx)(n.p,{children:"(Sorry, it does look a little more complicated than it really is)"}),"\n",(0,o.jsx)(n.p,{children:"Now that you know where your code needs to be on disk, you can actually include and write it."}),"\n",(0,o.jsx)(n.h3,{id:"including-your-module-from-your-php-code",children:"Including your module from your PHP code"}),"\n",(0,o.jsxs)(n.p,{children:["Rather than using ",(0,o.jsx)(n.code,{children:"<script>"})," tags to include JavaScript code, Moodle makes\nuse of the YUI loader and a single inline script tag in the page footer."]}),"\n",(0,o.jsx)(n.p,{children:"Moving JavaScript to a page footer is important to the perceived performance of a page, and the YUI loader helps further."}),"\n",(0,o.jsxs)(n.p,{children:["The YUI loader also intelligently loads page dependencies, in as few requests as possible by making use of a combo-loader system. It will also attempt to use the appropriate version of your JavaScript depending on your ",(0,o.jsx)(n.code,{children:"$CFG->jsrev"})," settings. In normal operation, a minified version of your code is used; and with ",(0,o.jsx)(n.code,{children:"$CFG->cachejs"})," false, then a debugging version is used."]}),"\n",(0,o.jsxs)(n.p,{children:["To ensure that your module is loaded, there is a ",(0,o.jsx)(n.code,{children:"yui_module()"})," function on the page requirements class. This can be accessed using:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"$PAGE->requires->yui_module();\n// or:\n$this->page->requires->yui_module();\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"yui_module"})," function takes the module name, and the init function to call as it's first two arguments, and an optional list of arguments as a third argument:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"$PAGE->requires->yui_module(\n    'moodle-block_fruit-fruitbowl',\n    'M.block_fruit.fruitbowl.init'\n);\n"})}),"\n",(0,o.jsx)(n.h4,{id:"passing-arguments-from-your-php-to-your-module",children:"Passing arguments from your PHP to your module"}),"\n",(0,o.jsx)(n.p,{children:"You may want to pass a set of arguments to your JavaScript. You can do so\nusing the optional third argument to yui_module which accepts an array of\narguments."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"$PAGE->requires->yui_module('moodle-block_fruit-fruitbowl', 'M.block_fruit.fruitbowl.init',[\n    'value1',\n    'value2',\n]);\n"})}),"\n",(0,o.jsx)(n.p,{children:"These will be presented to the JavaScript function you name:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"init = function(argument1, argument2) {\n    // Use the arguments here.\n};\n"})}),"\n",(0,o.jsx)(n.p,{children:"Often it makes more sense to pass a single argument with an associative array:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"$PAGE->requires->yui_module('moodle-block_fruit-fruitbowl', 'M.block_fruit.fruitbowl.init',\n[[\n    'key1' => 'value1',\n    'key2' => 'value2',\n]]);\n"})}),"\n",(0,o.jsx)(n.p,{children:"These will be presented to the JavaScript function you name:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"init = function(params) {\n    // Use the arguments through params.key1 and params.key2.\n};\n"})}),"\n",(0,o.jsx)(n.h3,{id:"a-basic-module",children:"A basic module"}),"\n",(0,o.jsx)(n.p,{children:"The most common use-case for JavaScript in Moodle is to utilise existing modules to do something. Your module isn't intended to be reused, or extended by some other piece of code. In these cases, you want to keep things simple."}),"\n",(0,o.jsxs)(n.p,{children:["This section will build up the YUI module gradually, but you can cheat and skip to the ",(0,o.jsx)(n.a,{href:"https://docs.moodle.org/dev/#Additional_functions_instead_of_anonymous_functions",children:"completed example"}),"."]}),"\n",(0,o.jsx)(n.h4,{id:"namespacing",children:"Namespacing"}),"\n",(0,o.jsx)(n.p,{children:"One of the great benefits of using YUI is the ability to sandbox code in such a way that you can be sure that it won't interfere with other JS code in Moodle, this is done by placing your object in a JavaScript object. Using our fictitious example, this namespace is very similar to the module name namespace:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"M.FRANKENSTYLE.MODNAME\n"})}),"\n",(0,o.jsx)(n.p,{children:"As a JavaScript object this would look like:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:"M: {\n  FRANKENSTYLE: {\n    MODNAME: {\n      // Your code and functions go here.\n    }\n  }\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"The easiest way of creating this structure is by using the logical OR operator."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"M.block_fruit = M.block_fruit || {};\nM.block_fruit.fruitbowl = {};\nvar NS = M.block_fruit.fruitbowl;\n"})}),"\n",(0,o.jsx)(n.p,{children:"This ensures that any existing code on the M.block_fruit object is not inadvertently overwritten, but also ensures that the definition for the fruitbowl code is clean."}),"\n",(0,o.jsx)(n.p,{children:"That's to say that, if you have already used your fruitbowl code once on the page, and have modified it in some way (for example to override a function), then the next time it is used, it will be in it's original state with the original function."}),"\n",(0,o.jsx)(n.h4,{id:"initialisation",children:"Initialisation"}),"\n",(0,o.jsx)(n.p,{children:"Once you have your namespace, you'll want to create one or more functions on this namespace in which to put your code. Typically, we use an 'init' function to perform the initial setup. The amount that this code does should be kept to a minimum because every piece of JavaScript which has to be executed at page load is a piece of code slowing the page down. As a best practice:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"don't modify the DOM unless you need to do so;"}),"\n",(0,o.jsx)(n.li,{children:"don't create anything you aren't using immediately (for example a JS dialogue hidden until first used); and"}),"\n",(0,o.jsx)(n.li,{children:"use event delegation where possible."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"M.block_fruit = M.block_fruit || {};\nvar NS = M.block_fruit.fruitbowl = {};\n\nNS.init = function() {\n    Y.delegate('click', function(e) {\n        // Alert users when they've clicked on some fruit to tell them the obvious.\n        alert(\"You clicked on some fruit\");\n\n        // Add a border to the fruit so we can see that it was selected.\n        e.setStyle('border', '1px solid black');\n    }, Y.config.doc, '.fruit');\n};\n"})}),"\n",(0,o.jsx)(n.h4,{id:"separation-of-code-from-configuration-and-style-loose-coupling",children:"Separation of code from configuration and style (loose coupling)"}),"\n",(0,o.jsx)(n.p,{children:"As another best practice, we encourage you to separate out the code from configuration, and not to apply any CSS styles directly. Instead, use techniques to move the configuration out of the code itself and into variables or attributes, and use CSS classes which the theme can modify."}),"\n",(0,o.jsx)(n.p,{children:"Typically to make it easier to read your code, and to modify it later, we recommend creating two static objects at the top of your code: one for CSS selectors, and one for CSS class names."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"var CSS = {\n    FRUIT: 'fruit',\n    SELECTED: 'selected'\n};\nvar SELECTORS = {\n    FRUIT: '.' + CSS.FRUIT\n};\nvar NS;\n\nM.block_fruit = M.block_fruit || {};\nNS = M.block_fruit.fruitbowl = {};\n\nNS.init = function() {\n    Y.delegate('click', function() {\n        // Alert users when they've clicked on some fruit to tell them the obvious.\n        alert(\"You clicked on some fruit\");\n\n        // Apply the relevant class which contains indications that this fruit was selected.\n        e.target.addClass(CSS.SELECTED);\n    }, Y.config.doc, SELECTORS.FRUIT, this);\n};\n"})}),"\n",(0,o.jsx)(n.p,{children:"With this change, if at a later date you need to change the styling on a selected fruit, this can be done in the theme. An alternative theme can also choose to theme the same item in a completely different way."}),"\n",(0,o.jsx)(n.p,{children:"It also means that if you need to change the class names, you can do so once in the JavaScript without making it difficult to work out the purpose of a particular line of code from git."}),"\n",(0,o.jsx)(n.h4,{id:"additional-functions-instead-of-anonymous-functions",children:"Additional functions instead of anonymous functions"}),"\n",(0,o.jsx)(n.p,{children:"Although it's often quicker to write an inline anonymous function when you write your event handlers, loops, and at other times, it's often much easier to read the code if you move it to a function on your namespace and call it accordingly."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"var CSS = {\n        FRUIT: 'fruit',\n        SELECTED: 'selected'\n    },\n    SELECTORS = {\n        FRUIT: '.' + CSS.FRUIT\n    },\n    NS;\n\nM.block_fruit = M.block_fruit || {};\nNS = M.block_fruit.fruitbowl = {};\n\nNS.init = function() {\n    Y.delegate('click', this.handle_selection, Y.config.doc, SELECTORS.FRUIT, this);\n};\n\nNS.handle_selection = function(e) {\n    // Alert users when they've clicked on some fruit to tell them the obvious.\n    alert(\"You clicked on some fruit\");\n\n    // Apply the relevant class which contains indications that this fruit was selected.\n    e.target.addClass(CSS.SELECTED);\n};\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Now you can clearly see your what your initialiser does, and you can call ",(0,o.jsx)(n.code,{children:"handle_selection"})," for other events too without duplicating code."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}}}]);