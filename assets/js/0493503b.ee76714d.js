"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[19423],{46267:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>d,default:()=>p,frontMatter:()=>l,metadata:()=>c,toc:()=>u});var i=t(74848),s=t(28453),o=t(78924);const r="const getModal = questionBody => {\n    return ModalFactory.create({\n        title: getString('my_title', 'mod_example'),\n        body: renderTemplate('mod_example/example_body', questionBody),\n        removeOnClose: true,\n    })\n    .then(modal => {\n        modal.show();\n\n        return modal;\n    });\n};\n",a="import {getString} from 'core/str';\n\ngetString('close', 'core')\n.then((closeString) => {\n    window.console.log(closeString);\n\n    return closeString;\n})\n.catch();\n",l={title:"JavaScript"},d=void 0,c={id:"guides/javascript/index",title:"JavaScript",description:"Moodle makes heavy use of JavaScript to improve the experience for its users.",source:"@site/versioned_docs/version-4.3/guides/javascript/index.md",sourceDirName:"guides/javascript",slug:"/guides/javascript/",permalink:"/moodledevdocs/docs/4.3/guides/javascript/",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/versioned_docs/version-4.3/guides/javascript/index.md",tags:[],version:"4.3",lastUpdatedBy:"Andrew Nicols",lastUpdatedAt:1713332374e3,frontMatter:{title:"JavaScript"},sidebar:"docs",previous:{title:"Git for developers",permalink:"/moodledevdocs/docs/4.3/guides/git/"},next:{title:"AJAX",permalink:"/moodledevdocs/docs/4.3/guides/javascript/ajax/"}},h={},u=[{value:"Useful References",id:"useful-references",level:2},{value:"Modules",id:"modules",level:2},{value:"Writing your first module",id:"writing-your-first-module",level:2},{value:"Listen to a DOM Event",id:"listen-to-a-dom-event",level:3},{value:"Including JavaScript from your pages",id:"including-javascript-from-your-pages",level:2},{value:"Including from a template",id:"including-from-a-template",level:3},{value:"Including from PHP",id:"including-from-php",level:3},{value:"Passing data to your Module",id:"passing-data-to-your-module",level:2},{value:"Using data attributes",id:"using-data-attributes",level:3},{value:"Promises",id:"promises",level:2},{value:"Examples",id:"examples",level:3},{value:"Working with Strings",id:"working-with-strings",level:2},{value:"Templates",id:"templates",level:2},{value:"Modals",id:"modals",level:2},{value:"Notifications",id:"notifications",level:2},{value:"AJAX Calls",id:"ajax-calls",level:2},{value:"Preferences",id:"preferences",level:2},{value:"Prefetch",id:"prefetch",level:2},{value:"Reactive state",id:"reactive-state",level:2},{value:"Tools",id:"tools",level:2},{value:"Grunt",id:"grunt",level:3},{value:"Installing grunt",id:"installing-grunt",level:4},{value:"Using grunt",id:"using-grunt",level:4},{value:"ESLint",id:"eslint",level:3}];function m(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components},{CodeBlock:t,Since:d,TabItem:h,Tabs:u}=n;return t||j("CodeBlock",!0),d||j("Since",!0),h||j("TabItem",!0),u||j("Tabs",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.A,{frontMatter:l,metadata:c}),"\n",(0,i.jsx)(n.p,{children:"Moodle makes heavy use of JavaScript to improve the experience for its users."}),"\n",(0,i.jsx)(n.p,{children:"All new JavaScript in Moodle should use the ES2015+ module format, which is\ntranspiled into the CommonJS format.\nModules are loaded in the browser using the RequireJS loader."}),"\n",(0,i.jsx)(n.p,{children:"All Moodle JavaScript can use the same Mustache templates and translated strings which are available to Moodle PHP code, and the standard Moodle web service framework can be used to fetch and store data."}),"\n",(0,i.jsx)(n.p,{children:"This guide covers how to get started with JavaScript in Moodle, and introduces key concepts and features including module format and structure, including your code, using templates, using translation features, tooling, and handling events."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["You may see the terms ",(0,i.jsx)(n.code,{children:"ES6"})," and ",(0,i.jsx)(n.code,{children:"ES2015"})," used interchangeably.\nES2015 is the 6th generation of the Ecma Script specification.\nES2015 represents a big change from previous versions of the Ecma Script\nspecification."]})}),"\n",(0,i.jsx)(n.h2,{id:"useful-references",children:"Useful References"}),"\n",(0,i.jsx)(n.p,{children:"Moodle uses vanilla JavaScript combined with helpers for performing common actions, and a small collection of libraries\nfor serving and managing dependencies."}),"\n",(0,i.jsx)(n.p,{children:"The JavaScript documentation available on the Mozilla Developer Network is one of the best reference documentations\navailable. You may find the following references particularly useful:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript",children:"MDN JavaScript guide"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference",children:"MDN JavaScript Reference"}),"."]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://devhints.io/es6",children:"ES2015+ Cheat-sheet"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"modules",children:"Modules"}),"\n",(0,i.jsx)(n.p,{children:"JavaScript in Moodle is structured into ES2015 modules which are transpiled into the CommonJS format."}),"\n",(0,i.jsxs)(n.p,{children:["Like our PHP classes and Mustache templates, our JavaScript modules each belong to a particular ",(0,i.jsx)(n.code,{children:"component"}),"\nand must be named according to our standard ",(0,i.jsx)(n.a,{href:"/general/development/policies/naming#javascript",children:"name and namespace conventions"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"The naming scheme for Moodle's JavaScript fits into the pattern:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"[component_name]/[optional/sub/namespace/][modulename]"})}),"\n",(0,i.jsxs)(n.p,{children:["The first directory in any subfolder must be either a Moodle API, or ",(0,i.jsx)(n.code,{children:"local"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"The following are examples of valid module names:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"// For a module named `discussion` in the `mod_forum` component:\nmod_forum/discussion\n\n// For a module named `grader` in the `mod_assign` component which is\n// part of the `grades` API:\nmod_assign/grades/grader\n\n// For a module named `confirmation` in the `block_newsitems` component\n// which is a modal and not part of a core API:\nblock_newsitems/local/modal/confirmation\n\n// For a module name `selectors` in the `core_user` component and relates\n// to the `participants` module:\ncore_user/local/participants/selectors\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"tip",children:[(0,i.jsx)(n.p,{children:"When structuring a new module you may find it clearer to create a main entry-point module with related modules stored in\na subdirectory."}),(0,i.jsxs)(n.p,{children:["For example when creating a new module which controls interactions on the Participants page and which is part of\nthe ",(0,i.jsx)(n.code,{children:"core_user"})," component you will create a ",(0,i.jsx)(n.code,{children:"participants"})," module.\nThe full namespace for this module will be ",(0,i.jsx)(n.code,{children:"core_user/participants"}),"."]}),(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"core_user/participants"})," module may interact with DOM elements which are identified by CSS Selectors.\nThe Moodle convention is to place the selectors in a ",(0,i.jsx)(n.code,{children:"selectors"})," module."]}),(0,i.jsxs)(n.p,{children:["The module will also call a set of Web Services.\nThe Moodle convention is to place calls to Web Services in a ",(0,i.jsx)(n.code,{children:"repository"})," module."]}),(0,i.jsxs)(n.p,{children:["Since ",(0,i.jsx)(n.code,{children:"participants"})," isn't a formal API in Moodle you must create your submodules in the ",(0,i.jsx)(n.code,{children:"local/participants"}),"\ndirectory."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:".\n\u251c\u2500\u2500 local\n\u2502\xa0\xa0 \u2514\u2500\u2500 participants\n\u2502\xa0\xa0     \u251c\u2500\u2500 repository.js       // core_user/local/participants/selectors\n\u2502\xa0\xa0     \u2514\u2500\u2500 selectors.js        // core_user/local/participants/repository\n\u2514\u2500\u2500 participants.js             // core_user/participants\n"})})]}),"\n",(0,i.jsx)(n.h2,{id:"writing-your-first-module",children:"Writing your first module"}),"\n",(0,i.jsxs)(n.p,{children:["The convention in Moodle is to have one JavaScript Module which is your initial entrypoint.\nThis usually provides a function called ",(0,i.jsx)(n.code,{children:"init"})," which you then ",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/web/javascript/reference/statements/export",children:"export"})," from the module.\nThis ",(0,i.jsx)(n.code,{children:"init"})," function will be called by Moodle."]}),"\n",(0,i.jsxs)(n.p,{children:["Your module will probably also have one or more dependencies which you will ",(0,i.jsx)(n.code,{children:"import"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"As you start to build out the structure of your code you will start to export more functions, as well as Objects,\nClasses, and other data structures."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["This guide isn't intended to teach you how to write JavaScript.\nIf you are new to JavaScript, you may want to start with the ",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Learn/Getting_started_with_the_web",children:"MDN JavaScript\nbasics guide"}),"."]})}),"\n",(0,i.jsxs)(n.p,{children:["A module which calls to the browser ",(0,i.jsx)(n.code,{children:"console.log"})," function would look like:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title="mod/example/lib/amd/src/helloworld.js"',children:"export const init = () => {\n    window.console.log('Hello, world!');\n};\n"})}),"\n",(0,i.jsxs)(n.p,{children:["In this example a new variable called ",(0,i.jsx)(n.code,{children:"init"})," is created and exported using\nthe ES2015 ",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/web/javascript/reference/statements/export",children:"export"})," keyword.\nThe variable is assigned an arrow function expression which takes no\narguments, and when executed will call the browser ",(0,i.jsx)(n.code,{children:"console.log"})," function\nwith the text ",(0,i.jsx)(n.code,{children:'"Hello, world!"'}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"listen-to-a-dom-event",children:"Listen to a DOM Event"}),"\n",(0,i.jsx)(n.p,{children:"Usually you will want to perform an action in response to a user\ninteracting with the page."}),"\n",(0,i.jsxs)(n.p,{children:["You can use the ",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener",children:"document.addEventListener()"})," method to do\nthis."]}),"\n",(0,i.jsxs)(n.p,{children:["To add a ",(0,i.jsx)(n.code,{children:"click"})," listener to the entire body you would write:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title="mod/example/lib/amd/src/helloworld.js"',children:"export const init = () => {\n    document.addEventListener('click', e => {\n        window.console.log(e.target);\n    });\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:"In this example any time that a user clicks anywhere on the document the item\nthat was clicked on will be logged to the browser console."}),"\n",(0,i.jsx)(n.p,{children:"Usually you won't want to listen for every click in the document but only for\nsome Elements in the page."}),"\n",(0,i.jsx)(n.p,{children:"If you wanted to display a browser alert every time a user clicks on a button,\nyou might have a template like the following example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-handlebars",metastring:'title="mod/example/templates/helloworld.mustache"',children:' <button data-action="mod_example/helloworld-update_button">Click me</button>\n'})}),"\n",(0,i.jsx)(n.p,{children:"You can write a listener which looks for clicks to this button:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title="mod/example/lib/amd/src/helloworld.js"',children:"const Selectors = {\n    actions: {\n        showAlertButton: '[data-action=\"mod_example/helloworld-update_button\"]',\n    },\n};\n\nexport const init = () => {\n    document.addEventListener('click', e => {\n        if (e.target.closest(Selectors.actions.showAlertButton)) {\n            window.alert(\"Thank you for clicking on the button\");\n        }\n    });\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:"This example shows several conventions that are used in Moodle:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["CSS Selectors are often stored separate to the code in a ",(0,i.jsx)(n.code,{children:"Selectors"}),"\nobject. This allows you to re-use a Selector and to group them\ntogether in different ways. It also places all selectors in one place so\nthat they're easier to update."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"Selectors"})," object is stored in a ",(0,i.jsx)(n.code,{children:"const"})," variable which is _not_\nexported. This means that it's private and only available within your\nmodule."]}),"\n",(0,i.jsxs)(n.li,{children:["A ",(0,i.jsx)(n.code,{children:"data-*"})," attribute is used to identify the button in the JavaScript\nmodule.\nMoodle advises not to use class selectors when attaching event listeners because\nso that it's easier to restyle for different themes without any changes to\nthe JavaScript later."]}),"\n",(0,i.jsxs)(n.li,{children:["A namespace is used for the ",(0,i.jsx)(n.code,{children:"data-action"})," to identify what the button is intended for."]}),"\n",(0,i.jsxs)(n.li,{children:["By using ",(0,i.jsx)(n.code,{children:"e.target.closest()"})," you can check whether the element that was\nclicked on, or any of its parent elements matches the supplied CSS Selector."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Instead of having one event listener for every button in your page, you can\nhave one event listener which checks which button was pressed.\nIf you have a template like the following:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-handlebars",metastring:'title="mod/example/templates/helloworld.mustache"',children:' <div>\n     <button data-action="mod_example/helloworld-update_button">Click me</button>\n     <button data-action="mod_example/helloworld-big_red_button">Do not click me</button>\n </div>\n'})}),"\n",(0,i.jsx)(n.p,{children:"Then you can write one event listener which looks at all buttons on the page.\nFor example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title="mod/example/lib/amd/src/local/helloworld/selectors.js"',children:'export default {\n    actions: {\n        showAlertButton: \'[data-action="mod_example/helloworld-update_button"],\n        bigRedButton: \'[data-action="mod_example/helloworld-big_red_button"],\n    },\n};\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title="mod/example/lib/amd/src/helloworld.js"',children:"import Selectors from './local/helloworld/selectors';\n\nconst registerEventListeners = () => {\n    document.addEventListener('click', e => {\n        if (e.target.closest(Selectors.actions.showAlertButton)) {\n            window.alert(\"Thank you for clicking on the button\");\n        }\n\n        if (e.target.closest(Selectors.actions.bigRedButton)) {\n            window.alert(\"You shouldn't have clicked on that one!\");\n        }\n    });\n};\n\nexport const init = () => {\n    registerEventListeners();\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:"You will notice several key differences in this example when compared with the previous one:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The list of Selectors has been moved to a new Module which is included using\nthe ",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/web/javascript/reference/statements/import",children:"import"})," keyword.\nThe new ",(0,i.jsx)(n.code,{children:"selectors"})," module is a dependency of the ",(0,i.jsx)(n.code,{children:"helloworld"})," module."]}),"\n",(0,i.jsxs)(n.li,{children:["The call to ",(0,i.jsx)(n.code,{children:"document.addEventListener"})," has been moved to a new\n",(0,i.jsx)(n.code,{children:"registerEventListeners"})," function.\nThis is another Moodle convention which encourages you to structure your\ncode so that each part has clear responsibilities."]}),"\n",(0,i.jsx)(n.li,{children:"One event listener is present and it checks if the Element clicked on was\none that it's interested in."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"including-javascript-from-your-pages",children:"Including JavaScript from your pages"}),"\n",(0,i.jsx)(n.p,{children:"Once you have written a JavaScript module you need a way to include it within your content."}),"\n",(0,i.jsx)(n.p,{children:"Moodle has three main ways to include your JavaScript and the best way will depend on your content. These are:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["from a template via ",(0,i.jsx)(n.code,{children:"requirejs"}),";"]}),"\n",(0,i.jsx)(n.li,{children:"from PHP via the output requirements API; and"}),"\n",(0,i.jsxs)(n.li,{children:["from other JavaScript via ",(0,i.jsx)(n.code,{children:"import"})," or ",(0,i.jsx)(n.code,{children:"requirejs"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"including-from-a-template",children:"Including from a template"}),"\n",(0,i.jsx)(n.p,{children:"Most recent code in Moodle makes heavy use of Mustache templates and you will often find that your JavaScript is\ndirectly linked to the content of one of your templates."}),"\n",(0,i.jsxs)(n.p,{children:["All JavaScript in Mustache templates must be places in a ",(0,i.jsx)(n.code,{children:"{{#js}}"})," tag.\nThis tag ensures that all JavaScript is called in a consistent and reliable way."]}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsx)(n.p,{children:"You shouldn't add too much JavaScript directly to a template.\nJavaScript placed directly into Templates isn't transpiled for consistent use in all browsers and it isn't passed through minification processes.\nSome browser-specific features won't be available."})}),"\n",(0,i.jsx)(n.p,{children:"This simplest form of this is:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-handlebars",metastring:"title=mod/forum/templates/discussion.mustache",children:"<div>\n    <!\u2014- Your template content goes here. \u2014->\n</div>\n\n{{#js}}\nrequire(['mod_forum/discussion'], function(Discussion) {\n    Discussion.init();\n});\n{{/js}}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Any time that this template is rendered and placed on the page the ",(0,i.jsx)(n.code,{children:"mod_forum/discussion"})," module will be fetched and the ",(0,i.jsx)(n.code,{children:"init()"})," function called on it."]}),"\n",(0,i.jsx)(n.admonition,{title:"Since Moodle 4.0",type:"note",children:(0,i.jsx)(n.p,{children:"Moodle no longer supports Internet Explorer. It's now safe to use Arrow functions."})}),"\n",(0,i.jsxs)(n.p,{children:["Often you may want to link the JavaScript to a specific ",(0,i.jsx)(n.code,{children:"DOMElement"})," in the template.\nYou can use the ",(0,i.jsx)(n.code,{children:"{{uniqid}}"})," Mustache tag to give that DOM Element a unique ID and then pass that into the Module."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-handlebars",metastring:"title=mod/forum/templates/discussion.mustache",children:'<div id="mod_forum-discussion-wrapper-{{uniqid}}">\n    <!\u2014- Your template content goes here. \u2014->\n</div>\n\n{{#js}}\nrequire([\'mod_forum/discussion\'], function(Discussion) {\n    Discussion.init(document.querySelector("mod_forum-discussion-wrapper-{{uniqid}}"));\n});\n{{/js}}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["In this example you have added a new ",(0,i.jsx)(n.code,{children:"id"})," to the ",(0,i.jsx)(n.code,{children:"div"})," element.\nYou then fetch the DOM Element using this id and pass it into the ",(0,i.jsx)(n.code,{children:"init"})," function."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"{{uniqid}}"})," tag gives a new unique string for each rendered template including all its children.\nIt isn't a true unique id and must be combined with other information in the template to make it unique."]})}),"\n",(0,i.jsx)(n.h3,{id:"including-from-php",children:"Including from PHP"}),"\n",(0,i.jsxs)(n.p,{children:["Much of Moodle's code still creates HTML content in PHP directly.\nThis might be a simple ",(0,i.jsx)(n.code,{children:"echo"})," statement or using the ",(0,i.jsx)(n.code,{children:"html_writer"})," output functions.\nA lot of this content is being migrated to use Mustache Templates which are the recommended approach for new content."]}),"\n",(0,i.jsx)(n.p,{children:"Where content is generated in PHP you will need to include your JavaScript at the same time."}),"\n",(0,i.jsxs)(n.p,{children:["Although several older ways to include JavaScript from PHP, it's strongly\nrecommended that all new JavaScript only use the ",(0,i.jsx)(n.code,{children:"js_call_amd"})," function on the\n",(0,i.jsx)(n.code,{children:"page_requirements_manager"}),".\nThis has a similar format to the version used in Templates:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Call the `init` function on `mod_forum/discussion`.\n$PAGE->requires->js_call_amd('mod_forum/discussion', 'init');\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"js_call_amd"})," function turns this into a ",(0,i.jsx)(n.code,{children:"requirejs"})," call."]}),"\n",(0,i.jsxs)(n.p,{children:["You can also pass arguments to your function by passing an array as the third argument to ",(0,i.jsx)(n.code,{children:"js_call_amd"}),", for example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Call the `init` function on `mod_forum/discussion`.\n$PAGE->requires->js_call_amd('mod_forum/discussion', 'init', [$course->id]);\n"})}),"\n",(0,i.jsx)(n.p,{children:"If you pass a multi-dimensional array as the third argument, then you can use Array destructuring within the JavaScript to get named values."}),"\n",(0,i.jsxs)(u,{children:[(0,i.jsx)(h,{value:"php-js_call_admin-args",label:"PHP",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$PAGE->requires->js_call_amd('mod_forum/discussion', 'init', [[\n    'courseid' => $course->id,\n    'categoryid' => $course->category,\n]]);\n"})})}),(0,i.jsx)(h,{value:"js-js_call_admin-args",label:"JavaScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"export const init = ({courseid, category}) => {\n    window.console.log(courseid);\n    window.console.log(category);\n};\n"})})})]}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsx)(n.p,{children:"A limit applies to the length of the parameters passed in the third argument.\nIf data is already available elsewhere in the DOM, you should avoid passing it as a parameter."})}),"\n",(0,i.jsx)(n.h2,{id:"passing-data-to-your-module",children:"Passing data to your Module"}),"\n",(0,i.jsx)(n.p,{children:"You will often need to work with data as part of your JavaScript module.\nThis might be simple data, like the a database id, or it may be more complex\nlike full Objects."}),"\n",(0,i.jsx)(n.p,{children:"Moodle provides several ways to achieve this:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"you can pass a small amount of data into the module initialisation, but this is no longer recommended"}),"\n",(0,i.jsx)(n.li,{children:"you can store this data in the DOM as a data attribute which is fetched in your code"}),"\n",(0,i.jsx)(n.li,{children:"a Moodle Web Service can be used to fetch more complex data structures dynamically"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"using-data-attributes",children:"Using data attributes"}),"\n",(0,i.jsx)(n.p,{children:"The easiest way to pass data is to use data attributes."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-{eval-rst}",children:".. TODO::\n\n    Document the main ways that we pass data.\n\n    Focus on:\n\n        * data- attributes in HTML being ready\n        * the limitations of the data passed into `js_call_amd`\n        * web services\n\n\n"})}),"\n",(0,i.jsx)(n.h2,{id:"promises",children:"Promises"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-{eval-rst}",children:".. TODO::\n\n    We should document things like:\n\n        * Use ``then`` and ``catch`` consistently (thennables)\n        * Don't use ``catch`` if you are returning a Promise just by habit - only use it if you mean to\n        * You _must_ return at the end of a thennable\n        * It's generally a good idea to return a Promise from a fucntion if the function is primarily tasked with\n          creating that Promise\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"important",children:(0,i.jsxs)(n.p,{children:["You shouldn't use the ",(0,i.jsx)(n.code,{children:"done"}),", ",(0,i.jsx)(n.code,{children:"fail"}),", or ",(0,i.jsx)(n.code,{children:"always"})," functions on Promises.\nThese are a jQuery feature which isn't present in the Native Promise implementation."]})}),"\n",(0,i.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n","\n",(0,i.jsx)(t,{language:"js",title:"Create a modal in a function",children:r}),"\n",(0,i.jsx)(n.h2,{id:"working-with-strings",children:"Working with Strings"}),"\n",(0,i.jsxs)(n.p,{children:["One of the most helpful core modules is ",(0,i.jsx)(n.code,{children:"core/str"})," which allows you to fetch and render language Strings in JavaScript."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"core/str"})," module has several core methods to support fetching strings:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getString"})," - fetch a single string, returned in a ",(0,i.jsx)(n.em,{children:"native"})," Promise"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getStrings"})," - fetch a set of strings, returned in an array of ",(0,i.jsx)(n.em,{children:"native"})," Promises"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"get_string"})," - fetch a single string, returned in a ",(0,i.jsx)(n.em,{children:"jQuery"})," Promise"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"get_strings"})," - fetch a set of strings, returned in an array of ",(0,i.jsx)(n.em,{children:"jQuery"})," Promises"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Strings are fetched on request from Moodle, and are then cached in LocalStorage."}),"\n","\n",(0,i.jsx)(t,{language:"js",title:"Example",children:a}),"\n",(0,i.jsxs)(n.admonition,{title:"Native vs jQuery promises",type:"caution",children:[(0,i.jsx)(d,{version:"4.3",issueNumber:"MDL-79064"}),(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"getString"})," and ",(0,i.jsx)(n.code,{children:"getStrings"})," methods should be preferred from Moodle 4.3 onwards. These return ",(0,i.jsx)(n.em,{children:"native"})," Promises, which differ slightly in behaviour from jQuery Promises."]}),(0,i.jsx)(n.p,{children:"Care should be taken in the following scenarios:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["when writing a plugin which supports Moodle 4.2 or earlier, you ",(0,i.jsx)(n.em,{children:"must"})," use the ",(0,i.jsx)(n.code,{children:"get_string"})," and ",(0,i.jsx)(n.code,{children:"get_strings"})," methods"]}),"\n",(0,i.jsxs)(n.li,{children:["you should ",(0,i.jsx)(n.em,{children:"never"})," use ",(0,i.jsx)(n.code,{children:".done"})," or ",(0,i.jsx)(n.code,{children:".fail"})," as they do not exist in the native Promise specification, and their failure behaviour differs"]}),"\n"]})]}),"\n",(0,i.jsx)(n.h2,{id:"templates",children:"Templates"}),"\n",(0,i.jsx)(n.h2,{id:"modals",children:"Modals"}),"\n",(0,i.jsx)(n.h2,{id:"notifications",children:"Notifications"}),"\n",(0,i.jsx)(n.h2,{id:"ajax-calls",children:"AJAX Calls"}),"\n",(0,i.jsx)(n.h2,{id:"preferences",children:"Preferences"}),"\n",(0,i.jsx)(n.h2,{id:"prefetch",children:"Prefetch"}),"\n",(0,i.jsx)(d,{versions:[3.9]}),"\n",(0,i.jsx)(n.p,{children:"Assets including strings, and templates, can be pre-fetched shortly after the page loads to improve the perceived performance of the page when consuming those components."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-todo",children:"Link to jsdocs here\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title="Example of fetching a string and template"',children:"import Prefetch from 'core/prefetch';\n\n// Prefetch the string 'discussion' from the 'mod_forum' component.\nPrefetch.prefetchString('discussion', 'mod_forum');\n\n// Prefetch the strings yes, no, and maybe from the 'core' component.\nPrefetch.prefetchStrings('core', ['yes', 'no', 'maybe']);\n\n// Prefetch the templates 'core/toast'.\nPrefetch.prefetchTemplate('core/toast');\n\n// Prefetch the templates 'core/toast' and 'core/modal'.\nPrefetch.prefetchTemplates(['core/toast', 'core/modal']);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"reactive-state",children:"Reactive state"}),"\n",(0,i.jsx)(d,{versions:[4]}),"\n",(0,i.jsx)(n.p,{children:"Reactivity is one of the latest developments patterns incorporated to web development. Frameworks like React, Angular and Vue are competing for being the standard for web applications. However, for now there is not a clear winner on what is the best solution in terms of performance, standarizations and reusability."}),"\n",(0,i.jsx)(n.p,{children:"While third-party developers are free to use any reactive framework they want, core developments are framework independant. Nevertheless, some part of Moodle implements a basic reactive state pattern by an adhoc library. This library does not represent a full reactive solution but helps implementing resuable and easy to mantain frontend applications."}),"\n",(0,i.jsxs)(n.p,{children:["See the ",(0,i.jsx)(n.a,{href:"./javascript/reactive",children:"Creating reactive UI"})," for more information."]}),"\n",(0,i.jsx)(n.h2,{id:"tools",children:"Tools"}),"\n",(0,i.jsx)(n.p,{children:"Moodle uses common and popular tools to ensure code quality, and to improve the\nend-user experience."}),"\n",(0,i.jsxs)(n.p,{children:["Most of the Moodle JavaScript tooling requires ",(0,i.jsx)(n.a,{href:"/general/development/tools/nodejs",children:"NodeJS"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"grunt",children:"Grunt"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://gruntjs.com/",children:"Grunt"})," is a command-line tool used to compile JavaScript, and CSS, and to lint JavaScript, CSS, and Behat tests."]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["Rather than running ",(0,i.jsx)(n.code,{children:"grunt"})," on the entire Moodle source every time you make changes, you can use ",(0,i.jsx)(n.code,{children:"grunt watch"}),"\nin the background to build just the files you change as you write them."]})}),"\n",(0,i.jsx)(n.h4,{id:"installing-grunt",children:"Installing grunt"}),"\n",(0,i.jsx)(u,{children:(0,i.jsx)(h,{value:"global_grunt",label:"Global",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:"npm -g install grunt-cli\n"})})})}),"\n",(0,i.jsx)(n.h4,{id:"using-grunt",children:"Using grunt"}),"\n",(0,i.jsxs)(u,{children:[(0,i.jsx)(h,{value:"npx_grunt",label:"NPX",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npx grunt\n"})})}),(0,i.jsx)(h,{value:"global_grunt",label:"Global",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"grunt\n"})})})]}),"\n",(0,i.jsx)(n.h3,{id:"eslint",children:"ESLint"})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(m,{...e})}):m(e)}function j(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}}}]);