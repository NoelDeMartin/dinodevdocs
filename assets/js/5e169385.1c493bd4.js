"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[81969],{163:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>g});var a=i(74848),r=i(28453),d=i(78924);const s={title:"Advanced grading API",tags:["Plugins","Grading","Activity grading"],documentationDraft:!0},t=void 0,o={id:"apis/core/grading/index",title:"Advanced grading API",description:"Advanced grading was introduced in Moodle 2.2 for grading of assignments. It is intended to be used for grading of other types of activities in the later versions.",source:"@site/versioned_docs/version-4.2/apis/core/grading/index.md",sourceDirName:"apis/core/grading",slug:"/apis/core/grading/",permalink:"/moodledevdocs/docs/4.2/apis/core/grading/",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/versioned_docs/version-4.2/apis/core/grading/index.md",tags:[{label:"Plugins",permalink:"/moodledevdocs/docs/4.2/tags/plugins"},{label:"Grading",permalink:"/moodledevdocs/docs/4.2/tags/grading"},{label:"Activity grading",permalink:"/moodledevdocs/docs/4.2/tags/activity-grading"}],version:"4.2",lastUpdatedBy:"Andrew Nicols",lastUpdatedAt:168325581e4,frontMatter:{title:"Advanced grading API",tags:["Plugins","Grading","Activity grading"],documentationDraft:!0},sidebar:"docs",previous:{title:"DML exceptions",permalink:"/moodledevdocs/docs/4.2/apis/core/dml/exceptions"},next:{title:"HTML Writer API",permalink:"/moodledevdocs/docs/4.2/apis/core/htmlwriter/"}},l={},g=[{value:"Glossary",id:"glossary",level:2},{value:"Grading area",id:"grading-area",level:3},{value:"Grading form definition",id:"grading-form-definition",level:3},{value:"Grading form instance",id:"grading-form-instance",level:3},{value:"Functions",id:"functions",level:2},{value:"Examples",id:"examples",level:2},{value:"Using advanced grading in grade-able modules",id:"using-advanced-grading-in-grade-able-modules",level:3}];function c(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.A,{frontMatter:s,metadata:o}),"\n",(0,a.jsx)(n.p,{children:"Advanced grading was introduced in Moodle 2.2 for grading of assignments. It is intended to be used for grading of other types of activities in the later versions."}),"\n",(0,a.jsx)(n.h2,{id:"glossary",children:"Glossary"}),"\n",(0,a.jsx)(n.p,{children:"In advanced grading we operate with three main entities:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"a grading area;"}),"\n",(0,a.jsx)(n.li,{children:"a grading form definition; and"}),"\n",(0,a.jsx)(n.li,{children:"a grading form instance."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"grading-area",children:"Grading area"}),"\n",(0,a.jsxs)(n.p,{children:["The grading area is basically the area that can be graded, for example, a submission in an assignment module. Each grading area may have several grading definitions but only one for each grading method. In an assignment's edit form (or its Advanced grading page) the teacher may set one of the advanced grading methods as current. The class called ",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"grading_manager"})})," is responsible for grading method operations in the specified area."]}),"\n",(0,a.jsx)(n.h3,{id:"grading-form-definition",children:"Grading form definition"}),"\n",(0,a.jsxs)(n.p,{children:["Grading form definitions are the set of rules defining how the grading is performed. For example, in rubrics this is the set of criteria and levels and their display options. The basic information about definition is stored in the DB table grading_definitions. A separate entry is created for each grading area (that is for each module). Users with permission ",(0,a.jsx)(n.code,{children:"moodle/grade:managegradingforms"}),' are able to edit the definitions and mark them as "Ready".']}),"\n",(0,a.jsx)(n.h3,{id:"grading-form-instance",children:"Grading form instance"}),"\n",(0,a.jsxs)(n.p,{children:["A grading form instance is created for each evaluation of a submission, using advanced grading. One instance (usually the latest) has the status INSTANCE_STATUS_ACTIVE. Sometimes it may be the case that a teacher wants to change the definition after some students have already been graded. In this case their instances change status to ",(0,a.jsx)(n.code,{children:"INSTANCE_STATUS_NEEDUPDATE"}),". The grade pushed to the gradebook remains unchanged but students will not see the grade in advanced grading format until teacher updates them. Plugins are also welcome to use these status levels."]}),"\n",(0,a.jsx)(n.h2,{id:"functions",children:"Functions"}),"\n",(0,a.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,a.jsx)(n.h3,{id:"using-advanced-grading-in-grade-able-modules",children:"Using advanced grading in grade-able modules"}),"\n",(0,a.jsxs)(n.p,{children:["The following example is drawn from ",(0,a.jsx)(n.strong,{children:"/mod/assignment/lib.php"}),"."]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["In order for module to support advanced grading, its function ",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"[activityname]_supports(FEATURE_ADVANCED_GRADING)"})})," must return true."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",metastring:'title="mod/[activityname]/lib.php"',children:"function [activityname]_supports(string $feature): ?bool {\n    switch ($feature) {\n        // ...\n        case FEATURE_ADVANCED_GRADING:\n            return true;\n        // ...\n    }\n}\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["The module should define a function called ",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"[activityname]_grading_areas_list()"})}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"There needs to be a check to see if there is an advanced grading method for this area and it is available. If it is, retrieve it and set the grade range used in this module."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"if ($controller = get_grading_manager(...)->get_active_controller()) {\n    $controller->set_grade_range(...);\n    ...\n}\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"There are two ways to create an grading object instance. Choose one of the following."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$gradinginstance = $controller->get_current_instance(...);\n$gradinginstance = $controller->get_or_create_instance(...);\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"During population of the grading form, simple grading elements can now be substituted with advanced grading element."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$mform->addElement(\n    'grading',\n    'ELEMENTNAME',\n    '...',\n    ['gradinginstance' => $gradinginstance]\n);\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"On submission of a grading form, the advanced grading information shall be also submitted. The grade for the gradebook retrieved from plugin and saved to the gradebook."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$grade = $gradinginstance->submit_and_get_grade($data->ELEMENTNAME, ...)\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"When the grade is displayed to the student it is displayed using the grading objects renderer."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$output .= $controller->render_grade(...);\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"To show the grading method to students before they are actually graded:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$output .= $controller->render_preview($PAGE);\n"})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);