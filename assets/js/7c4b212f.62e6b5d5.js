"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[53408],{78722:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>s,metadata:()=>d,toc:()=>h});var o=n(74848),r=n(28453),t=n(78924);const s={title:"Profiling PHP",tags:["profiling","xdebug","tideways","xhprof","zend"]},l=void 0,d={id:"guides/profiling/index",title:"Profiling PHP",description:"PHP has two types of profiler:",source:"@site/versioned_docs/version-4.3/guides/profiling/index.md",sourceDirName:"guides/profiling",slug:"/guides/profiling/",permalink:"/moodledevdocs/docs/4.3/guides/profiling/",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/versioned_docs/version-4.3/guides/profiling/index.md",tags:[{label:"profiling",permalink:"/moodledevdocs/docs/4.3/tags/profiling"},{label:"xdebug",permalink:"/moodledevdocs/docs/4.3/tags/xdebug"},{label:"tideways",permalink:"/moodledevdocs/docs/4.3/tags/tideways"},{label:"xhprof",permalink:"/moodledevdocs/docs/4.3/tags/xhprof"},{label:"zend",permalink:"/moodledevdocs/docs/4.3/tags/zend"}],version:"4.3",lastUpdatedBy:"Andrew Nicols",lastUpdatedAt:1713332374e3,frontMatter:{title:"Profiling PHP",tags:["profiling","xdebug","tideways","xhprof","zend"]},sidebar:"docs",previous:{title:"YUI Namespacing",permalink:"/moodledevdocs/docs/4.3/guides/javascript/yui/namespacing"},next:{title:"Templates",permalink:"/moodledevdocs/docs/4.3/guides/templates/"}},a={},h=[{value:"XHProf",id:"xhprof",level:2},{value:"Extensions",id:"extensions",level:3},{value:"XHProf Extension",id:"extensions-xhprof",level:4},{value:"Tideways Extension",id:"extensions-tideways",level:4},{value:"Export Xhprof data to plugins",id:"export-xhprof-data-to-plugins",level:3},{value:"Configuration within Moodle",id:"configuration-within-moodle",level:3},{value:"Further reading",id:"further-reading",level:3},{value:"Xdebug",id:"xdebug",level:2},{value:"Installing Xdebug extension",id:"installing-xdebug-extension",level:3},{value:"Configuring the Xdebug Profiler",id:"configuring-the-xdebug-profiler",level:3},{value:"Analyzing Xdebug profiling files",id:"analyzing-xdebug-profiling-files",level:3},{value:"Quick summary",id:"quick-summary",level:3},{value:"See also",id:"see-also",level:2}];function c(e){const i={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{Since:n}=i;return n||function(e,i){throw new Error("Expected "+(i?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Since",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.A,{frontMatter:s,metadata:d}),"\n",(0,o.jsx)(i.p,{children:"PHP has two types of profiler:"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:"XHProf is a standard designed for capturing profile traces on live servers. It was originally designed by engineers at Facebook and is suitable for production environments."}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.a,{href:"http://www.xdebug.org/docs/profiler",children:"XDebug"})," is well known. and understood, and its trace output is supported by tools like ",(0,o.jsx)(i.a,{href:"http://kcachegrind.sourceforge.net/html/Home.html",children:"KCachegrind"}),". It is not recommended for production environments."]}),"\n"]}),"\n",(0,o.jsx)(i.h2,{id:"xhprof",children:"XHProf"}),"\n",(0,o.jsx)(i.p,{children:"XHProf is both a standard, and a profiler itself. Support for the standard, and two of the standard implementations of it, are built into Moodle."}),"\n",(0,o.jsx)(i.h3,{id:"extensions",children:"Extensions"}),"\n",(0,o.jsx)(i.p,{children:"Moodle supports two extensions which export to the xhprof standard:"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"#extensions-xhprof",children:"xhprof"})}),"\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"#extensions-tideways",children:"Tideways"})}),"\n"]}),"\n",(0,o.jsx)(i.h4,{id:"extensions-xhprof",children:"XHProf Extension"}),"\n",(0,o.jsx)(i.p,{children:"XHProf is a function-level hierarchical profiler for PHP. The raw data collection component is implemented in C, as a PHP extension. It is capable of reporting function-level inclusive and exclusive wall times, memory usage, CPU times and number of calls for each function. Additionally, it supports ability to compare two runs (hierarchical DIFF reports), or aggregate results from multiple runs."}),"\n",(0,o.jsx)(i.p,{children:"For more information, see:"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"https://www.php.net/manual/en/book.xhprof.php",children:"Installation and API Documentation"})}),"\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"https://pecl.php.net/package/xhprof",children:"Change-logs and Version information"})}),"\n"]}),"\n",(0,o.jsx)(i.h4,{id:"extensions-tideways",children:"Tideways Extension"}),"\n",(0,o.jsxs)(i.p,{children:[(0,o.jsx)(i.a,{href:"https://tideways.com/profiler/downloads",children:"Tideways"})," is an alternative to XHProf, and support for this is built into Moodle. The maintainer, ",(0,o.jsx)(i.a,{href:"https://tideways.io",children:"Tideways"}),", is a large, paid-for service, which can be used to identify a range of issues with production services."]}),"\n",(0,o.jsx)(i.admonition,{type:"note",children:(0,o.jsx)(i.p,{children:"Whilst the service itself is a paid-for service, the instrumentation tooling is both Open Source, and free."})}),"\n",(0,o.jsxs)(i.p,{children:["There are two variants of the plugin. You will almost certainly want the ",(0,o.jsx)(i.code,{children:"tideways_xhprof"})," plugin."]}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.a,{href:"https://tideways.com/profiler/downloads",children:"tideways"})," - the original tool, which includes both xhprof instrumentation, and support for the Tideways service."]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.a,{href:"https://github.com/tideways/php-xhprof-extension",children:"tideways_xhprof"})," - a rewritten implementation of the original which only includes the xhprof instrumentation."]}),"\n"]}),"\n",(0,o.jsxs)(i.p,{children:["For installation details please see ",(0,o.jsx)(i.a,{href:"https://github.com/tideways/php-xhprof-extension",children:"https://github.com/tideways/php-xhprof-extension"})]}),"\n",(0,o.jsx)(i.h3,{id:"export-xhprof-data-to-plugins",children:"Export Xhprof data to plugins"}),"\n",(0,o.jsx)(n,{versions:["3.6"],issueNumber:"MDL-63031"}),"\n",(0,o.jsx)(i.p,{children:"Moodle allows for a plugin to handle the Xhprof data and not insert the traces into the database."}),"\n",(0,o.jsxs)(i.p,{children:["To disable Moodle from writing traces to the database, add: ",(0,o.jsx)(i.code,{children:"$CFG->disableprofilingtodatabase = false;"})," into config.php"]}),"\n",(0,o.jsxs)(i.p,{children:["Plugins will need to provide a ",(0,o.jsx)(i.code,{children:"store_profiling_data"})," function to handle the data."]}),"\n",(0,o.jsx)(i.h3,{id:"configuration-within-moodle",children:"Configuration within Moodle"}),"\n",(0,o.jsxs)(i.p,{children:['Once an xhprof extension is correctly installed you will find a new "',(0,o.jsx)(i.strong,{children:"Profiling"}),'" option available under Settings > Site administration > Development.']}),"\n",(0,o.jsx)(i.admonition,{type:"note",children:(0,o.jsx)(i.p,{children:"This documentation assumes that you have already installed an appropriate xhprof extension. Please refer to the relevant documentation for your chosen extension for more information."})}),"\n",(0,o.jsxs)(i.p,{children:["To enable profiling you must ensure that the ",(0,o.jsx)(i.em,{children:"Enable profiling"})," setting is enabled. We recommend specifying one, or more, paths to profile. Paths should be specified relative to your Moodle directory, and not the web root."]}),"\n",(0,o.jsxs)(i.admonition,{type:"tip",children:[(0,o.jsxs)(i.p,{children:["You can use the asterisk (",(0,o.jsx)(i.code,{children:"*"}),") as a wildcard when specifying a path, for example:"]}),(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{children:"mod/*/view.php\n"})})]}),"\n",(0,o.jsx)(i.p,{children:"After you have enabled profiling you should visit the pages you wish to profile."}),"\n",(0,o.jsx)(i.p,{children:"The generated profiles can be found under Settings - Site administration -> Development -> Profiling runs. You can view the resultant profiles as:"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:"a data table; and"}),"\n",(0,o.jsx)(i.li,{children:"a callgraph."}),"\n"]}),"\n",(0,o.jsx)(i.admonition,{type:"note",children:(0,o.jsxs)(i.p,{children:["To view a callgraph, you must have installed Graphviz, and configured the ",(0,o.jsx)(i.code,{children:"pathtodot"}),"."]})}),"\n",(0,o.jsx)(i.p,{children:"Profiles can also be compared with other runs on the same page, allowing you to compare the impact of changes you make."}),"\n",(0,o.jsx)(i.h3,{id:"further-reading",children:"Further reading"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"http://tjhunt.blogspot.co.uk/2013/05/performance-testing-moodle.html",children:"http://tjhunt.blogspot.co.uk/2013/05/performance-testing-moodle.html"})}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.a,{href:"https://docs.google.com/presentation/d/1MV4R71UBgPgzM6I9h_yDnYcxIJlgCoLBUDtJJr-TzNI/present#slide=id.i0",children:"https://docs.google.com/presentation/d/1MV4R71UBgPgzM6I9h_yDnYcxIJlgCoLBUDtJJr-TzNI/present#slide=id.i0"})," presentation about using XHProf"]}),"\n"]}),"\n",(0,o.jsx)(i.h2,{id:"xdebug",children:"Xdebug"}),"\n",(0,o.jsxs)(i.p,{children:[(0,o.jsx)(i.a,{href:"http://xdebug.org/docs/profiler",children:"Xdebug"})," is a powerful PHP debugging tool which is actively maintained, and provides a range of useful debugging features."]}),"\n",(0,o.jsx)(i.p,{children:"Among its major features are stack and function tracing, code coverage analysis, remote debugging, and profiling of scripts."}),"\n",(0,o.jsx)(i.p,{children:"This page will focus on its profiling feature, which provides developer with detailed information about the script performance, helps identifying which parts of the code are slow. Collected information is being stored in cachegrind compatible file and can be analysed using one of external tools, these include:"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"http://kcachegrind.sourceforge.net/",children:"KCachegrind"})}),"\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"http://sourceforge.net/projects/wincachegrind/",children:"WinCacheGrind"})}),"\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"http://code.google.com/p/xdebugtoolkit/",children:"xdebugtoolkit"})}),"\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"https://github.com/jokkedk/webgrind#readme",children:"Webgrind"})}),"\n"]}),"\n",(0,o.jsx)(i.p,{children:"Xdebug is simple to install and operate. it does not require code changes."}),"\n",(0,o.jsx)(i.h3,{id:"installing-xdebug-extension",children:"Installing Xdebug extension"}),"\n",(0,o.jsx)(i.p,{children:"Xdebug is available as an extension to PHP and is typically installed using pecl. Exact instructions will depend on your Operating System."}),"\n",(0,o.jsxs)(i.p,{children:["For full instructions, see the ",(0,o.jsx)(i.a,{href:"https://xdebug.org/docs/install",children:"Xdebug installation documentation"}),"."]}),"\n",(0,o.jsx)(i.p,{children:"Once the Xdebug extension is installed and specified in php configuration, you should restart your webserver."}),"\n",(0,o.jsx)(i.admonition,{title:"tip",type:"note",children:(0,o.jsxs)(i.p,{children:["Information about Xdebug should appear in ",(0,o.jsx)(i.code,{children:"phpinfo()"})," function output. If not, make sure that ",(0,o.jsx)(i.code,{children:"zend_extension"})," line is not commented out, extension file exists in specified location and refer to webserver logs for more details."]})}),"\n",(0,o.jsx)(i.h3,{id:"configuring-the-xdebug-profiler",children:"Configuring the Xdebug Profiler"}),"\n",(0,o.jsx)(i.p,{children:"When Xdebug extension is installed, it must be configured as a profiler."}),"\n",(0,o.jsx)(i.p,{children:"A number of parameters relate to profiling. First of all, profiler should be enabled -- there are two primary ways of doing it."}),"\n",(0,o.jsxs)(i.p,{children:["Both methods of configuration require that you set the xdebug mode to ",(0,o.jsx)(i.code,{children:"profiler"}),":"]}),"\n",(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{className:"language-ini",metastring:'title="php.ini"',children:"xdebug.mode = profile\n"})}),"\n",(0,o.jsx)(i.p,{children:"The default configuration once the mode is set to profiler is for the profiler to start for every request."}),"\n",(0,o.jsxs)(i.p,{children:["This behaviour is configured via the ",(0,o.jsx)(i.a,{href:"https://xdebug.org/docs/all_settings#start_with_request",children:(0,o.jsx)(i.code,{children:"start_with_request"})})," option. With its default setting (",(0,o.jsx)(i.code,{children:"default"}),") it will profile every request."]}),"\n",(0,o.jsxs)(i.p,{children:["It can also be enabled for specific pages by watching for a ",(0,o.jsx)(i.a,{href:"https://xdebug.org/docs/all_settings#start_with_request#trigger",children:(0,o.jsx)(i.em,{children:"trigger"})}),".."]}),"\n",(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{className:"language-ini",metastring:'title="php.ini"',children:"xdebug.mode = profile\nxdebug.start_with_request = trigger\n"})}),"\n",(0,o.jsxs)(i.p,{children:["This tells the xdebug extension to look for a specific variable as a trigger named ",(0,o.jsx)(i.code,{children:"XDEBUG_TRIGGER"}),". The following locations are checked for the presence of this variable:"]}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"$_ENV"})," - environment variables"]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"$_GET"})," - HTTP GET params"]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"$_POST"})," - HTTP POST params"]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"$_COOKIE"})," - An HTTP cookie name"]}),"\n"]}),"\n",(0,o.jsxs)(i.admonition,{title:"Configuring the trigger",type:"tip",children:[(0,o.jsxs)(i.p,{children:["By default, the content of the variable is not checked, but this can be configured with the ",(0,o.jsx)(i.code,{children:"xdebug.trigger_value"})," parameter, for example:"]}),(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{className:"language-ini",metastring:'title="php.ini"',children:"xdebug.mode = profile\nxdebug.start_with_request = trigger\nxdebug.trigger_value = ProfileMe\n"})})]}),"\n",(0,o.jsxs)(i.p,{children:["When using a trigger to start xdebug, open any php page on your server in your browser having added ",(0,o.jsx)(i.code,{children:"XDEBUG_PROFILE"})," parameter to URL string, for example ",(0,o.jsx)(i.code,{children:"http://servername/moodle2/index.php?XDEBUG_PROFILE"}),"."]}),"\n",(0,o.jsxs)(i.p,{children:["If that page already has some parameters, just add our trigger to the URL end, for example: ",(0,o.jsx)(i.code,{children:"http://servername/moodle2/mod/forum/view.php?id=5&XDEBUG_PROFILE"}),"."]}),"\n",(0,o.jsxs)(i.p,{children:["The profile should be generated in the directory you specified with ",(0,o.jsx)(i.code,{children:"xdebug.output_dir"})," directive:"]}),"\n",(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{className:"language-shell",children:"cachegrind.out._moodle2_mod_forum_view_php.1289838411\ncachegrind.out._moodle2_index_php.1289837892\n"})}),"\n",(0,o.jsxs)(i.admonition,{title:"Profiling POST and AJAX requests",type:"tip",children:[(0,o.jsxs)(i.p,{children:["Triggering profiling with POST requests or AJAX queries is also possible without code changes with a number of browser plugins available to help. Plugins are available for most browsers to insert the ",(0,o.jsx)(i.code,{children:"XDEBUG_PROFILE"})," variable into cookie data, thus making profiling enabled for as long as you wish for all requests, the include:"]}),(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"https://addons.mozilla.org/en-US/firefox/addon/58688/",children:"Easy Xdebug for Firefox"})}),"\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"https://chrome.google.com/extensions/detail/eadndfjplgieldjbigjakmdgkmoaaaoc",children:"Chrome"})}),"\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"https://github.com/benmatselby/xdebug-toggler",children:"Safari"})}),"\n"]})]}),"\n",(0,o.jsx)(i.h3,{id:"analyzing-xdebug-profiling-files",children:"Analyzing Xdebug profiling files"}),"\n",(0,o.jsxs)(i.p,{children:["Profiling data is recorded in the cachegrind format, so it can be analysed using one of external tools, such as ",(0,o.jsx)(i.a,{href:"https://kcachegrind.github.io/html/Home.html",children:"KCachegrind"}),", ",(0,o.jsx)(i.a,{href:"http://sourceforge.net/projects/wincachegrind/",children:"WinCacheGrind"}),", ",(0,o.jsx)(i.a,{href:"http://code.google.com/p/xdebugtoolkit/",children:"xdebugtoolkit"})," or web-based analyser ",(0,o.jsx)(i.a,{href:"https://github.com/jokkedk/webgrind#readme",children:"Webgrind"}),". Using these tools is pretty simple. KCachegrind includes a feature to show the matching code if the web-server is run on the same box."]}),"\n",(0,o.jsxs)(i.p,{children:["The Xdebug profiler documentation page has a ",(0,o.jsx)(i.a,{href:"http://xdebug.org/docs/profiler#misc",children:"section"})," about KCachegrind that worth reading for everyone who starts using KCachegrind."]}),"\n",(0,o.jsx)(i.h3,{id:"quick-summary",children:"Quick summary"}),"\n",(0,o.jsxs)(i.ol,{children:["\n",(0,o.jsx)(i.li,{children:"Install Xdebug 3 extension on your server"}),"\n",(0,o.jsx)(i.li,{children:"Configure xdebug"}),"\n",(0,o.jsxs)(i.li,{children:["When you want to profile a page, add ",(0,o.jsx)(i.code,{children:"&XDEBUG_PROFILE"})," to the end of the URL"]}),"\n",(0,o.jsxs)(i.li,{children:["Open the ",(0,o.jsx)(i.code,{children:"cachegrind.out"})," file generated with one of the tools mentioned above"]}),"\n"]}),"\n",(0,o.jsx)(i.h2,{id:"see-also",children:"See also"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.a,{href:"http://moodle.org/mod/forum/discuss.php?d=162045",children:"Forum thread about profiling Moodle 2.0"}),"\nXHProf articles:"]}),"\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"https://docs.google.com/present/view?id=dcbkgbgf_45fbg3rnmk&",children:"Presentation about XHProf"})}),"\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"http://techportal.ibuildings.com/2009/12/01/profiling-with-xhprof/",children:"Profiling with XHProf"})}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.a,{href:"http://www.open.ac.uk/blogs/XHProf/?page_id=46",children:"XHProf \u2013 Profiling and Reporting"})," from Moodle perspective written by ",(0,o.jsx)(i.a,{href:"http://moodle.org/user/view.php?id=264538&course=5",children:"James Brisland"}),"\nXdebug articles:"]}),"\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"http://devzone.zend.com/article/2803-Introducing-xdebug",children:"Introducing xdebug"})}),"\n",(0,o.jsx)(i.li,{children:(0,o.jsx)(i.a,{href:"http://blog.teamlazerbeez.com/2010/05/04/xdebug-quickstart-profiling-in-php/",children:"Xdebug Quick start: Profiling in PHP"})}),"\n"]})]})}function p(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,o.jsx)(i,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);