"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[82950],{54644:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>d});var o=i(74848),s=i(28453),n=i(78924);const a={title:"Automated code review",tags:["Coding guidelines","Tools"]},l=void 0,r={id:"development/tools/cibot",title:"Automated code review",description:"Moodle issues submitted for review and inclusion into core are examined by our continuous integration (ci) system and checked against various automated tests. We use the automated checks to help improve the code quality in Moodle.",source:"@site/general/development/tools/cibot.md",sourceDirName:"development/tools",slug:"/development/tools/cibot",permalink:"/moodledevdocs/general/development/tools/cibot",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/general/development/tools/cibot.md",tags:[{label:"Coding guidelines",permalink:"/moodledevdocs/general/tags/coding-guidelines"},{label:"Tools",permalink:"/moodledevdocs/general/tags/tools"}],version:"current",lastUpdatedBy:"Andrew Nicols",lastUpdatedAt:1700109149e3,frontMatter:{title:"Automated code review",tags:["Coding guidelines","Tools"]},sidebar:"coding",previous:{title:"Working combinations of OS+Browser+selenium",permalink:"/moodledevdocs/general/development/tools/behat/browsers/supportedbrowsers"},next:{title:"Component library",permalink:"/moodledevdocs/general/development/tools/component-library"}},c={},d=[{value:"What is CiBot?",id:"what-is-cibot",level:2},{value:"Will an issue be automatically rejected if CiBot checks fail?",id:"will-an-issue-be-automatically-rejected-if-cibot-checks-fail",level:2},{value:"Should coding style issues in existing code be fixed?",id:"should-coding-style-issues-in-existing-code-be-fixed",level:2},{value:"Example &quot;Should I fix coding style&quot; situations",id:"example-should-i-fix-coding-style-situations",level:3},{value:"Requesting CiBot checks an issue",id:"requesting-cibot-checks-an-issue",level:2},{value:"Are additional CiBot checks possible?",id:"are-additional-cibot-checks-possible",level:2},{value:"How do I report bugs in the CiBot report?",id:"how-do-i-report-bugs-in-the-cibot-report",level:2},{value:"The git commit summary  limit is too small",id:"the-git-commit-summary--limit-is-too-small",level:2},{value:"Branches based off integration.git",id:"branches-based-off-integrationgit",level:2},{value:"Why are issues held up by trivial issues reported which don&#39;t affect the functionality of the change?",id:"why-are-issues-held-up-by-trivial-issues-reported-which-dont-affect-the-functionality-of-the-change",level:2},{value:"See also",id:"see-also",level:2}];function h(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.A,{frontMatter:a,metadata:r}),"\n",(0,o.jsx)(t.p,{children:"Moodle issues submitted for review and inclusion into core are examined by our continuous integration (ci) system and checked against various automated tests. We use the automated checks to help improve the code quality in Moodle."}),"\n",(0,o.jsx)(t.h2,{id:"what-is-cibot",children:"What is CiBot?"}),"\n",(0,o.jsx)(t.p,{children:"CiBot is our automated code checker and it will run checks against any issues waiting for peer review, sent for integration or requested to be checked by the developer. It will report problems discovered in lines of your patch which you are changing."}),"\n",(0,o.jsx)(t.h2,{id:"will-an-issue-be-automatically-rejected-if-cibot-checks-fail",children:"Will an issue be automatically rejected if CiBot checks fail?"}),"\n",(0,o.jsx)(t.p,{children:"No. Developers should strive to have CiBot approve every patch submitted, but the integration team will take a pragmatic approach to things like:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Occasions where CiBot will detect issues present in existing code"}),"\n",(0,o.jsx)(t.li,{children:"Variations from commit message style which make the commit message more understandable overall"}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"should-coding-style-issues-in-existing-code-be-fixed",children:"Should coding style issues in existing code be fixed?"}),"\n",(0,o.jsx)(t.p,{children:"In short, please only update lines relating to your own change."}),"\n",(0,o.jsxs)(t.p,{children:["There are some conventions that are not uniformly followed in the code base, many of these are conventions put in place after code was written. Our long term goal is for the entire codebase to follow the conventions, but in general, we don't want large-scale reformatting of existing code. See ",(0,o.jsx)(t.a,{href:"/moodledevdocs/general/development/policies/codingstyle/#policy-about-coding-style-only-fixes",children:"Coding style#Policy about coding-style only fixes"}),"."]}),"\n",(0,o.jsx)(t.h3,{id:"example-should-i-fix-coding-style-situations",children:'Example "Should I fix coding style" situations'}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:"a) Spacing of if statements is incorrect on the line being changed"})}),"\n",(0,o.jsx)(t.p,{children:"This can be corrected without affecting existing code, so should be fixed."}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:"b) The line being changed contains an invalid variable name"})}),"\n",(0,o.jsx)(t.p,{children:"If correcting this variable would affect other parts of the code not covered by the patch then it's not reasonable to fix it."}),"\n",(0,o.jsx)(t.h2,{id:"requesting-cibot-checks-an-issue",children:"Requesting CiBot checks an issue"}),"\n",(0,o.jsxs)(t.p,{children:["At any time a developer can add the label ",(0,o.jsx)(t.code,{children:"cime"})," to an issue to request it runs it checks against it. The bot ",(0,o.jsx)(t.a,{href:"https://github.com/moodlehq/moodle-local_ci/blob/master/tracker_automations/bulk_precheck_issues/criteria/developer_request/query.sh",children:"checks for issues with the cime label"})," every 20mins and runs the checks then remove the cime label. (Note that because it removes the label, it is normal to 'create' the label)."]}),"\n",(0,o.jsxs)(t.p,{children:["Any issue ",(0,o.jsx)(t.a,{href:"https://github.com/moodlehq/moodle-local_ci/blob/master/tracker_automations/bulk_precheck_issues/criteria/awaiting_peer_review/query.sh",children:"submitted for peer review"})," or ",(0,o.jsx)(t.a,{href:"https://github.com/moodlehq/moodle-local_ci/blob/master/tracker_automations/bulk_precheck_issues/criteria/awaiting_integration/query.sh",children:"integration review"})," will be checked automatically as long as it does not already have the 'ci'  label."]}),"\n",(0,o.jsx)(t.h2,{id:"are-additional-cibot-checks-possible",children:"Are additional CiBot checks possible?"}),"\n",(0,o.jsxs)(t.p,{children:["Yes. It is planned to add more checks - (see ",(0,o.jsx)(t.a,{href:"https://tracker.moodle.org/browse/MDLSITE-3267",children:"MDLSITE-3267"}),") and developers are encouraged to suggest new checks in that issue. Note that some limitations exist:"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"The checks should be consistent and completely reproducible"}),"\n",(0,o.jsx)(t.li,{children:"The check should complete in minutes not hours (other solutions are in planning for longer term tests)"}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"how-do-i-report-bugs-in-the-cibot-report",children:"How do I report bugs in the CiBot report?"}),"\n",(0,o.jsxs)(t.p,{children:["Please ",(0,o.jsx)(t.a,{href:"https://tracker.moodle.org/secure/CreateIssueDetails!init.jspa?pid=10020&issuetype=1&components=12431&summary=Problem%20with%20CiBot%20results%20on%20MDL-XXXXX",children:"file an issue"})," in the MDLSITE project, Integration component."]}),"\n",(0,o.jsx)(t.h2,{id:"the-git-commit-summary--limit-is-too-small",children:"The git commit summary  limit is too small"}),"\n",(0,o.jsxs)(t.p,{children:["When you overrun the length limit many git tools do not display commits well. See how ",(0,o.jsx)(t.a,{href:"https://github.com/moodle/moodle/commits/ea6f5480818c31763f91a90a0cafb6a63ca18117",children:"github truncates ea6f548081"})," - it ruins the message and makes it harder for you to communicate your change to other developers."]}),"\n",(0,o.jsxs)(t.p,{children:["It is acknowledged that its often tricky to get a useful message in such a short space on the first line. However, the coding guidelines for git summary line length were established on the basis of ",(0,o.jsx)(t.a,{href:"https://github.com/blog/926-shiny-new-commit-styles",children:"industry"})," ",(0,o.jsx)(t.a,{href:"http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/Documentation/SubmittingPatches?id=aad7fb916a10f1065ad23de0c80a4a04bcba8437#n594",children:"best"})," ",(0,o.jsx)(t.a,{href:"http://stackoverflow.com/questions/2290016/git-commit-messages-50-72-formatting",children:"practice"}),". As the ",(0,o.jsx)(t.a,{href:"/moodledevdocs/general/development/policies/codingstyle/#git-commits",children:"Coding style"})," mentions, do not be afraid to go into much more detail in your commit body."]}),"\n",(0,o.jsxs)(t.p,{children:["Try ",(0,o.jsx)(t.code,{children:"git log --oneline --no-merges"})," if you want to see how other developers have tried to adapt to this situation."]}),"\n",(0,o.jsx)(t.h2,{id:"branches-based-off-integrationgit",children:"Branches based off integration.git"}),"\n",(0,o.jsxs)(t.p,{children:["The integration.git repository exists separately from moodle.git intentionally to indicate that its the place that ",(0,o.jsx)(t.strong,{children:"history rewrites will happen"}),". If a branch is based on outdated history which has been rewritten and is later attempted to merge it will result in a  mess (repeated history, attempt to re-introduce previously reverted changes). It is for this reason that we strongly recommend against any branches being created based on the integration.git branches due its changing nature. This problem is emphasised because history rewrites will commonly happen at the end of a weekly cycle, immediately before releasing the changes to moodle.git."]}),"\n",(0,o.jsx)(t.p,{children:"There are some rare cases where basing a branch off integration.git might be sensible:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Where the change would have non-trivial conflicts with integration.git changes (e.g. two commits changing the same function)"}),"\n",(0,o.jsx)(t.li,{children:"Could not be branched from moodle.git with these conflicts resolved\nIf this case applies:"}),"\n",(0,o.jsx)(t.li,{children:"CiBot will warn about the branch being based off integration.git"}),"\n",(0,o.jsx)(t.li,{children:"The developer is expected to rebase once integration.git changes have been introduced to moodle.git to ensure that history-rewrites will not cause a merge mess"}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["If these case do not apply, we expect that you ",(0,o.jsx)(t.strong,{children:"do not"})," produce your branches based on integration.git."]}),"\n",(0,o.jsx)(t.h2,{id:"why-are-issues-held-up-by-trivial-issues-reported-which-dont-affect-the-functionality-of-the-change",children:"Why are issues held up by trivial issues reported which don't affect the functionality of the change?"}),"\n",(0,o.jsx)(t.p,{children:"Moodle is a large software project, it is common that 50 different developers will change the same file. Some may produce one fix and never be seen again, others will produce hundreds of fixes. The purpose of our coding conventions is to help all developers communicate with a consistent style so that we can look at all changes and understand their purpose with out getting distracted by changes in style."}),"\n",(0,o.jsx)(t.p,{children:"While the issues reported might be trivial compared to benefit of the fix, over the long term, communicating your change well through coding and commit conventions might be far more important."}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsx)(t.p,{children:'" programs must be written for people to read, and only incidentally for machines to execute"'}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"\u2015 Hal Abelson, Structure and Interpretation of Computer Programs"}),"\n",(0,o.jsx)(t.h2,{id:"see-also",children:"See also"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"/moodledevdocs/general/development/policies/codingstyle/",children:"Coding style"})," and other links in the ",(0,o.jsx)(t.a,{href:"https://docs.moodle.org/Category/Coding_guidelines",children:"coding guidelines category"})]}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}}}]);