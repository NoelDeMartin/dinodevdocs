"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[1800],{70944:(e,s,o)=>{o.r(s),o.d(s,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>u});var r=o(74848),i=o(28453),n=o(78924);const t={title:"Groups API",tags:["API","Subsystem","group","grouping","course"],documentationDraft:!0},a=void 0,l={id:"apis/subsystems/group/index",title:"Groups API",description:"Moodle Groups are a way of expressing collections of users within a course. They may be defined by the teacher in the course participants page, or created automatically during a bulk user upload (for example, from a text file).",source:"@site/versioned_docs/version-4.3/apis/subsystems/group/index.md",sourceDirName:"apis/subsystems/group",slug:"/apis/subsystems/group/",permalink:"/moodledevdocs/docs/4.3/apis/subsystems/group/",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/versioned_docs/version-4.3/apis/subsystems/group/index.md",tags:[{label:"API",permalink:"/moodledevdocs/docs/4.3/tags/api"},{label:"Subsystem",permalink:"/moodledevdocs/docs/4.3/tags/subsystem"},{label:"group",permalink:"/moodledevdocs/docs/4.3/tags/group"},{label:"grouping",permalink:"/moodledevdocs/docs/4.3/tags/grouping"},{label:"course",permalink:"/moodledevdocs/docs/4.3/tags/course"}],version:"4.3",lastUpdatedBy:"Sara Arjona",lastUpdatedAt:1697795601e3,frontMatter:{title:"Groups API",tags:["API","Subsystem","group","grouping","course"],documentationDraft:!0},sidebar:"docs",previous:{title:"Files in Forms",permalink:"/moodledevdocs/docs/4.3/apis/subsystems/form/usage/files"},next:{title:"Output API",permalink:"/moodledevdocs/docs/4.3/apis/subsystems/output/"}},d={},u=[{value:"Group modes",id:"group-modes",level:2},{value:"Group visibility",id:"group-visibility",level:2},{value:"File locations",id:"file-locations",level:2},{value:"Examples",id:"examples",level:2},{value:"How to find and use the &quot;current&quot; group",id:"how-to-find-and-use-the-current-group",level:3},{value:"How to make sure that the current user can see a given item in your activity",id:"how-to-make-sure-that-the-current-user-can-see-a-given-item-in-your-activity",level:3},{value:"How to display a group menu",id:"how-to-display-a-group-menu",level:3},{value:"How to get just the groups that the current user can see",id:"how-to-get-just-the-groups-that-the-current-user-can-see",level:3},{value:"Further reading",id:"further-reading",level:2}];function c(e){const s={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.A,{frontMatter:t,metadata:l}),"\n",(0,r.jsxs)(s.p,{children:["Moodle ",(0,r.jsx)(s.a,{href:"https://docs.moodle.org/en/Groups",children:"Groups"})," are a way of expressing collections of users within a course. They may be defined by the teacher in the course participants page, or created automatically during a bulk user upload (for example, from a text file)."]}),"\n",(0,r.jsx)(s.p,{children:"A teacher can choose whether to use, or even to force, the use of groups for an entire course (from within the Course settings page), or for an individual activity (from within the Activity settings)."}),"\n",(0,r.jsx)(s.p,{children:"Groups can be used in different modes:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"None - groups are not used"}),"\n",(0,r.jsx)(s.li,{children:"Separate - users can only see and interact with users in their own group"}),"\n",(0,r.jsx)(s.li,{children:"Visible - users can see a list of the other groups and, depending on the activity, may be able to interact with them"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:'If enabled at the course level, the group mode will affect how course-wide reporting functions - for example, if a course-wide group mode of "Separate groups" is enabled, this is applied within the gradebook.'}),"\n",(0,r.jsxs)(s.p,{children:["Groups may be grouped together into named ",(0,r.jsx)(s.a,{href:"https://docs.moodle.org/en/Groupings",children:"Groupings"}),". The course, and individual activities, can be configured to filter the groups shown to those in a specific Grouping. If a user is a member of multiple groups, then only those groups which belong to the selected grouping are shown."]}),"\n",(0,r.jsxs)(s.p,{children:["When a course or activity is in the 'Separate' groups mode, only users within that group can interact with, unless they hold the ",(0,r.jsx)(s.code,{children:"moodle/site:accessallgroups"})," capability. By default, this capability is given to users who hold a role with the ",(0,r.jsx)(s.code,{children:"editingteacher"}),", and ",(0,r.jsx)(s.code,{children:"manager"})," archetypes."]}),"\n",(0,r.jsx)(s.p,{children:"Most of these settings are handled by the core groups code and core groups API. If the activity module wants to implement group support, it need only use the Groups API to:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Find out the current settings for this instance of the activity"}),"\n",(0,r.jsx)(s.li,{children:"Show group controls (for example group selection menus) when appropriate"}),"\n",(0,r.jsx)(s.li,{children:"Explore memberships and structures of groups"}),"\n",(0,r.jsx)(s.li,{children:"Modify it's own interface to hide/show data accordingly"}),"\n"]}),"\n",(0,r.jsxs)(s.admonition,{type:"note",children:[(0,r.jsx)(s.p,{children:"Groups are typically only relevant to course features such as Activity modules, some blocks and reports."}),(0,r.jsx)(s.p,{children:"Some other core subsystems also need to be group-aware."})]}),"\n",(0,r.jsx)(s.h2,{id:"group-modes",children:"Group modes"}),"\n",(0,r.jsx)(s.p,{children:"There are three different group modes, these modes allow for restrictions to be put in place for access and visibility."}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["No groups (",(0,r.jsx)(s.code,{children:"NOGROUPS"})," constant) - The course or activity has no groups."]}),"\n",(0,r.jsxs)(s.li,{children:["Separate groups (",(0,r.jsx)(s.code,{children:"SEPARATEGROUPS"})," constant) - Teachers and students can normally only see information relevant to that group."]}),"\n",(0,r.jsxs)(s.li,{children:["Visible groups (",(0,r.jsx)(s.code,{children:"VISIBLEGROUPS"})," constant) - Teachers and students are separated into groups but can still see all information."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["This is explained in more detail on the ",(0,r.jsx)(s.a,{href:"https://docs.moodle.org/dev/Groups_access_control",children:"Groups access control"})," page."]}),"\n",(0,r.jsx)(s.admonition,{type:"caution",children:(0,r.jsxs)(s.p,{children:["Only groups with ",(0,r.jsx)(s.code,{children:"participation"})," enabled are available for use in Separate and Visible groups mode. This is enabled by default for groups with ",(0,r.jsx)(s.em,{children:"Visible to all"})," or ",(0,r.jsx)(s.em,{children:"Visible to members"})," visibility (See below) but is always disabled for groups with ",(0,r.jsx)(s.em,{children:"See own membership"})," or ",(0,r.jsx)(s.em,{children:"Membership is hidden"}),"."]})}),"\n",(0,r.jsxs)(s.p,{children:["Calling ",(0,r.jsx)(s.code,{children:"groups_get_all_groups()"})," with the ",(0,r.jsx)(s.code,{children:"$participationonly"})," argument set to ",(0,r.jsx)(s.code,{children:"true"})," will only return groups with ",(0,r.jsx)(s.code,{children:"participation"})," enabled. If you are calling this function within an activity plugin, you will usually want to do this unless you have a good reason not to."]}),"\n",(0,r.jsx)(s.h2,{id:"group-visibility",children:"Group visibility"}),"\n",(0,r.jsxs)(s.p,{children:["To help protect user privacy, each group has a ",(0,r.jsx)(s.code,{children:"visibility"})," setting, which controls who can see the group and its members. The possible values are defined as ",(0,r.jsx)(s.code,{children:"GROUPS_VISIBILITY_*"})," constants in grouplib."]}),"\n",(0,r.jsxs)(s.p,{children:["Users with the ",(0,r.jsx)(s.code,{children:"moodle/course:viewhiddengroups"})," capability can always see all groups, regardless of their visibility.\nOtherwise, the following restrictions apply:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Visible to all (",(0,r.jsx)(s.code,{children:"GROUPS_VISIBILITY_ALL"})," constant) - Everyone can see the group and its members. This is the default, and the legacy behaviour for all groups before Moodle 4.2."]}),"\n",(0,r.jsxs)(s.li,{children:["Visible to members (",(0,r.jsx)(s.code,{children:"GROUPS_VISIBILITY_MEMBERS"})," constant) - Only members of the group can see the group, and members of the group can see each others' membership of the group."]}),"\n",(0,r.jsxs)(s.li,{children:["See own membership (",(0,r.jsx)(s.code,{children:"GROUPS_VISIBILITY_OWN"})," constant) - Only members of the group can see the group, and members ",(0,r.jsx)(s.strong,{children:"cannot"})," see each others' membership, only their own."]}),"\n",(0,r.jsxs)(s.li,{children:["Membership is hidden (",(0,r.jsx)(s.code,{children:"GROUPS_VISIBILITY_NONE"})," constant) - No-one can see the group or its members."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["The core API functions in ",(0,r.jsx)(s.code,{children:"groupslib"})," such as ",(0,r.jsx)(s.code,{children:"groups_get_all_groups()"})," and ",(0,r.jsx)(s.code,{children:"groups_get_members()"})," will respect the group visibility and the current user's permissions, so use these as far as possible when fetching data about groups and their members. The ",(0,r.jsx)(s.code,{children:"\\core_group\\visibility"})," class also has helper functions to determine whether a user is allowed to see a group, or its members."]}),"\n",(0,r.jsx)(s.h2,{id:"file-locations",children:"File locations"}),"\n",(0,r.jsxs)(s.p,{children:["The Groups API is currently defined in ",(0,r.jsx)(s.a,{href:"https://github.com/moodle/moodle/blob/master/lib/grouplib.php",children:"lib/grouplib.php"}),". This contains global functions which have the ",(0,r.jsx)(s.code,{children:"groups_"})," prefix, for example: ",(0,r.jsx)(s.code,{children:"groups_get_group()"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(s.h3,{id:"how-to-find-and-use-the-current-group",children:'How to find and use the "current" group'}),"\n",(0,r.jsx)(s.p,{children:"This is using an example from the module forums."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"// Get the course module id from a post or get request.\n$id = required_param('id', PARAM_INT);\n\n// Get the course module.\n$cm = get_coursemodule_from_id('forum', $id, 0, false, MUST_EXIST)\n\n// Get the current group id.\n$currentgroupid = groups_get_activity_group($cm);\n// Get the current group name from the group id.\n$currentgroupname = groups_get_group_name($currentgroupid);\n\n// Do as you please with your newly obtained group information.\n"})}),"\n",(0,r.jsx)(s.h3,{id:"how-to-make-sure-that-the-current-user-can-see-a-given-item-in-your-activity",children:"How to make sure that the current user can see a given item in your activity"}),"\n",(0,r.jsx)(s.p,{children:"The following example:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"fetches the course module record for the specified forum id"}),"\n",(0,r.jsx)(s.li,{children:"checks whether it has a group mode specified (separate or visible groups)"}),"\n",(0,r.jsx)(s.li,{children:"fetches the list of possible groups for that activity"}),"\n",(0,r.jsx)(s.li,{children:"checks whether the forum discussion is in a valid group"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"For this example we are going to check to see if groups are active and whether the user has access to the discussion."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"// Get the course module and discussion id from a post or get request.\n$id           = required_param('id', PARAM_INT);\n$discussionid = required_param('discussionid', PARAM_INT);\n\n// Get the course module.\n$cm = get_coursemodule_from_id('forum', $id, 0, false, MUST_EXIST);\n\n// Get the group id for this discussion\n$discussiongroup = $DB->get_record('forum_discussions', ['id' => $discussionid], groupid);\n\n// Check access.\nif (groups_get_activity_groupmode($cm)) {\n    $groups = groups_get_activity_allowed_groups($cm);\n} else {\n    $groups = [];\n}\nif (!in_array($discussiongroup->groupid, array_keys($groups))) {\n    print_error('groupnotamember', 'group');\n}\n\n// Continue on with group specific discussion\n"})}),"\n",(0,r.jsx)(s.h3,{id:"how-to-display-a-group-menu",children:"How to display a group menu"}),"\n",(0,r.jsxs)(s.p,{children:["The following example will display the group selection dropdown using the ",(0,r.jsx)(s.code,{children:"groups_print_activity_menu()"})," function."]}),"\n",(0,r.jsx)(s.p,{children:"This function will show all groups that the user has access to for the current course module."}),"\n",(0,r.jsxs)(s.p,{children:["After making a selection, the user will be redirected to the ",(0,r.jsx)(s.code,{children:"$url"})," provided."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"// Get the course module id from a post or get request\n$id = required_param('id', PARAM_INT);\n\n// Get the course module\n$cm = get_coursemodule_from_id('forum', $id, 0, false, MUST_EXIST);\n\n// Create a moodle_url. A URL is required so that if the user selects a different group, the page can be\n// reloaded with the new groups information.\n$url = new moodle_url('/mod/forum/view.php', ['id' => $cm->id]);\n\n// Print group information (A drop down box will be displayed if the user is a member of more than one group,\n// or has access to all groups).\ngroups_print_activity_menu($cm, $url);\n"})}),"\n",(0,r.jsx)(s.h3,{id:"how-to-get-just-the-groups-that-the-current-user-can-see",children:"How to get just the groups that the current user can see"}),"\n",(0,r.jsxs)(s.p,{children:["The following example will check whether the current user has permission to see hidden groups on a course, and ",(0,r.jsx)(s.strong,{children:"if they do not"}),", will apply additional conditions to a query to restrict the results to just those groups they should see."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"$courseid = required_param('courseid', PARAM_INT)';\n$sql = \"SELECT g.idnumber, gm.*\n          FROM {groups} g\n          JOIN {groups_members} gm ON gm.groupid = g.id\n         WHERE courseid = ?\";\n\n$params = [$courseid];\n\n$context = context_course::instance($courseid);\nif (!has_capability('moodle/course:viewhiddengroups', $context) {\n    // Apply visibility restrictions.\n    [\n        $visibilitywhere,\n        $visibilityparams\n    ] = \\core_group\\visibility::sql_group_visibility_where($userid);\n    $sql .= \" AND \" . $visibilitywhere;\n    $params = array_merge($params, $visibilityparams);\n}\n\n$rs = $DB->get_recordset_sql($sql, $params);\n"})}),"\n",(0,r.jsx)(s.admonition,{type:"note",children:(0,r.jsxs)(s.p,{children:["A query like this must join on ",(0,r.jsx)(s.code,{children:"group_members"})," as group visibility is dependant on the user's own memberships."]})}),"\n",(0,r.jsx)(s.h2,{id:"further-reading",children:"Further reading"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://docs.moodle.org/en/Groups_FAQ",children:"Groups FAQ"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://docs.moodle.org/en/Groupings_FAQ",children:"Groupings FAQ"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);