"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[80138],{70002:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>m,frontMatter:()=>o,metadata:()=>r,toc:()=>h});var s=t(74848),i=t(28453),l=t(78924);const o={title:"XMLDB editor",tags:["XMLDB","DB"]},d=void 0,r={id:"development/tools/xmldb",title:"XMLDB editor",description:"Location: Site administration > Development > XMLDB editor",source:"@site/general/development/tools/xmldb.md",sourceDirName:"development/tools",slug:"/development/tools/xmldb",permalink:"/moodledevdocs/general/development/tools/xmldb",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/general/development/tools/xmldb.md",tags:[{label:"XMLDB",permalink:"/moodledevdocs/general/tags/xmldb"},{label:"DB",permalink:"/moodledevdocs/general/tags/db"}],version:"current",lastUpdatedBy:"Eloy Lafuente (stronk7)",lastUpdatedAt:1694422257e3,frontMatter:{title:"XMLDB editor",tags:["XMLDB","DB"]},sidebar:"coding",previous:{title:"PHPUnit",permalink:"/moodledevdocs/general/development/tools/phpunit"},next:{title:"Making a better contribution",permalink:"/moodledevdocs/general/development/abc"}},a={},h=[{value:"Quick Start",id:"quick-start",level:2},{value:"Use",id:"use",level:2},{value:"Conventions",id:"conventions",level:2},{value:"See also",id:"see-also",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.A,{frontMatter:o,metadata:r}),"\n",(0,s.jsxs)(n.p,{children:["Location: ",(0,s.jsx)(n.em,{children:"Site administration > Development > XMLDB editor"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The XMLDB editor is a tool for making the .xml files that specify how moodle should set up its database tables. Previously, developers had to make separate .sql install files for mysql and postgres, but now only database-neutral file is needed, which supports many more databases."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"It makes the editing of tables/fields/keys/indexes almost a trivial task, allowing developers to spend  the time coding and improving things instead of fighting with XML files and the errors caused by manual editing (of course, developers are free to use such extra time as desired - beers, dance, books, music...) ;-)"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["All new ",(0,s.jsx)(n.em,{children:"install.xml"})," files present under each ",(0,s.jsx)(n.em,{children:"db"})," directory in Moodle can be edited (and we recommend it) with just some clicks and keystrokes. Those ",(0,s.jsx)(n.em,{children:"install.xml"})," will contain all the info needed to generate the specific objects needed for each RDBMS supported."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Note: To be able to handle files properly, the web server needs write access to all ",(0,s.jsx)(n.em,{children:"db"})," directories where the ",(0,s.jsx)(n.em,{children:"install.xml"})," files reside (and to the files themselves, of course). If you cannot click either the load or create link, that means that you either have not created the /db directory, or that it is not writeable by the webserver."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,s.jsx)(n.p,{children:"To use the XMLDB editor to create tables for a new plugin:"}),"\n",(0,s.jsxs)(n.p,{children:['TIP for moodle ver 2.8: it would seem you need a "version.php" and a "settings.php" file within your ',(0,s.jsx)(n.code,{children:"mod/mymodule/"}),' folder, along with a "db" folder that has "WRITE PERMISSION" inside your ',(0,s.jsx)(n.code,{children:"mod/mymodule/"})," folder. i assume the 2 files version.php and settings.php are for security, so XMLDB editor does not get abused some how. i would also assume settings.php and version.php need to be filled out to some extent. if you have above things, then you should be able to find your ",(0,s.jsx)(n.code,{children:"mod/mymodule/"}),' and be able to click the "create" link.']}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Under your plugin's directory, create a ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"db"})})," directory, e.g. ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"mod/mymodule/db"})}),". Make sure the web server has write access to this directory."]}),"\n",(0,s.jsx)(n.li,{children:"In Moodle, navigate to Site administration->Development->XMLDB editor"}),"\n",(0,s.jsxs)(n.li,{children:["You should now see ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"mod/mymodule/db"})})," in the list of XMLDB locations, and the ",(0,s.jsx)(n.strong,{children:"Create"})," link should now be clickable. (If you see your directory but none of the links are clickable, make sure the web server has write access to this directory!)"]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.strong,{children:"Create"}),". (This will create a blank install.xml file)"]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.strong,{children:"Load"}),". (This will load the contents of the install.xml file into memory)"]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.strong,{children:"Edit"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Now you can actually use the XMLDB editor, to create and edit tables for your plugin."}),"\n",(0,s.jsxs)(n.li,{children:["When you're done, keep clicking ",(0,s.jsx)(n.strong,{children:"Back"})," and ",(0,s.jsx)(n.strong,{children:"Back to Main"})," until you get back to the list of XMLDB locations, and then click ",(0,s.jsx)(n.strong,{children:"Save"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This will create an ",(0,s.jsx)(n.em,{children:"install.xml"})," file, which can be used to load your tables into the database in conjunction with a ",(0,s.jsx)(n.em,{children:"version.php"})," file. See ",(0,s.jsx)(n.a,{href:"https://docs.moodle.org/dev/Installing_and_upgrading_plugin_database_tables",children:"Installing and upgrading plugin database tables"})," for more information."]}),"\n",(0,s.jsxs)(n.p,{children:["After the initial installation of a plugin, for subsequent updates to the plugin's table structure you'll need to manually create an ",(0,s.jsx)(n.em,{children:"upgrade.php"})," file in your module's ",(0,s.jsx)(n.em,{children:"db"})," folder. The ",(0,s.jsx)(n.em,{children:"upgrade.php"})," file should start off looking something like this:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"<?php\n\nfunction xmldb_mymodule_upgrade($oldversion) {\n    global $CFG;\n\n    $result = TRUE;\n\n// Insert PHP code from XMLDB Editor here\n\n    return $result;\n}\n?>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["To get the code for the '// Insert PHP code here' bit, open the XMLDB Editor and load the relevant ",(0,s.jsx)(n.em,{children:"install.xml"})," file."]}),"\n",(0,s.jsx)(n.p,{children:"Choose the 'View PHP Code' option and then copy and paste the generated code."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"An image showing the XMLDB Editor, highlighting the &#39;View PHP Code&#39; link",src:t(37510).A+"",width:"1320",height:"570"})}),"\n",(0,s.jsx)(n.h2,{id:"use",children:"Use"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The XMLDB editor is pretty easy to use so there's no need for a complete guide here. Playing with it for a while is highly recommended, viewing how it works and how it modifies the ",(0,s.jsx)(n.em,{children:"install.xml"})," files."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["It's organised in a top-bottom structure, where you start ",(0,s.jsx)(n.em,{children:"loading"}),"* (or ",(0,s.jsx)(n.em,{children:"creating"}),") a new XMLDB file. Then, you can ",(0,s.jsx)(n.em,{children:"edit"})," the file and its ",(0,s.jsx)(n.em,{children:"general structure"})," will be shown. This structure has two types of elements, ",(0,s.jsx)(n.em,{children:"tables"})," and ",(0,s.jsx)(n.em,{children:"statements"})," and the XMLDB editor allows you to ",(0,s.jsx)(n.em,{children:"add"}),", ",(0,s.jsx)(n.em,{children:"edit"}),", ",(0,s.jsx)(n.em,{children:"delete"}),", and ",(0,s.jsx)(n.em,{children:"move"})," them easily. Also, for initial creation of tables, one small but effective *",(0,s.jsx)(n.em,{children:"reverse-enginery"}),"' tool has been developed (only under MySQL) allowing you to retrofit any table from the DB to the XMLDB Editor."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Whilst editing tables you will see their ",(0,s.jsx)(n.em,{children:"fields"}),", ",(0,s.jsx)(n.em,{children:"keys"})," and ",(0,s.jsx)(n.em,{children:"indexes"})," and you'll be able to handle all them easily. Note that some fields can be non-editable. This is because they are being used in some way (part of one key or index) and the idea is to warn you about that."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Fields can be edited and you can specify their ",(0,s.jsx)(n.em,{children:"name"}),", ",(0,s.jsx)(n.em,{children:"type"}),", ",(0,s.jsx)(n.em,{children:"length"}),", ",(0,s.jsx)(n.em,{children:"decimals"}),", ",(0,s.jsx)(n.em,{children:"null-ability"}),", ",(0,s.jsx)(n.em,{children:"defaults"})," and so on. Exactly the same for both ",(0,s.jsx)(n.em,{children:"keys"})," and ",(0,s.jsx)(n.em,{children:"indexes"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:['Whilst editing statements, you must think about them like "collections of sentences". Once you select the ',(0,s.jsx)(n.em,{children:"type"})," (only inserts are allowed for now) and ",(0,s.jsx)(n.em,{children:"table"})," you are interested in, you'll be able to introduce the exact values easily, being able to ",(0,s.jsx)(n.em,{children:"duplicate"})," them easily to gain some speed if you have a lot of sentences in your development. Sentences can be ",(0,s.jsx)(n.em,{children:"edited"})," and ",(0,s.jsx)(n.em,{children:"deleted"})," easily too."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["One interesting feature is that all the XMLDB editor pages allow you to enter a ",(0,s.jsx)(n.em,{children:"comment"})," about the item being modified (table, index, key, field, statement). Use it as you wish, sure that it helps other developers to understand a bit more about the DB model."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["If you define a field as an ",(0,s.jsx)(n.strong,{children:"enum"}),", you should provide the enum options as a comma-separated list, with each option surrounded by single quotes. Example: ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"'option1','option2','option3'"})}),". However, enum has been deprecated in Moodle 2.0, so it is probably better just to avoid enum types altogether."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"conventions",children:"Conventions"}),"\n",(0,s.jsxs)(n.p,{children:["Apart from the ",(0,s.jsx)(n.a,{href:"https://docs.moodle.org/dev/Database",children:"Database Structures guidelines"}),", some more conventions should be followed:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"About names:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"All lowercase names (tables, indexes, keys and fields)."}),"\n",(0,s.jsx)(n.li,{children:"Table names and field names must use only a-z, 0-9 and _ chars. Max 53 characters for tables and 63 characters for fields (28 and 30 before Moodle 4.3)."}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsx)(n.p,{children:"If you are writing a plugin intended for older versions of Moodle then you must continue to use the lower limits of 28, and 30."})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:'Key and index names under the XMLDB Files must be formed by concatenating the name of the fields present in the key/index with the \'"-" (minus) character.'}),"\n",(0,s.jsx)(n.li,{children:'Primary key always must be named "primary" (this is one exception to the previous convention).'}),"\n",(0,s.jsxs)(n.li,{children:["It's highly recommended to avoid ",(0,s.jsx)(n.a,{href:"https://docs.moodle.org/dev/XMLDB_reserved_words",children:"reserved words"})," completely. We know we have some of them now but they should be completely out for next releases."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"About NULLS"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Avoid to create all the fields as NOT NULL with the ",(0,s.jsx)(n.em,{children:"silly"})," default value ",(0,s.jsx)(n.code,{children:"*"})," (empty string). The underlying code used to create tables will handle it properly but the XMLDB structure must be REAL. Read more in the ",(0,s.jsx)(n.a,{href:"https://docs.moodle.org/dev/XMLDB_Problems#NOT_NULL_fields_using_a_DEFAULT_*_clause",children:"Problems Page"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"About FOREIGN KEYS"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Under the tables of every XMLDB file, you must define the existing ",(0,s.jsx)(n.strong,{children:"Foreign Keys"})," (FK) properly. This will allow everybody to know a bit better the structure, allow to evolve to a better constrained system in the future and will provide the underlying code with the needed info to create the proper indexes."]}),"\n",(0,s.jsx)(n.li,{children:"Note that, if you define any field combination as FK you won't have to create any index on that fields, the code will do it automatically!"}),"\n",(0,s.jsx)(n.li,{children:"Respect Convention 1.3"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"About UNIQUE KEYS"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Declare any fields as UNIQUE KEY (UK) only if they are going to be used as target for one FK. Create unique indexes instead."}),"\n",(0,s.jsx)(n.li,{children:"Respect Convention 1.3"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"see-also",children:"See also"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.moodle.org/dev/XMLDB_defining_an_XML_structure",children:"XMLDB defining an XML structure"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.moodle.org/dev/Installing_and_upgrading_plugin_database_tables",children:"Installing and upgrading plugin database tables"})}),"\n",(0,s.jsxs)(n.li,{children:["Using Moodle ",(0,s.jsx)(n.a,{href:"http://moodle.org/mod/forum/discuss.php?d=82231",children:"Using XMLDB editor"})," forum discussion"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"http://dev.moodle.org/mod/resource/view.php?id=55",children:"Appendix B - The XMLDB Editor"})," from the Introduction to Moodle Programming course"]}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},37510:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/xmldbeditor-showphpcode-690d3b189241cafa552121c6b83d2e0d.png"}}]);