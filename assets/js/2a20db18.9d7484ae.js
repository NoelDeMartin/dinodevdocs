"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[84207],{31347:(e,n,t)=>{t.d(n,{A:()=>r});t(96540);var o=t(18215);const s={tabItem:"tabItem_Ymn6"};var i=t(74848);function r(e){let{children:n,hidden:t,className:r}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,o.A)(s.tabItem,r),hidden:t,children:n})}},3384:(e,n,t)=>{t.d(n,{A:()=>w});var o=t(96540),s=t(18215),i=t(55236),r=t(56347),a=t(88385),l=t(5793),d=t(47422),c=t(81038);function h(e){return o.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:t}=e;return(0,o.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:t,attributes:o,default:s}}=e;return{value:n,label:t,attributes:o,default:s}}))}(t);return function(e){const n=(0,d.X)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function m(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function p(e){let{queryString:n=!1,groupId:t}=e;const s=(0,r.W6)(),i=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,l.aZ)(i),(0,o.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(s.location.search);n.set(i,e),s.replace({...s.location,search:n.toString()})}),[i,s])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:s}=e,i=u(e),[r,l]=(0,o.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!m({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const o=t.find((e=>e.default))??t[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:n,tabValues:i}))),[d,h]=p({queryString:t,groupId:s}),[f,x]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[s,i]=(0,c.Dv)(t);return[s,(0,o.useCallback)((e=>{t&&i.set(e)}),[t,i])]}({groupId:s}),g=(()=>{const e=d??f;return m({value:e,tabValues:i})?e:null})();(0,a.A)((()=>{g&&l(g)}),[g]);return{selectedValue:r,selectValue:(0,o.useCallback)((e=>{if(!m({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),h(e),x(e)}),[h,x,i]),tabValues:i}}var x=t(195);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=t(74848);function v(e){let{className:n,block:t,selectedValue:o,selectValue:r,tabValues:a}=e;const l=[],{blockElementScrollPositionUntilNextRender:d}=(0,i.a_)(),c=e=>{const n=e.currentTarget,t=l.indexOf(n),s=a[t].value;s!==o&&(d(n),r(s))},h=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;n=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;n=l[t]??l[l.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":t},n),children:a.map((e=>{let{value:n,label:t,attributes:i}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:o===n?0:-1,"aria-selected":o===n,ref:e=>l.push(e),onKeyDown:h,onClick:c,...i,className:(0,s.A)("tabs__item",g.tabItem,i?.className,{"tabs__item--active":o===n}),children:t??n},n)}))})}function b(e){let{lazy:n,children:t,selectedValue:s}=e;const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===s));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,o.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function y(e){const n=f(e);return(0,j.jsxs)("div",{className:(0,s.A)("tabs-container",g.tabList),children:[(0,j.jsx)(v,{...e,...n}),(0,j.jsx)(b,{...e,...n})]})}function w(e){const n=(0,x.A)();return(0,j.jsx)(y,{...e,children:h(e.children)},String(n))}},98523:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>d,default:()=>p,frontMatter:()=>l,metadata:()=>c,toc:()=>u});var o=t(74848),s=t(28453),i=t(78924),r=t(3384),a=t(31347);const l={title:"Moodle 4.3 developer update",tags:["Core development","Moodle 4.3"]},d=void 0,c={id:"devupdate",title:"Moodle 4.3 developer update",description:"This page highlights the important changes that are coming in Moodle 4.3 for developers.",source:"@site/versioned_docs/version-4.3/devupdate.md",sourceDirName:".",slug:"/devupdate",permalink:"/moodledevdocs/docs/4.3/devupdate",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/versioned_docs/version-4.3/devupdate.md",tags:[{label:"Core development",permalink:"/moodledevdocs/docs/4.3/tags/core-development"},{label:"Moodle 4.3",permalink:"/moodledevdocs/docs/4.3/tags/moodle-4-3"}],version:"4.3",lastUpdatedBy:"Mathew May",lastUpdatedAt:1713356299e3,frontMatter:{title:"Moodle 4.3 developer update",tags:["Core development","Moodle 4.3"]},sidebar:"docs",previous:{title:"xAPI (Experience API)",permalink:"/moodledevdocs/docs/4.3/apis/subsystems/xapi/"}},h={},u=[{value:"Database table and column names",id:"database-table-and-column-names",level:2},{value:"Activity badge",id:"activity-badge",level:2},{value:"JavaScript String fetchers",id:"javascript-string-fetchers",level:2},{value:"Modal Dialogues",id:"modal-dialogues",level:2},{value:"Conversion of Modal to ESM Class",id:"conversion-of-modal-to-esm-class",level:3},{value:"Instantiation and deprecation of <code>core/modal_factory</code>",id:"instantiation-and-deprecation-of-coremodal_factory",level:3},{value:"Forms API",id:"forms-api",level:2},{value:"add_sticky_action_buttons",id:"add_sticky_action_buttons",level:3},{value:"filter_shown_headers",id:"filter_shown_headers",level:3},{value:"Activity completion",id:"activity-completion",level:2},{value:"Append a suffix to the completion rules",id:"append-a-suffix-to-the-completion-rules",level:3},{value:"User preferences in JavaScript modules",id:"user-preferences-in-javascript-modules",level:2},{value:"Icons",id:"icons",level:2},{value:"MIME",id:"mime",level:3},{value:"SVG icons",id:"svg-icons",level:3},{value:"Cron and Tasks API",id:"cron-and-tasks-api",level:2},{value:"Legacy Cron",id:"legacy-cron",level:3},{value:"Behat",id:"behat",level:2},{value:"Removal of Goutte and Goutte Mink Driver",id:"removal-of-goutte-and-goutte-mink-driver",level:3},{value:"Removal of the <code>--skip-passed</code> option",id:"removal-of-the---skip-passed-option",level:3},{value:"Enrolment methods support in CSV course upload",id:"enrolment-methods-support-in-csv-course-upload",level:2},{value:"Addition of comboboxsearch component",id:"addition-of-comboboxsearch-component",level:2}];function m(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{InvalidExample:t,Since:d,ValidExample:h}=n;return t||f("InvalidExample",!0),d||f("Since",!0),h||f("ValidExample",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.A,{frontMatter:l,metadata:c}),"\n","\n",(0,o.jsx)(n.p,{children:"This page highlights the important changes that are coming in Moodle 4.3 for developers."}),"\n",(0,o.jsx)(n.h2,{id:"database-table-and-column-names",children:"Database table and column names"}),"\n",(0,o.jsx)(n.p,{children:"Starting with Moodle 4.3 the limits for both table and column names have been raised. Now table names can be up to 53 characters long (from previous 28 characters limit) and column names can be up to 63 characters long (from previous 30 characters limit)."}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsxs)(n.p,{children:["In order to achieve the above, the maximum length for the database prefix (",(0,o.jsx)(n.code,{children:"$CFG->prefix"}),") is now 10 characters. Installation or upgrade won't be possible with longer prefixes."]})}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsx)(n.p,{children:"If you are writing a plugin intended for older versions of Moodle then you must continue to use the lower limits of 28, and 30."})}),"\n",(0,o.jsx)(n.h2,{id:"activity-badge",children:"Activity badge"}),"\n",(0,o.jsxs)(n.p,{children:["The new activity card design proposed for Moodle 4.3 differentiates badge information from other HTML content (displayed using the pre-existing ",(0,o.jsx)(n.code,{children:"afterlink"})," feature).\nA new ",(0,o.jsx)(n.code,{children:"core_courseformat\\output\\activitybadge"})," class has been added to let modules extend it to display any content in a badge near the activity name.\nSome considerations about its main features:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The badge content is always plain text (no HTML)."}),"\n",(0,o.jsx)(n.li,{children:"The badge style can be set (by default is initialized with badge-none, but it can be set by any module)."}),"\n",(0,o.jsx)(n.li,{children:"An optional URL to redirect the user when the badge is clicked."}),"\n",(0,o.jsx)(n.li,{children:"An optional ID to add the element in case the module wants to add some JS to the badge events."}),"\n",(0,o.jsx)(n.li,{children:"Optionally, any other extra HTML attributes to the badge element (for example, data attributes)."}),"\n"]}),"\n",(0,o.jsxs)(n.admonition,{type:"danger",children:[(0,o.jsxs)(n.mdxAdmonitionTitle,{children:[(0,o.jsx)(n.code,{children:"Afterlink"})," vs ",(0,o.jsx)(n.code,{children:"ActivityBadge"})]}),(0,o.jsxs)(n.p,{children:["The content of the ",(0,o.jsx)(n.code,{children:"afterlink"})," feature has been moved to the end of the activity card so modules using it should check this new feature which might fit better."]})]}),"\n",(0,o.jsxs)(n.p,{children:["Plugins can implement ",(0,o.jsx)(n.code,{children:"mod_PLUGINNAME\\output\\courseformat\\activitybadge"})," that extends from the original ",(0,o.jsx)(n.code,{children:"core_courseformat\\output\\activitybadge"})," class that has been added from Moodle 4.3 onwards. This new class will delegate most data attributes to protected methods, so plugins will only need to implement the ",(0,o.jsx)(n.code,{children:"update_content()"})," method, to set these attributes accordingly: ",(0,o.jsx)(n.code,{children:"content"}),", ",(0,o.jsx)(n.code,{children:"style"}),", ",(0,o.jsx)(n.code,{children:"url"}),", ",(0,o.jsx)(n.code,{children:"elementid"})," and ",(0,o.jsx)(n.code,{children:"extrattributes"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",metastring:'title="course/format/classes/output/activitybadge.php"',children:"namespace core_courseformat\\output;\n\nabstract class activitybadge implements named_templatable, \\renderable {\n\n    /** @var array Badge defined styles. */\n    public const STYLES = [\n        'none' => 'badge-none',\n        'dark' => 'badge-dark',\n        'danger' => 'badge-danger',\n        'warning' => 'badge-warning',\n        'info' => 'badge-info',\n    ];\n\n    /** @var cm_info The course module information. */\n    protected $cminfo = null;\n\n    /** @var string The content to be displayed in the activity badge.  */\n    protected $content = null;\n\n    /** @var string The style for the activity badge.  */\n    protected $style = self::STYLES['none'];\n\n    /** @var \\moodle_url An optional URL to redirect the user when the activity badge is clicked.  */\n    protected $url = null;\n\n    /** @var string An optional element id in case the module wants to add some code for the activity badge (events, CSS...). */\n    protected $elementid = null;\n\n    /**\n     * @var array An optional array of extra HTML attributes to add to the badge element (for example, data attributes).\n     * The format for this array is [['name' => 'attr1', 'value' => 'attrval1'], ['name' => 'attr2', 'value' => 'attrval2']].\n     */\n    protected $extraattributes = [];\n\n    [...]\n\n    abstract protected function update_content(): void;\n\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"As a proof of concept, this feature has been implemented by:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Forum"}),", to display the unread messages."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",metastring:'title="mod/forum/classes/output/courseformat/activitybadge.php"',children:"namespace mod_forum\\output\\courseformat;\n\nclass activitybadge extends \\core_courseformat\\output\\activitybadge {\n\n    protected function update_content(): void {\n        global $CFG;\n\n        require_once($CFG->dirroot . '/mod/forum/lib.php');\n\n        if (forum_tp_can_track_forums()) {\n            if ($unread = forum_tp_count_forum_unread_posts($this->cminfo, $this->cminfo->get_course())) {\n                if ($unread == 1) {\n                    $this->content = get_string('unreadpostsone', 'forum');\n                } else {\n                    $this->content = get_string('unreadpostsnumber', 'forum', $unread);\n                }\n                $this->style = self::STYLES['dark'];\n            }\n        }\n    }\n}\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Resource"}),", to show the file type (extension). The rest of the resource information (size and creation date) has been kept in the ",(0,o.jsx)(n.code,{children:"afterlink"})," section."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",metastring:'title="mod/resource/classes/output/courseformat/activitybadge.php"',children:"namespace mod_resource\\output\\courseformat;\n\nclass activitybadge extends \\core_courseformat\\output\\activitybadge {\n\n    protected function update_content(): void {\n        $options = (object) ['displayoptions' => $this->cminfo->customdata['displayoptions']];\n        $this->content = resource_get_optional_filetype($options, $this->cminfo);\n    }\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["A new ",(0,o.jsx)(n.code,{children:"core_courseformat/local/content/cm/activitybadge"})," template has been also created to display this activity badge data. As usual, it can be overridden by any format plugin."]}),"\n",(0,o.jsx)(n.h2,{id:"javascript-string-fetchers",children:"JavaScript String fetchers"}),"\n",(0,o.jsx)(d,{version:"4.3",issueNumber:"MDL-79064"}),"\n",(0,o.jsxs)(n.p,{children:["New string fetchers were introduced in ",(0,o.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-79064",children:"MDL-79064"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"getString"})," - fetch a single string, resolving in a Native Promise"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"getStrings"})," - fetch a set of strings, resolving in an array of Native Promises"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Note: These new fetchers will return a ",(0,o.jsx)(n.em,{children:"native"})," Promise rather than a jQuery Promise."]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"get_string"})," and ",(0,o.jsx)(n.code,{children:"get_strings"})," methods have ",(0,o.jsx)(n.em,{children:"not"})," been deprecated at this time but work is underway to allow for their future deprecation."]}),"\n",(0,o.jsxs)(n.admonition,{title:"Native Promises vs jQuery Promises",type:"caution",children:[(0,o.jsx)(n.p,{children:"The use of jQuery Promises is discouraged in Moodle as they have a different behaviour in some cases:"}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["native Promises do not have the ",(0,o.jsx)(n.code,{children:"done"})," method. Please use ",(0,o.jsx)(n.code,{children:"then"})," instead"]}),"\n",(0,o.jsxs)(n.li,{children:["native Promises do not have the ",(0,o.jsx)(n.code,{children:"fail"})," method. Please use ",(0,o.jsx)(n.code,{children:"catch"})," instead"]}),"\n"]}),(0,o.jsxs)(n.p,{children:["Please note that the behaviour of ",(0,o.jsx)(n.code,{children:"catch"})," differs from the jQuery ",(0,o.jsx)(n.code,{children:"fail"}),". The ",(0,o.jsx)(n.code,{children:"catch"})," method will return a resolved Promise, whist the ",(0,o.jsx)(n.code,{children:"fail"})," method will not."]}),(0,o.jsxs)(n.p,{children:["You are ",(0,o.jsx)(n.strong,{children:"strongly"})," advised to convert all uses  of ",(0,o.jsx)(n.code,{children:".done"}),", and ",(0,o.jsx)(n.code,{children:".fail"})," in your code to ",(0,o.jsx)(n.code,{children:".then"}),", and ",(0,o.jsx)(n.code,{children:".catch"})," as appropriate."]})]}),"\n",(0,o.jsx)(n.h2,{id:"modal-dialogues",children:"Modal Dialogues"}),"\n",(0,o.jsx)(n.p,{children:"Moodle 4.3 brings a number of improvements to Modal dialogues. These improvements focus on:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"the declaration of new Modal types"}),"\n",(0,o.jsx)(n.li,{children:"the instantiation of new Modal instances"}),"\n",(0,o.jsx)(n.li,{children:"the use of instantiated Modals"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"conversion-of-modal-to-esm-class",children:"Conversion of Modal to ESM Class"}),"\n",(0,o.jsx)(d,{version:"4.3",issueNumber:"MDL-78306"}),"\n",(0,o.jsx)(n.p,{children:"If using a prototypal class, you will see an error message such as the following:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:'title="Errors shown when trying to instantiate a prototypal modal"',children:"test.js:4 Uncaught TypeError: Class constructor Modal cannot be invoked without 'new'\n    at new MyModal (test.js:4:11)\n    at <anonymous>:1:1\n"})}),"\n",(0,o.jsxs)(n.p,{children:["All modal types ",(0,o.jsx)(n.strong,{children:"must"})," now be written as an ESM class. Prototypal modals are no longer supported."]}),"\n",(0,o.jsxs)(n.p,{children:["These changes are backwards compatible with previous versions of Moodle. An ESM Modal definition can be used with Moodle 4.2 or earlier. A prototypal modal ",(0,o.jsx)(n.em,{children:"cannot"})," be used with Moodle 4.3 onwards."]}),"\n",(0,o.jsxs)(r.A,{groupId:"beforeAfter",children:[(0,o.jsx)(a.A,{value:"before",label:"Before Moodle 4.3",children:(0,o.jsxs)(t,{title:"Prototypal modal definition",children:[(0,o.jsxs)(n.p,{children:["A Prototypal modal ",(0,o.jsx)(n.em,{children:"cannot"})," extend an ESM class."]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"var MyModal = function(root) {\n    Modal.call(this, root);\n    this.myCustomMethod();\n};\n\nMyModal.TYPE = 'mod_example/myModal';\nMyModal.prototype = Object.create(Modal.prototype);\nMyModal.prototype.constructor = MyModal;\n\nMyModal.prototype.registerEventListeners = function() {\n    // Apply parent event listeners.\n    Modal.prototype.registerEventListeners.call(this);\n\n    this.getModal().on(CustomEvents.events.activate, function(e) {\n        // ...\n    }.bind(this));\n};\n\nMyModal.prototype.myCustomMethod = function() {\n    // ...\n};\n\nreturn MyModal;\n"})})]})}),(0,o.jsx)(a.A,{value:"after",label:"From Moodle 4.3 onwards",default:!0,children:(0,o.jsxs)(h,{title:"The same content converted to an ESM class",children:[(0,o.jsx)(n.p,{children:"An ESM class can extend either another ESM class, or a prototypal method."}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"export default class MyModal extends Modal {\n    static TYPE = 'mod_example/myModal';\n\n    constructor(root) {\n        // We can override the constructor to call additional setup.\n        super(root);\n\n        this.myCustomMethod();\n    }\n\n    registerEventListeners() {\n        // Call the registerEventListeners method on the parent class.\n        super.registerEventListeners();\n\n        this.getModal().on(CustomEvents.events.activate, function(e) {\n            // ...\n        });\n    }\n\n    myCustomMethod() {\n        // ...\n    }\n}\n"})})]})})]}),"\n",(0,o.jsxs)(n.h3,{id:"instantiation-and-deprecation-of-coremodal_factory",children:["Instantiation and deprecation of ",(0,o.jsx)(n.code,{children:"core/modal_factory"})]}),"\n",(0,o.jsx)(d,{version:"4.3",issueNumber:"MDL-78324"}),"\n",(0,o.jsxs)(n.p,{children:["Moodle 4.3 introduces a new way to instantiate modals which is significantly simpler than earlier versions. Rather than calling the ",(0,o.jsx)(n.code,{children:"create"})," method on the ",(0,o.jsx)(n.code,{children:"modal_factory"}),", it can now be called on the class that you are instantiating."]}),"\n",(0,o.jsxs)(n.p,{children:["In addition, a new ",(0,o.jsx)(n.code,{children:"configure"})," method is introduced which allows you to override configuration options, provide your own, and more."]}),"\n",(0,o.jsxs)(n.p,{children:["Modals which are instantiated using the new method ",(0,o.jsx)(n.em,{children:"do not"})," need to be registered if they are not consumed using the modal factory."]}),"\n",(0,o.jsx)(n.p,{children:"This change will increase encapsulation and allow modals to handle common actions such as showing on creation, and removing on close much more easily."}),"\n",(0,o.jsx)(n.admonition,{title:"Compatibility with Moodle 4.2 and older",type:"note",children:(0,o.jsxs)(n.p,{children:["If your code is intended to work with Moodle 4.2 and older, then you must continue to use the existing ",(0,o.jsx)(n.code,{children:"core/modal_factory"}),", and you must continue to register your modal. This legacy method will be maintained until Moodle 4.6."]})}),"\n",(0,o.jsxs)(r.A,{groupId:"beforeAfter",children:[(0,o.jsx)(a.A,{value:"before",label:"Before Moodle 4.3",children:(0,o.jsxs)(t,{title:"A modal created and instantiated using the legacy approach",children:[(0,o.jsx)(n.p,{children:"The legacy registration will continue to work and should be used if your plugin will be used in Moodle 4.2, or earlier."}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:'title="mod/example/amd/src/mymodal.js"',children:"export default class MyModal extends Modal {\n    static TYPE = 'mod_example/myModal';\n    static TEMPLATE = 'mod_example/my_modal';\n\n    myCustomSetter(value) {\n        this.value = value;\n    }\n}\nlet registered = false;\nif (!registered) {\n    ModalRegistry.register(MyModal.TYPE, MyModal, 'mod_example/my_modal');\n    registered = true;\n}\n"})}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:'title="mod/example/amd/src/consumer.js"',children:"import MyModal from './mymodal';\nimport ModalFactory from 'core/modal_factory';\n\n// ...\nModalFactory.create({\n    TYPE: MyModal.TYPE,\n}).then((modal) => {\n    modal.show();\n    modal.myCustomSetter('someValue');\n\n    return modal;\n})\n"})})]})}),(0,o.jsx)(a.A,{value:"after",label:"From Moodle 4.3 onwards",default:!0,children:(0,o.jsxs)(h,{title:"A modal using the new approach",children:[(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:'title="mod/example/amd/src/mymodal.js"',children:"export default class MyModal extends Modal {\n    static TYPE = 'mod_example/myModal';\n    static TEMPLATE = 'mod_example/my_modal';\n\n    configure(modalConfig) {\n        // Specify any defaults you like here.\n        modalConfig.show = true;\n        super.configure(modalConfig);\n\n        this.myCustomSetter(modalConfig.myCustomValue);\n    }\n\n    myCustomSetter(value) {\n        this.value = value;\n    }\n}\n"})}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:'title="mod/example/amd/src/consumer.js"',children:"import MyModal from './mymodal';\n\n// ...\nMyModal.create({\n    myCustomValue: 'someValue',\n    show: true,\n});\n"})})]})})]}),"\n",(0,o.jsx)(n.h2,{id:"forms-api",children:"Forms API"}),"\n",(0,o.jsx)(n.h3,{id:"add_sticky_action_buttons",children:"add_sticky_action_buttons"}),"\n",(0,o.jsxs)(n.p,{children:["A new method ",(0,o.jsx)(n.code,{children:"add_sticky_action_buttons()"})," has been added to ",(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/apis/subsystems/form/#add_sticky_action_buttons",children:"Forms API"})," to enable sticky footer."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"public function add_sticky_action_buttons(\n    bool $cancel = true,\n    ?string $submitlabel = null,\n);\n"})}),"\n",(0,o.jsx)(n.h3,{id:"filter_shown_headers",children:"filter_shown_headers"}),"\n",(0,o.jsxs)(n.p,{children:["A new method ",(0,o.jsx)(n.code,{children:"filter_shown_headers()"})," has been added to to ",(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/apis/subsystems/form/#filter_shown_headers",children:"Forms API"})," to show some expanded headers only and hide the rest."]}),"\n",(0,o.jsxs)(n.p,{children:["This method adds values to ",(0,o.jsx)(n.code,{children:"_shownonlyelements"})," array to decide whether a header should be shown or hidden.\nOnly header names would be accepted and added to ",(0,o.jsx)(n.code,{children:"_shownonlyelements"})," array.\nHeaders included in ",(0,o.jsx)(n.code,{children:"_shownonlyelements"})," will be shown expanded in the form. The rest of the headers will be hidden."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"public function filter_shown_headers(array $shownonly): void {\n    $this->_shownonlyelements = [];\n    if (empty($shownonly)) {\n        return;\n    }\n    foreach ($shownonly as $headername) {\n        $element = $this->getElement($headername);\n        if ($element->getType() == 'header') {\n            $this->_shownonlyelements[] = $headername;\n            $this->setExpanded($headername);\n        }\n    }\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Empty ",(0,o.jsx)(n.code,{children:"_shownonlyelements"})," array doesn't affect header's status or visibility."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",metastring:'title="/course/editsection.php"',children:"$showonly = optional_param('showonly', 0, PARAM_TAGLIST);\n\n[...]\n\n$mform = $courseformat->editsection_form($PAGE->url, $customdata);\n\n$initialdata = convert_to_array($sectioninfo);\nif (!empty($CFG->enableavailability)) {\n    $initialdata['availabilityconditionsjson'] = $sectioninfo->availability;\n}\n$mform->set_data($initialdata);\nif (!empty($showonly)) {\n    $mform->filter_shown_headers(explode(',', $showonly));\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"activity-completion",children:"Activity completion"}),"\n",(0,o.jsx)(n.h3,{id:"append-a-suffix-to-the-completion-rules",children:"Append a suffix to the completion rules"}),"\n",(0,o.jsxs)(n.p,{children:["As part of ",(0,o.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-78516",children:"MDL-78516"}),", the ",(0,o.jsx)(n.a,{href:"https://docs.moodle.org/en/Activity_completion_settings#Changing_activity_completion_settings_in_bulk",children:"Default completion form"})," has undergone a significant rebuild to enhance code reusability and maintainability. To prevent duplicate IDs, a suffix has been introduced to the form elements related to completion rules."]}),"\n",(0,o.jsxs)(n.p,{children:["For third-party plugins, an adjustment is needed to incorporate this new suffix, following the approach already taken by ",(0,o.jsx)(n.a,{href:"https://github.com/sarjona/moodle/commit/8f57f0fdaca027c7099bc6966467077aecbc0862",children:"core modules"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["The primary modification entails editing ",(0,o.jsx)(n.code,{children:"mod/yourplugin/mod_form.php"})," and applying the suffix to the completion rule elements within all relevant methods. As an example, here are the changes made to the ",(0,o.jsx)(n.code,{children:"mod/choice"})," module:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"    public function add_completion_rules() {\n        $mform = $this->_form;\n\n        $completionsubmitel = $this->get_suffixed_name('completionsubmit');\n        $mform->addElement('checkbox', $completionsubmitel, '', get_string('completionsubmit', 'choice'));\n        // Enable this completion rule by default.\n        $mform->setDefault($completionsubmitel, 1);\n        return [$completionsubmitel];\n    }\n\n    public function completion_rule_enabled($data) {\n        return !empty($data[$this->get_suffixed_name('completionsubmit')]);\n    }\n\n    public function data_postprocessing($data) {\n        parent::data_postprocessing($data);\n        // Set up completion section even if checkbox is not ticked.\n        if (!empty($data->completionunlocked)) {\n            if (empty($data->{$this->get_suffixed_name('completionsubmit')})) {\n                $data->{$this->get_suffixed_name('completionsubmit')} = 0;\n            }\n        }\n    }\n\n    protected function get_suffixed_name(string $fieldname): string {\n        return $fieldname . $this->get_suffix();\n    }\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsxs)(n.p,{children:["Starting from Moodle 4.3, completion rules without the suffix will be phased out from the ",(0,o.jsx)(n.a,{href:"https://docs.moodle.org/en/Activity_completion_settings#Changing_activity_completion_settings_in_bulk",children:"Default completion form"})," until they are updated to incorporate the required suffix"]})}),"\n",(0,o.jsx)(n.h2,{id:"user-preferences-in-javascript-modules",children:"User preferences in JavaScript modules"}),"\n",(0,o.jsxs)(n.p,{children:["As part of ",(0,o.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-62859",children:"MDL-62859"})," and ",(0,o.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-76974",children:"MDL-76974"}),", new methods for the reading and writing of user preferences in JavaScript modules have been created."]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"core_user/repository"})," module exports new methods ",(0,o.jsx)(n.code,{children:"getUserPreference"}),", ",(0,o.jsx)(n.code,{children:"getUserPreferences"}),", ",(0,o.jsx)(n.code,{children:"setUserPreference"})," and ",(0,o.jsx)(n.code,{children:"setUserPreferences"}),". Examples of which are below:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:'title="Get user preferences"',children:"\nimport Notification from 'core/notification';\nimport {getUserPreference, getUserPreferences} from 'core_user/repository';\n\n// Get single preference.\ngetUserPreference('mod_example_foo')\n    .then(window.console.log)\n    .catch(Notification.exception);\n\n// Get multiple preferences.\ngetUserPreferences()\n    .then(window.console.log)\n    .catch(Notification.exception);\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:'title="Set user preferences"',children:"\nimport Notification from 'core/notification';\nimport {setUserPreference, setUserPreferences} from 'core_user/repository';\n\n// Set single preference.\nsetUserPreference('mod_example_foo', 42)\n    .catch(Notification.exception);\n\n// Set multiple preferences.\nsetUserPreferences([\n    {name: 'mod_example_foo', value: 42},\n    {name: 'mod_example_bar', value: 43},\n]).catch(Notification.exception);\n"})}),"\n",(0,o.jsx)(n.h2,{id:"icons",children:"Icons"}),"\n",(0,o.jsx)(n.h3,{id:"mime",children:"MIME"}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["The MIME icons located in the ",(0,o.jsx)(n.code,{children:"pix/f"})," directory, have undergone an update. These icons, previously available in various sizes, have now been replaced with SVG versions."]})}),"\n",(0,o.jsx)(n.p,{children:"To streamline the variety of icons associated with different MIME types, several specific MIME icons have been replaced. Instead, their corresponding generic icons have been integrated from the existing collection, leading to a more efficient representation:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"avi"})," -> ",(0,o.jsx)(n.code,{children:"video"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"base"})," -> ",(0,o.jsx)(n.code,{children:"database"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"bmp"})," -> ",(0,o.jsx)(n.code,{children:"image"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"html"})," -> ",(0,o.jsx)(n.code,{children:"markup"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"jpeg"})," -> ",(0,o.jsx)(n.code,{children:"image"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"mov"})," -> ",(0,o.jsx)(n.code,{children:"video"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"mp3"})," -> ",(0,o.jsx)(n.code,{children:"audio"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"mpeg"})," -> ",(0,o.jsx)(n.code,{children:"video"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"png"})," -> ",(0,o.jsx)(n.code,{children:"image"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"quicktime"})," -> ",(0,o.jsx)(n.code,{children:"video"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"tiff"})," -> ",(0,o.jsx)(n.code,{children:"image"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"wav"})," -> ",(0,o.jsx)(n.code,{children:"audio"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"wmv"})," -> ",(0,o.jsx)(n.code,{children:"video"})]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The subsequent MIME icons have been entirely removed:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"clip-353"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"edit"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"env"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"explore"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"folder-open"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"help"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"move"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"parent"})}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsx)(n.p,{children:'Files utilizing any of these removed icons will now be represented by the "unknown" icon.'})}),"\n",(0,o.jsx)(n.h3,{id:"svg-icons",children:"SVG icons"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The ",(0,o.jsx)(n.code,{children:"$CFG->svgicons"})," parameter has been deprecated and removed. It was initially introduced in Moodle 2.4 as a response to incomplete SVG support in some web browsers, as documented in ",(0,o.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-22955",children:"MDL-22955"}),". However, the web landscape has evolved considerably since that time, and all modern browsers now fully support SVG files, as confirmed by this compatibility chart: ",(0,o.jsx)(n.a,{href:"https://caniuse.com/svg",children:"https://caniuse.com/svg"}),"."]}),"\n",(0,o.jsx)(n.li,{children:"A new PHPUnit test has been introduced to verify the presence of SVG files for all system icons in Moodle LMS. Any missing SVG files have been rectified within Moodle LMS."}),"\n"]}),"\n",(0,o.jsxs)(n.admonition,{type:"tip",children:[(0,o.jsx)(n.p,{children:"Third-party plugins are strongly encouraged to follow suit, adding missing SVG files too, to avoid PHPUnit test failures."}),(0,o.jsxs)(n.p,{children:["The SVG icons in Moodle LMS were sourced from ",(0,o.jsx)(n.a,{href:"https://fontawesome.com/search?m=free&o=r",children:"https://fontawesome.com/search?m=free&o=r"}),", which offers free icons under the Creative Commons Attribution 4.0 International license, consistent with the Moodle icon set."]})]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["When adding SVG files from ",(0,o.jsx)(n.a,{href:"https://fontawesome.com/icons",children:"FontAwesome"}),", please make sure to use the ",(0,o.jsx)(n.code,{children:"Free"})," icon set by generating the file from the ",(0,o.jsx)(n.code,{children:"SVG"})," code, rather than downloading it. This approach ensures the correct licensing of the icon, as the downloaded version may have a different license at times."]})}),"\n",(0,o.jsx)(n.h2,{id:"cron-and-tasks-api",children:"Cron and Tasks API"}),"\n",(0,o.jsx)(n.h3,{id:"legacy-cron",children:"Legacy Cron"}),"\n",(0,o.jsx)(d,{version:"4.3",issueNumber:"MDL-61165"}),"\n",(0,o.jsxs)(n.p,{children:["Support for the ",(0,o.jsx)(n.code,{children:"cron.php"})," and ",(0,o.jsx)(n.code,{children:"modname_cron"})," legacy cron system has been removed."]}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsx)(n.p,{children:"All legacy cron tasks must now be converted to Tasks"})}),"\n",(0,o.jsx)(n.h2,{id:"behat",children:"Behat"}),"\n",(0,o.jsx)(n.h3,{id:"removal-of-goutte-and-goutte-mink-driver",children:"Removal of Goutte and Goutte Mink Driver"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.a,{href:"https://packagist.org/packages/behat/mink-goutte-driver",children:"goutte behat mink driver"})," has been replaced by the ",(0,o.jsx)(n.a,{href:"https://packagist.org/packages/behat/mink-browserkit-driver",children:"browserkit"})," one because the former has been abandoned."]}),"\n",(0,o.jsxs)(n.p,{children:["The change should be completely transparent for (near) everybody. Only ",(0,o.jsxs)(n.strong,{children:["if you are using some custom-generated ",(0,o.jsx)(n.code,{children:"behat.yml"})]})," file or other configuration alternatives different from the Moodle default one, then, ",(0,o.jsxs)(n.strong,{children:["any ",(0,o.jsx)(n.code,{children:"goutte"})," browser occurrence needs to be changed to ",(0,o.jsx)(n.code,{children:"browserkit_http"})]})," when configuring the behat mink extension."]}),"\n",(0,o.jsxs)(n.p,{children:["See ",(0,o.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-78934",children:"MDL-78934"})," for more details and changes applied."]}),"\n",(0,o.jsxs)(n.h3,{id:"removal-of-the---skip-passed-option",children:["Removal of the ",(0,o.jsx)(n.code,{children:"--skip-passed"})," option"]}),"\n",(0,o.jsxs)(n.p,{children:["The legacy (and custom) Behat ",(0,o.jsx)(n.code,{children:"--skip-passed"})," option has been removed completely. Please, use the standard ",(0,o.jsx)(n.code,{children:"--rerun"})," option that provides exactly the same (execution of failed scenarios only)."]}),"\n",(0,o.jsx)(n.h2,{id:"enrolment-methods-support-in-csv-course-upload",children:"Enrolment methods support in CSV course upload"}),"\n",(0,o.jsxs)(n.p,{children:["As part of ",(0,o.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-78855",children:"MDL-78855"})," new methods have been created for ",(0,o.jsx)(n.code,{children:"enrol_plugin"})," to explicitly mark those enrolment methods that are supported in CSV course upload"]}),"\n",(0,o.jsx)(n.p,{children:"Example below for method to be supported:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",metastring:'title="CSV supported"',children:"public function is_csv_upload_supported(): bool {\n    return true;\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Also a new method has been created for ",(0,o.jsx)(n.code,{children:"enrol_plugin"})," to create enrolment instance with custom settings"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",metastring:'title="Add custom instance"',children:"public function add_custom_instance(stdClass $course, ?array $fields = null): ?int {\n    return $this->add_instance($course, $fields);\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["In ",(0,o.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-73839",children:"MDL-73839"})," cohort enrolment method has been updated to support CSV course upload."]}),"\n",(0,o.jsx)(n.h2,{id:"addition-of-comboboxsearch-component",children:"Addition of comboboxsearch component"}),"\n",(0,o.jsx)(d,{version:"4.3",issueNumber:"MDL-77991"}),"\n",(0,o.jsxs)(n.p,{children:["As part of ",(0,o.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-77991",children:"MDL-77991"})," multiple gradebook report searching functionalities were migrated into a centralised core component."]}),"\n",(0,o.jsxs)(n.p,{children:["Details on its use can be found via ",(0,o.jsx)(n.a,{href:"./guides/javascript/comboboxsearch",children:"Combobox searching"})]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(m,{...e})}):m(e)}function f(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}}}]);