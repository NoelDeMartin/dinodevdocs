"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[46403],{22957:(e,n,i)=>{i.d(n,{A:()=>p});i(96540);var t=i(44744),o=i(65285),s=i(1489),r=i(8193),a=i(28453),l=i(74848);const d=function(e,n,i){return void 0===i&&(i="info"),(0,l.jsx)(s.Ay,{item:!0,children:(0,l.jsx)(o.A,{title:n,children:(0,l.jsx)(t.A,{label:e,color:i})})},e)};function c(e){const{example:n,open:i=!1}=e;return n?(0,l.jsx)(s.Ay,{item:!0,xs:12,children:(0,l.jsx)(r.A,{summary:(0,l.jsx)("summary",{children:"View example"}),open:i,children:n})}):null}function p(e){const{filepath:n,summary:i}=e,t=function(e){let{required:n=!1,legacy:i=!1,deprecated:t=!1,refreshedDuringUpgrade:o=!1,refreshedDuringPurge:s=!1}=e;const r=[];return o&&r.push(d("Upgradable","Changes to this file or directory will be re-applied during a Moodle upgrade. If you make any changes to it, you can simply increment the version number and perform a Moodle upgrade.","info")),s&&r.push(d("Refreshed on cache purge","The contents of this file or directory are cached. To see your changes you can simply purge Moodle's caches and refresh the page.","info")),n&&r.push(d("Required","This file must be present","success")),i&&r.push(d("Legacy","Use of this file is being phased out. It is still supported for older installations but will be removed..","warning")),t&&r.push(d("Deprecated","Use of this file is deprecated and not recommended.It may still be provided for older versions of Moodle but is no longer used.","error")),r}(e),o=e.description?(0,l.jsx)(s.Ay,{item:!0,xs:12,children:e.description}):null;return(0,l.jsx)(a.x,{children:(0,l.jsxs)(s.Ay,{container:!0,spacing:2,children:[(0,l.jsx)(s.Ay,{item:!0,xs:6,children:(0,l.jsx)("h4",{children:i})}),(0,l.jsx)(s.Ay,{item:!0,xs:6,children:(0,l.jsx)(s.Ay,{container:!0,spacing:2,justifyContent:"flex-end",children:t})}),(0,l.jsx)(s.Ay,{item:!0,xs:12,children:(0,l.jsxs)("h5",{children:["File path:"," ",n]})}),o,c(e)]})})}},37019:(e,n,i)=>{i.d(n,{rI:()=>p});i(96540);var t=i(47945);const o=JSON.parse('{"plugintypes":{"antivirus":"lib/antivirus","availability":"availability/condition","qtype":"question/type","mod":"mod","auth":"auth","calendartype":"calendar/type","communication":"communication/provider","customfield":"customfield/field","enrol":"enrol","message":"message/output","block":"blocks","media":"media/player","filter":"filter","editor":"lib/editor","format":"course/format","dataformat":"dataformat","profilefield":"user/profile/field","report":"report","coursereport":"course/report","gradeexport":"grade/export","gradeimport":"grade/import","gradereport":"grade/report","gradingform":"grade/grading/form","mlbackend":"lib/mlbackend","mnetservice":"mnet/service","webservice":"webservice","repository":"repository","portfolio":"portfolio","search":"search/engine","qbank":"question/bank","qbehaviour":"question/behaviour","qformat":"question/format","plagiarism":"plagiarism","tool":"admin/tool","cachestore":"cache/stores","cachelock":"cache/locks","fileconverter":"files/converter","contenttype":"contentbank/contenttype","theme":"theme","local":"local","h5plib":"h5p/h5plib","paygw":"payment/gateway"},"subsystems":{"access":null,"admin":"admin","adminpresets":"admin/presets","analytics":"analytics","antivirus":"lib/antivirus","auth":"auth","availability":"availability","backup":"backup/util/ui","badges":"badges","block":"blocks","blog":"blog","bulkusers":null,"cache":"cache","calendar":"calendar","cohort":"cohort","comment":"comment","communication":"communication","competency":"competency","completion":"completion","contentbank":"contentbank","countries":null,"course":"course","courseformat":"course/format","currencies":null,"customfield":"customfield","dbtransfer":null,"debug":null,"editor":"lib/editor","edufields":null,"enrol":"enrol","error":null,"external":"lib/external","favourites":"favourites","filepicker":null,"fileconverter":"files/converter","files":"files","filters":"filter","form":"lib/form","grades":"grade","grading":"grade/grading","group":"group","help":null,"hub":null,"h5p":"h5p","imscc":null,"install":null,"iso6392":null,"langconfig":null,"license":null,"mathslib":null,"media":"media","message":"message","mimetypes":null,"mnet":"mnet","my":"my","notes":"notes","pagetype":null,"payment":"payment","pix":null,"plagiarism":"plagiarism","plugin":null,"portfolio":"portfolio","privacy":"privacy","question":"question","rating":"rating","reportbuilder":"reportbuilder","repository":"repository","rss":"rss","role":"admin/roles","search":"search","table":"lib/table","tag":"tag","timezones":null,"user":"user","userkey":"lib/userkey","webservice":"webservice","xapi":"lib/xapi"}}');var s=i(74848);const r=e=>n=>{let{plugintype:i="plugintype",pluginname:t="pluginname",filepath:o=null}=n,s=(e=>n=>e.plugintypes[n]?e.plugintypes[n]:`[path/to/${n}]`)(e)(i);return s+=t?`/${t}`:"/[pluginname]",`${s}${o}`},a=r(o),l=(a(o),e=>{if(!e.showFileHeader)return"";switch(e?.filetype){case"xml":return"";case"js":case"javascript":return(e=>{let{plugintype:n="plugintype",pluginname:i="pluginname",examplePurpose:t,modulename:o}=e;if(!t)throw Error("Purpose must be specified");if(!o)throw Error("AMD Module name must be specified");return["/**",` * ${t} for the ${n}_${i} plugin.`," *",` * @module   ${n}_${i}/${o}`," * @copyright Year, You Name <your@email.address>"," * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later"," */",""].join("\n")})(e);case"yui":return(e=>{let{plugintype:n="plugintype",pluginname:i="pluginname",examplePurpose:t,modulename:o}=e;if(!t)throw Error("Purpose must be specified");if(!o)throw Error("YUI Module name must be specified");return["/*",` * @package   ${n}_${i}`," * @copyright Year, You Name <your@email.address>"," * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later"," */","","/**",` * @module moodle-${n}_${i}-${o}`," */",""].join("\n")})(e);default:return(e=>{let{plugintype:n="plugintype",pluginname:i="pluginname",examplePurpose:t}=e;if(!t)throw Error("Purpose must be specified");return["/**",` * ${t} for the ${n}_${i} plugin.`," *",` * @package   ${n}_${i}`," * @copyright Year, You Name <your@email.address>"," * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later"," */",""].join("\n")})(e)}}),d=e=>e.showLicense?(e.filetype,"// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n"):"",c=e=>{let{filetype:n="php"}=e;switch(n){case"js":case"javascript":return"javascript";case"xml":return"xml";case"php":case null:return"php";default:return n}},p=(h=o,(e,n)=>{const i={plugintype:"plugintype",showLicense:!0,showFileHeader:!0,filepath:e.exampleFilepath??e.filepath,...e},o=r(h),a=function(e,n){void 0===n&&(n=null);const i=[d(e),l(e),e.example?e.example:n||null].filter((e=>e)).map((e=>e.trim())).join("\n\n");return[(e=>{let{filetype:n="php"}=e;switch(n){case"js":case"javascript":case"xml":return null;default:return"<?php"}})(e),i].filter((e=>e)).join("\n")}(i,n);return(0,s.jsx)(t.A,{title:o(i),language:c(i),children:a})});var h},40733:(e,n,i)=>{i.d(n,{ul:()=>d});var t=i(96540),o=i(22957),s=i(28453),r=i(37019),a=i(74848);const l=e=>"boolean"!=typeof e&&e?"string"==typeof e||t.isValidElement(e)?(0,a.jsx)(s.x,{children:e}):(0,a.jsx)(s.x,{children:(0,a.jsx)(e,{})}):null,d=e=>{const n=(e=>({filetype:"php",examplePurpose:e.summary,...e}))({examplePurpose:e?.summary??null,...e});return n.description=((e,n)=>{let{description:i=null,extraDescription:t=null,children:o=null}=e;if(o){const e=l(o);return(0,a.jsx)(s.x,{children:e})}if(i){const e=l(i);return(0,a.jsx)(s.x,{children:e})}const r=l(n),d=l(t);return r?(0,a.jsxs)(s.x,{children:[r,d]}):null})(n,n?.defaultDescription??null),(n?.example||n?.defaultExample)&&(n.example=(0,r.rI)(n,n?.defaultExample??null)),(0,o.A)(n)}},8328:(e,n,i)=>{i.d(n,{UL:()=>l,ok:()=>p,o$:()=>m,sk:()=>x,sy:()=>b,Rb:()=>M,Mm:()=>_,c0:()=>I,bQ:()=>N,vD:()=>D,ZF:()=>O,Le:()=>U,hO:()=>H,Ze:()=>X,xi:()=>V,zS:()=>Q,f4:()=>ie,JA:()=>se,WM:()=>le,nm:()=>pe,H9:()=>me,bE:()=>xe,tC:()=>be,Wi:()=>Me,g4:()=>_e,HK:()=>Ie,DB:()=>Ne,Hf:()=>Le,bL:()=>$e});i(96540);var t=i(40733),o=i(74848),s=i(28453);function r(e){const n={a:"a",admonition:"admonition",p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"JavaScript in Moodle is written in the ESM format, and transpiled into AMD modules for deployment."}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.a,{href:"../guides/javascript",children:"Moodle JavaScript Guide"})," has detailed information and examples on writing JavaScript in Moodle. Further information is also available in the ",(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/guides/javascript/modules",children:"JavaScript Modules"})," documentation."]}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsx)(n.p,{children:"Although the AMD module format is supported, all new JavaScript is written in the EcmaScript Module (ESM) format."})})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(r,{...e})}):r(e)}const l=e=>(0,o.jsx)(t.ul,{required:!0,defaultDescription:a,defaultExample:"\nimport {fetchThings} from './repository';\n\nexport const updateThings = (thingData) => {\n    return fetchThings(thingData);\n};\n",examplePurpose:"Example module",filepath:"/amd/src/example.js",filetype:"js",modulename:"example",summary:"AMD JavaScript Modules",...e});function d(e){const n={a:"a",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"If your plugin stores data then you may need to implement the Backup feature which allows the activity to backed up, restored, and duplicated."}),"\n",(0,o.jsx)(n.p,{children:"For more information on Backup and restore, see the following:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://docs.moodle.org/dev/Backup_2.0_for_developers",children:"Backup 2.0 for developers"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://docs.moodle.org/dev/Restore_2.0_for_developers",children:"Restore 2.0 for developers"})}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}const p=e=>(0,o.jsx)(t.ul,{filepath:"/backup/",summary:"Plugin Backup configuration",defaultDescription:c,...e});function h(e){const n={a:"a",admonition:"admonition",code:"code",p:"p",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["For plugins which make use of ",(0,o.jsx)(n.a,{href:"https://docs.moodle.org/dev/CLI_scripts",children:"CLI scripts"}),", the convention is that these are placed into the ",(0,o.jsx)(n.code,{children:"cli"})," folder to make their purpose clear, and easy to find."]}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsxs)(n.p,{children:["All CLI scripts ",(0,o.jsx)(n.strong,{children:"must"})," declare themselves as being a CLI script by defining the ",(0,o.jsx)(n.code,{children:"CLI_SCRIPT"})," constant to true before including ",(0,o.jsx)(n.code,{children:"config.php"}),"."]})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}const m=e=>(0,o.jsx)(t.ul,{filepath:"/cli/",summary:"CLI scripts",exampleFilepath:"/cli/example.php",examplePurpose:"Example CLI script",defaultDescription:u,defaultExample:"define('CLI_SCRIPT', true);\n\nrequire_once(__DIR__ . '/../../config.php');\nrequire_once(\"{$CFG->libdir}/clilib.php\");\n\n// Your CLI features go here.\n",...e});function g(e){const n={a:"a",code:"code",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["If your plugin includes a changelog in its root directory, this will be used to automatically pre-fill the release notes field when uploading new versions of your plugin to the ",(0,o.jsx)(n.a,{href:"/general/community/plugincontribution/pluginsdirectory",children:"Plugins directory"}),". This file can be in any of the following locations:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"CHANGES.md"}),": as a markdown file; or"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"CHANGES.txt"}),": as a text file; or"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"CHANGES.html"}),": as an HTML file; or"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"CHANGES"}),": as a text file."]}),"\n"]})]})}function f(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(g,{...e})}):g(e)}const x=e=>(0,o.jsx)(t.ul,{filepath:"/CHANGES",filetype:"php",summary:"Plugin changelog",recommended:!0,defaultDescription:f,...e});function j(e){const n={a:"a",code:"code",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Moodle supports, and recommends, the use of autoloaded PHP classes."}),"\n",(0,o.jsxs)(n.p,{children:["By placing files within the ",(0,o.jsx)(n.code,{children:"classes"})," directory or appropriate sub-directories, and with the correct PHP Namespace, and class name, Moodle is able to autoload classes without the need to manually require, or include them."]}),"\n",(0,o.jsx)(n.p,{children:"Details on these rules and conventions are available in the following documentation:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/general/development/policies/codingstyle#namespaces",children:"Coding style - namespace conventions"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://docs.moodle.org/dev/Automatic_class_loading",children:"Automatic class loading"})}),"\n"]})]})}function y(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(j,{...e})}):j(e)}const b=e=>(0,o.jsx)(t.ul,{filepath:"/classes/",summary:"Autoloaded classes",defaultDescription:y,...e});function v(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",p:"p",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"db/access.php"})," file contains the ",(0,o.jsx)(n.strong,{children:"initial"})," configuration for a plugin's access control rules."]}),"\n",(0,o.jsxs)(n.p,{children:["Access control is handled in Moodle by the use of Roles, and Capabilities. You can read more about these in the ",(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/apis/subsystems/access",children:"Access API"})," documentation."]}),"\n",(0,o.jsxs)(n.admonition,{title:"Changing initial configuration",type:"caution",children:[(0,o.jsxs)(n.p,{children:["If you make changes to the initial configuration of ",(0,o.jsx)(n.em,{children:"existing"})," access control rules, these will only take effect for ",(0,o.jsx)(n.em,{children:"new installations of your plugin"}),". Any existing installation ",(0,o.jsx)(n.strong,{children:"will not"})," be updated with the latest configuration."]}),(0,o.jsx)(n.p,{children:"Updating existing capability configuration for an installed site is not recommended as it may have already been modified by an administrator."})]})]})}function w(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(v,{...e})}):v(e)}const M=e=>(0,o.jsx)(t.ul,{defaultDescription:w,defaultExample:"$capabilities = [\n    // Ability to use the plugin.\n    'plugintype/pluginname:useplugininstance' => [\n        'riskbitmask' => RISK_XSS,\n        'captype' => 'write',\n        'contextlevel' => CONTEXT_COURSE,\n        'archetypes' => [\n            'manager' => CAP_ALLOW,\n            'editingteacher' => CAP_ALLOW,\n        ],\n    ],\n];\n",filepath:"/db/access.php",summary:"Plugin capabilities",examplePurpose:"Plugin capabilities",...e});function T(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["Moodle supports a feature known as _ ",(0,o.jsx)(n.a,{href:"https://docs.moodle.org/dev/Events_API#Event_observers",children:"Event observers"})," _ to allow components to make changes when certain events take place."]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"db/events.php"})," file allows you define any event subscriptions that your plugin needs to listen for."]}),"\n",(0,o.jsx)(n.p,{children:"Event subscriptions are a convenient way to observe events generated elsewhere in Moodle."}),"\n",(0,o.jsxs)(n.admonition,{title:"Communication between components",type:"caution",children:[(0,o.jsxs)(n.p,{children:["You ",(0,o.jsx)(n.em,{children:"should not"})," use event subscriptions to subscribe to events belonging to other plugins, without defining a dependency upon that plugin."]}),(0,o.jsxs)(n.p,{children:["See the ",(0,o.jsx)(n.a,{href:"/general/development/policies/component-communication#event-observers",children:"Component communication principles"})," documentation for a description of some of the risks of doing so."]})]})]})}function P(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(T,{...e})}):T(e)}const _=e=>(0,o.jsx)(t.ul,{refreshedDuringUpgrade:!0,defaultDescription:P,defaultExample:"$observers = [\n    [\n        'eventname' => '\\core\\event\\course_module_created',\n        'callback'  => '\\plugintype_pluginname\\event\\observer\\course_module_created::store',\n        'priority'  => 1000,\n    ],\n];\n",filepath:"/db/events.php",summary:"Event observer definitions",examplePurpose:"Event observer definitions",...e});function E(e){const n={admonition:"admonition",code:"code",em:"em",p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"db/install.php"})," file allows you define a post-installation hook, which is called immediately after the initial creation of your database schema."]}),"\n",(0,o.jsxs)(n.admonition,{type:"caution",children:[(0,o.jsxs)(n.p,{children:["This file is not used at all after the ",(0,o.jsx)(n.em,{children:"initial"})," installation of your plugin."]}),(0,o.jsxs)(n.p,{children:["It is ",(0,o.jsx)(n.em,{children:"not called"})," during any upgrade."]})]})]})}function A(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(E,{...e})}):E(e)}const I=e=>(0,o.jsx)(t.ul,{defaultDescription:A,filepath:"/CHANGES",filetype:"php",summary:"Post-installation hook",...e});function k(e){const n={a:"a",admonition:"admonition",code:"code",p:"p",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"install.xml"})," file is used to define any database tables, fields, indexes, and keys, which should be created for a plugin during its initial installation."]}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsxs)(n.p,{children:["When creating or updating the ",(0,o.jsx)(n.code,{children:"install.xml"})," you ",(0,o.jsx)(n.strong,{children:"must"})," use the built-in ",(0,o.jsx)(n.a,{href:"https://docs.moodle.org/dev/XMLDB_Documentation",children:"XMLDB editor"})," within Moodle."]})})]})}function C(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(k,{...e})}):k(e)}const N=e=>(0,o.jsx)(t.ul,{filepath:"/db/install.xml",summary:"Database schema",examplePurpose:"Database schema",defaultDescription:C,...e});function S(e){const n={a:"a",code:"code",p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"db/messages.php"})," file allows you to declare the messages that your plugin sends."]}),"\n",(0,o.jsxs)(n.p,{children:["See the ",(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/apis/core/message/",children:"Message API"})," documentation for further information."]})]})}function R(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(S,{...e})}):S(e)}const D=e=>(0,o.jsx)(t.ul,{refreshedDuringUpgrade:!0,defaultExample:"\n$messageproviders = [\n    'things' => [\n        'defaults' => [\n            'airnotifier' => MESSAGE_PERMITTED + MESSAGE_DEFAULT_ENABLED,\n        ],\n    ],\n];\n",defaultDescription:R,filepath:"/db/messages.php",summary:"Message provider configuration",examplePurpose:"Message provider configuration",...e});function L(e){const n={a:"a",p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"The Moodle Mobile remote add-on is the mobile app version of the plugin that will be loaded when a user accesses the plugin on the app."}),"\n",(0,o.jsx)(n.p,{children:"A plugin can include several Mobile add-ons. Each add-on must indicate a unique name."}),"\n",(0,o.jsxs)(n.p,{children:["See the ",(0,o.jsx)(n.a,{href:"/general/app/development/plugins-development-guide",children:"Moodle App Plugins development guide"})," for more information on configuring your plugin for the Moodle App."]})]})}function F(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(L,{...e})}):L(e)}const O=e=>(0,o.jsx)(t.ul,{refreshedDuringUpgrade:!0,defaultDescription:F,filepath:"/db/mobile.php",summary:"MoodleMobile version of the plugin",...e});function $(e){const n={a:"a",admonition:"admonition",code:"code",p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["Details of classes that have been renamed to fit in with autoloading. See ",(0,o.jsx)(n.a,{href:"https://moodle.org/mod/forum/discuss.php?d=262403",children:"forum discussion"})," for details."]}),"\n",(0,o.jsxs)(n.admonition,{type:"note",children:[(0,o.jsxs)(n.p,{children:["Adding renamed or moved classes to ",(0,o.jsx)(n.code,{children:"renamedclasses.php"})," is only necessary when the class is part of the component's API where it can be reused by other components, especially by third-party plugins. This is to maintain backwards-compatibility in addition to autoloading purposes."]}),(0,o.jsxs)(n.p,{children:["If the renamed or moved class is private/internal to the component and is not subject for external use, there is no need to add it to ",(0,o.jsx)(n.code,{children:"renamedclasses.php"}),"."]})]})]})}function B(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)($,{...e})}):$(e)}const U=e=>(0,o.jsx)(t.ul,{refreshedDuringPurge:!0,defaultExample:"\ndefined('MOODLE_INTERNAL') || die;\n\n$renamedclasses = [\n    'old_class_name' => 'fully_qualified\\\\new\\\\name',\n\n    // Examples:\n    'assign_header' => 'mod_assign\\\\output\\\\header',\n    '\\assign_header' => 'mod_assign\\\\output\\\\header',\n    '\\assign' => 'mod_assign\\\\assignment',\n\n    // Incorrect:\n    // The new class name should _not_ have a leading \\.\n    'assign_header' => '\\\\mod_assign\\\\output\\\\header',\n];\n",defaultDescription:B,filepath:"/db/renamedclasses.php",summary:"Renamed classes",examplePurpose:"Renamed classes",...e});function G(e){const n={a:"a",admonition:"admonition",code:"code",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"db/services.php"})," file is used to describe the external functions available for use in web services. This includes"]}),"\n",(0,o.jsxs)(n.p,{children:["web service functions defined for JavaScript, and for the ",(0,o.jsx)(n.a,{href:"/general/app",children:"Moodle Mobile App"}),"."]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["Web services should be named following the ",(0,o.jsx)(n.a,{href:"https://docs.moodle.org/dev/Web_service_API_functions#Naming_convention",children:"naming convention for web services"}),"."]})}),"\n",(0,o.jsx)(n.p,{children:"For further information on external functions and web services, see:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/apis/subsystems/external/writing-a-service",children:"Adding a web service to a plugin"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/apis/subsystems/external/writing-a-service",children:"Web services API"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/apis/subsystems/external/functions",children:"External functions API"})}),"\n"]})]})}function q(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(G,{...e})}):G(e)}const H=e=>(0,o.jsx)(t.ul,{refreshedDuringUpgrade:!0,recommended:!0,filepath:"/db/services.php",summary:"Web service function declarations",examplePurpose:"Web service function declarations",defaultExample:"\n$functions = [\n    'plugintype_pluginname_create_things' => [\n        'classname' => 'plugintype_pluginname\\external\\create_things',\n        'description' => 'Create a new thing',\n        'type' => 'write',\n        'ajax' => true,\n        'services' => [\n            MOODLE_OFFICIAL_MOBILE_SERVICE,\n        ],\n    ],\n];\n",defaultDescription:q,...e});function Y(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"db/tasks.php"})," file contains the initial schedule configuration for each of your plugins ",(0,o.jsx)(n.em,{children:"scheduled"})," tasks. Adhoc tasks are not run on a regular schedule and therefore are not described in this file."]}),"\n",(0,o.jsx)(n.admonition,{title:"Editing the schedule for an existing task",type:"caution",children:(0,o.jsx)(n.p,{children:"If an existing task is edited, it will only be updated in the database if the administrator has not customised the schedule of that task in any way."})}),"\n",(0,o.jsxs)(n.p,{children:["The following fields also accept a value of ",(0,o.jsx)(n.code,{children:"R"}),", which indicates that Moodle should choose a random value for that field:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"minute"}),"\n",(0,o.jsx)(n.li,{children:"hour"}),"\n",(0,o.jsx)(n.li,{children:"dayofweek"}),"\n",(0,o.jsx)(n.li,{children:"day"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["See ",(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/apis/commonfiles/db-tasks.php/",children:"db/tasks.php"})," for full details of the file format."]})]})}function W(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(Y,{...e})}):Y(e)}const X=e=>(0,o.jsx)(t.ul,{defaultDescription:W,defaultExample:"$tasks = [\n    [\n        'classname' => 'mod_example\\task\\do_something',\n        'blocking' => 0,\n        'minute' => '30',\n        'hour' => '17',\n        'day' => '*',\n        'month' => '1,7',\n        'dayofweek' => '0',\n    ],\n];\n",filepath:"/db/tasks.php",summary:"Task schedule configuration",examplePurpose:"Task schedule configuration",refreshedDuringUpgrade:!0,...e});function J(e){const n={code:"code",p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"db/uninstall.php"})," file allows you define a pre-uninstallation hook, which is called immediately before all table and data from your plugin are removed."]})}function z(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(J,{...e})}):J(e)}const V=e=>(0,o.jsx)(t.ul,{defaultDescription:z,filepath:"/db/uninstall.php",filetype:"php",summary:"Pre-uninstallation hook",...e});function K(e){const n={a:"a",admonition:"admonition",code:"code",li:"li",ol:"ol",p:"p",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"db/upgrade.php"})," file contains upgrade steps, including database schema changes, changes to settings, and other steps which must be performed during upgrade."]}),"\n",(0,o.jsxs)(n.p,{children:["See the ",(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/guides/upgrade/",children:"Upgrade API"})," documentation for further information."]}),"\n",(0,o.jsxs)(n.admonition,{title:"Generating Database Schema changes",type:"danger",children:[(0,o.jsxs)(n.p,{children:["When making changes to the database schema you ",(0,o.jsx)(n.strong,{children:"must"})," use the build-in ",(0,o.jsx)(n.a,{href:"https://docs.moodle.org/dev/XMLDB_Documentation",children:"XMLDB editor"})," within\nMoodle. This can be used to generate php upgrade steps."]}),(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/apis/commonfiles/#dbinstallxml",children:"install.xml"})," schema must match the schema generated by the upgrade at all times."]})]}),"\n",(0,o.jsx)(n.p,{children:"To create an upgrade step you must:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Use the ",(0,o.jsx)(n.a,{href:"/general/development/tools/xmldb",children:"XMLDB editor"})," to create the definition of the new fields"]}),"\n",(0,o.jsxs)(n.li,{children:["Update the ",(0,o.jsx)(n.code,{children:"install.xml"})," from the XMLDB editor"]}),"\n",(0,o.jsx)(n.li,{children:"Generate the PHP upgrade steps from within the XMLDB Editor"}),"\n",(0,o.jsxs)(n.li,{children:["Update the version number in your ",(0,o.jsx)(n.code,{children:"version.php"})]}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:"In many cases you will be able to combine multiple upgrade steps into a single version change."})}),"\n",(0,o.jsxs)(n.p,{children:["When a version number increment is detected during an upgrade, the ",(0,o.jsx)(n.code,{children:"xmldb_[pluginname]_upgrade"})," function is called with the old version number as the first argument."]}),"\n",(0,o.jsxs)(n.p,{children:["See the ",(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/guides/upgrade/",children:"Upgrade API"})," documentation for more information on the upgrade process."]})]})}function Z(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(K,{...e})}):K(e)}const Q=e=>(0,o.jsx)(t.ul,{recommended:!0,defaultDescription:Z,defaultExample:"\nfunction xmldb_certificate_upgrade($oldversion = 0) {\n    if ($oldversion < 2012091800) {\n        // Add new fields to certificate table.\n        $table = new xmldb_table('certificate');\n        $field = new xmldb_field('showcode');\n        $field->set_attributes(XMLDB_TYPE_INTEGER, '1', XMLDB_UNSIGNED, XMLDB_NOTNULL, null, '0', 'savecert');\n        if (!$dbman->field_exists($table, $field)) {\n            $dbman->add_field($table, $field);\n        }\n        // Add new fields to certificate_issues table.\n        $table = new xmldb_table('certificate_issues');\n        $field = new xmldb_field('code');\n        $field->set_attributes(XMLDB_TYPE_CHAR, '50', null, null, null, null, 'certificateid');\n        if (!$dbman->field_exists($table, $field)) {\n            $dbman->add_field($table, $field);\n        }\n\n        // Certificate savepoint reached.\n        upgrade_mod_savepoint(true, 2012091800, 'certificate');\n    }\n}",filepath:"/db/upgrade.php",summary:"Upgrade steps",examplePurpose:"Upgrade steps",...e});function ee(e){const n={a:"a",p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"A plugin can declare its own environment requirements, in addition to those declared by Moodle core. These may includes features such as PHP extension requirements, version requirements, and similar items."}),"\n",(0,o.jsxs)(n.p,{children:["Further information on this file and its format can be found in the ",(0,o.jsx)(n.a,{href:"https://docs.moodle.org/dev/Environment_checking",children:"Environment checking"})," documentation."]})]})}function ne(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(ee,{...e})}):ee(e)}const ie=e=>(0,o.jsx)(t.ul,{showFileHeader:!1,showLicense:!1,refreshedDuringUpgrade:!0,filepath:"/environment.xml",filetype:"xml",summary:"Plugin-specific environment requirements",defaultDescription:ne,defaultExample:'\n<?xml version="1.0" encoding="UTF-8" ?>\n<COMPATIBILITY_MATRIX>\n  <PLUGIN name="plugintype_pluginname">\n    <PHP_EXTENSIONS>\n      <PHP_EXTENSION name="soap" level="required">\n      </PHP_EXTENSION>\n    </PHP_EXTENSIONS>\n  </PLUGIN>\n</COMPATIBILITY_MATRIX>',...e});function te(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["Each plugin must define a set of language strings with, at a minimum, an English translation. These are specified in the plugin's ",(0,o.jsx)(n.code,{children:"lang/en"})," directory in a file named after the plugin. For example the LDAP authentication plugin:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"// Plugin type: `auth`\n// Plugin name: `ldap`\n// Frankenstyle plugin name: `auth_ldap`\n// Plugin location: `auth/ldap`\n// Language string location: `auth/ldap/lang/en/auth_ldap.php`\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:["Every plugin ",(0,o.jsx)(n.em,{children:"must"})," define the name of the plugin, or its ",(0,o.jsx)(n.code,{children:"pluginname"}),"."]})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"get_string"})," API can be used to translate a string identifier back into a translated string."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"get_string('pluginname', '[plugintype]_[pluginname]');\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["See the ",(0,o.jsx)(n.a,{href:"https://docs.moodle.org/dev/String_API#Adding_language_file_to_plugin",children:"String API"})," documentation for more information on language files."]}),"\n"]})]})}function oe(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(te,{...e})}):te(e)}const se=e=>(0,o.jsx)(t.ul,{filepath:"/lang/en/plugintype_pluginname.php",refreshedDuringPurge:!0,required:!0,summary:"Language files",examplePurpose:"Languages configuration",defaultDescription:oe,defaultExample:"$string['pluginname'] = 'The name of my plugin will go here';",...e});function re(e){const n={a:"a",admonition:"admonition",code:"code",p:"p",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"lib.php"})," file is a legacy file which acts as a bridge between Moodle core, and the plugin. In recent plugins it is should only used to define callbacks and related functionality which currently is not supported as an auto-loadable class."]}),"\n",(0,o.jsxs)(n.p,{children:["All functions defined in this file ",(0,o.jsx)(n.strong,{children:"must"})," meet the requirements set out in the relevant section of the ",(0,o.jsx)(n.a,{href:"/general/development/policies/codingstyle#functions-and-methods",children:"Coding style"}),"."]}),"\n",(0,o.jsx)(n.admonition,{title:"Performance impact",type:"note",children:(0,o.jsxs)(n.p,{children:["Moodle core often loads all the ",(0,o.jsx)("tt",{children:"lib.php"})," files of a given plugin types. For performance reasons, it is strongly recommended to keep this file as small as possible and have just required code implemented in it. All the plugin's internal logic should be implemented in the auto-loaded classes."]})})]})}function ae(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(re,{...e})}):re(e)}const le=e=>(0,o.jsx)(t.ul,{legacy:!0,required:!1,filepath:"/lib.php",summary:"Global plugin functions",examplePurpose:"Plugin functions",defaultDescription:ae,...e});function de(e){const n={a:"a",admonition:"admonition",p:"p",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.admonition,{title:"Legacy feature",type:"caution",children:(0,o.jsx)(n.p,{children:"The use of this file is no longer recommended, and new uses of it will not be permitted in core code."})}),"\n",(0,o.jsxs)(n.p,{children:["Rather than creating global functions in a global namespace in a ",(0,o.jsx)("tt",{children:"locallib.php"})," file, you should use autoloaded classes which are located in the ",(0,o.jsx)("tt",{children:"classes/"})," directory."]}),"\n",(0,o.jsxs)(n.p,{children:["Where this file is in use, all functions ",(0,o.jsx)(n.strong,{children:"must"})," meet the requirements set out in the relevant section of the ",(0,o.jsx)(n.a,{href:"/general/development/policies/codingstyle#functions-and-methods",children:"Coding style"})]}),"\n",(0,o.jsxs)(n.p,{children:["Existing functions which have been incorrectly named ",(0,o.jsx)(n.strong,{children:"will not"})," be accepted as an example of an existing convention. Existing functions which are incorrectly named ",(0,o.jsx)(n.strong,{children:"should"})," be converted to use a namespaced class."]})]})}function ce(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(de,{...e})}):de(e)}const pe=e=>(0,o.jsx)(t.ul,{defaultDescription:ce,filepath:"/locallib.php",legacy:!0,required:!1,summary:"Global support functions",...e});function he(e){const n={a:"a",code:"code",p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Plugins can provide icons in several formats, and most plugin types require that a default icon be provided."}),"\n",(0,o.jsxs)(n.p,{children:["Where a browser supports it, the ",(0,o.jsx)(n.code,{children:"svg"})," format is used, falling back to ",(0,o.jsx)(n.code,{children:"png"})," formats when an SVG is unavailable."]}),"\n",(0,o.jsxs)(n.p,{children:["Full details of the correct naming, sizing, and design guidelines for icons in Moodle can be found in the ",(0,o.jsx)(n.a,{href:"https://docs.moodle.org/dev/Moodle_icons",children:"Moodle icons"})," documentation."]})]})}function ue(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(he,{...e})}):he(e)}const me=e=>(0,o.jsx)(t.ul,{defaultDescription:ue,refreshedDuringPurge:!0,filepath:"/pix/",summary:"Plugins icons",...e});function ge(e){const n={a:"a",code:"code",p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["We recommend that you include any additional information for your plugin in a project readme file. Ideally this should act as an offline version of all information in your plugin's page in the ",(0,o.jsx)(n.a,{href:"/general/community/plugincontribution/pluginsdirectory",children:"Plugins directory"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["We recommend creating your readme file in either a ",(0,o.jsx)(n.code,{children:"README.md"}),", or ",(0,o.jsx)(n.code,{children:"README.txt"})," format."]})]})}function fe(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(ge,{...e})}):ge(e)}const xe=e=>(0,o.jsx)(t.ul,{filepath:"/README",recommended:!0,defaultDescription:fe,summary:"Plugin Information for Administrators",...e});function je(e){const n={code:"code",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["When importing a third-party library into your plugin, it is advisable to create a ",(0,o.jsx)(n.code,{children:"readme_moodle.txt"})," file detailing relevant information, including:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Download URLs"}),"\n",(0,o.jsx)(n.li,{children:"Build instructions"}),"\n"]})]})}function ye(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(je,{...e})}):je(e)}const be=e=>(0,o.jsx)(t.ul,{recommended:!0,filepath:"/*/readme_moodle.txt",defaultDescription:ye,summary:"Third-party library import instructions",...e});function ve(e){const n={a:"a",admonition:"admonition",code:"code",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["You can define settings for your plugin that the administrator can configure by creating a ",(0,o.jsx)(n.code,{children:"settings.php"})," file in the root of your plugins' directory."]}),"\n",(0,o.jsxs)(n.admonition,{type:"caution",children:[(0,o.jsx)(n.p,{children:"Settings must named in the following format:"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"plugintype_pluginname/settingname\n"})}),(0,o.jsxs)(n.p,{children:["By following the correct naming, all settings will automatically be stored in the ",(0,o.jsx)(n.code,{children:"config_plugins"})," database table."]})]}),"\n",(0,o.jsxs)(n.p,{children:["Full details on how to create settings are available in the ",(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/apis/subsystems/admin/",children:"Admin settings"})," documentation."]})]})}function we(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(ve,{...e})}):ve(e)}const Me=e=>(0,o.jsx)(t.ul,{defaultDescription:we,filepath:"/settings.php",summary:"Plugin settings",examplePurpose:"Plugin settings",...e});function Te(e){const n={a:"a",admonition:"admonition",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Plugins may define a '/styles.css' to provide plugin-specific styling. See the following for further documentation:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/general/community/plugincontribution/checklist#css-styles",children:"Plugin contribution checklist#CSS styles"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://docs.moodle.org/dev/CSS_Coding_Style",children:"CSS Coding Style"})}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{title:"Avoid custom styles where possible",type:"tip",children:(0,o.jsx)(n.p,{children:"Rather than writing custom CSS for your plugin, where possible apply Bootstrap classes to the DOM elements in your output. These will be easier to maintain and will adopt most colour, branding, and other customisations applied to a theme."})})]})}function Pe(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(Te,{...e})}):Te(e)}const _e=e=>(0,o.jsx)(t.ul,{refreshedDuringPurge:!0,defaultDescription:Pe,filepath:"/styles.css",summary:"CSS style sheet for your plugin",...e});function Ee(e){const n={a:"a",admonition:"admonition",code:"code",p:"p",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["Details of all third-party libraries should be declared in the ",(0,o.jsx)(n.code,{children:"thirdpartylibs.xml"})," file."]}),"\n",(0,o.jsx)(n.p,{children:"This information is used to generate ignore file configuration for linting tools. For Moodle core it is also used to generate library information as part of release notes and credits."}),"\n",(0,o.jsxs)(n.p,{children:["Within the XML the ",(0,o.jsx)(n.code,{children:"location"})," is a file, or directory, relative to your plugin's root."]}),"\n",(0,o.jsx)(n.admonition,{title:"Licensing",type:"caution",children:(0,o.jsxs)(n.p,{children:["The license of any third-party code included in your plugin, and within the ",(0,o.jsx)(n.code,{children:"thirdpartylibs.xml"})," file ",(0,o.jsx)(n.strong,{children:"must"})," be ",(0,o.jsx)(n.a,{href:"http://www.gnu.org/licenses/license-list.html#GPLCompatibleLicenses",children:"compatible with the GNU GPLv3"}),"."]})}),"\n",(0,o.jsxs)(n.p,{children:["See the ",(0,o.jsx)(n.a,{href:"https://docs.moodle.org/dev/Third_Party_Libraries",children:"Third Party Libraries"})," documentation for further information."]})]})}function Ae(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(Ee,{...e})}):Ee(e)}const Ie=e=>(0,o.jsx)(t.ul,{defaultDescription:Ae,defaultExample:'<?xml version="1.0"?>\n<libraries>\n    <library>\n        <location>javascript/html5shiv.js</location>\n        <name>Html5Shiv</name>\n        <version>3.6.2</version>\n        <license>Apache</license>\n        <licenseversion>2.0</licenseversion>\n    </library>\n    <library>\n        <location>vendor/guzzle/guzzle/</location>\n        <name>guzzle</name>\n        <version>v3.9.3</version>\n        <license>MIT</license>\n        <licenseversion></licenseversion>\n    </library>\n</libraries>',filepath:"/thirdpartylibs.xml",filetype:"xml",summary:"Details of third-party libraries included in the plugin",showLicense:!1,showFileHeader:!1,...e});function ke(e){const n={code:"code",em:"em",h4:"h4",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["Each component and subsystem may make use of an ",(0,o.jsx)(n.code,{children:"upgrade.txt"})," file in the top level folder. A section title is used to identify the Moodle version where the change was introduced, and significant changes for that version relating to that component or subsystem are noted."]}),"\n",(0,o.jsxs)(n.p,{children:["For example, given an API change is applied for the upcoming Moodle version 4.1 which is still in the ",(0,o.jsx)(n.strong,{children:"master"})," branch (4.1dev), the version number on the ",(0,o.jsx)(n.code,{children:"upgrade.txt"}),"'s section title will be set to ",(0,o.jsx)(n.strong,{children:"4.1"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-txt",metastring:'title="Example 1: Change applied to the master branch"',children:"== 4.1 ==\nAn API change to empower educators!\n"})}),"\n",(0,o.jsx)(n.h4,{id:"changes-applied-to-multiple-branches",children:"Changes applied to multiple branches"}),"\n",(0,o.jsxs)(n.p,{children:["When changes are integrated to multiple branches, for example a stable version and the master branch, then the relevant versions used to describe the change in the ",(0,o.jsx)(n.code,{children:"upgrade.txt"})," file should be the next version to be released ",(0,o.jsx)(n.em,{children:"for each branch"}),". The ",(0,o.jsx)(n.strong,{children:"master"})," branch should always use the next major version."]}),"\n",(0,o.jsxs)(n.p,{children:["For example, if a change is applied to the ",(0,o.jsx)(n.strong,{children:"MOODLE_400_STABLE"})," during the development of Moodle 4.0.2, and the ",(0,o.jsx)(n.strong,{children:"master"})," branch during the development of Moodle 4.1, then the relevant versions will be ",(0,o.jsx)(n.strong,{children:"4.0.2"})," and ",(0,o.jsx)(n.strong,{children:"4.1"}),", respectively. The section title for the ",(0,o.jsx)(n.strong,{children:"master"})," branch will be the same as the one in Example 1. The section title for the ",(0,o.jsx)(n.strong,{children:"MOODLE_400_STABLE"})," branch will indicate the next upcoming minor version (4.0.2 in this case):"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-txt",metastring:'title="Example 2: Patch applied to master and MOODLE_400_STABLE"',children:"== 4.0.2 ==\nAn API change to empower educators!\n"})}),"\n",(0,o.jsx)(n.h4,{id:"mentioning-other-moodle-versions-the-change-applies-to",children:"Mentioning other Moodle versions the change applies to"}),"\n",(0,o.jsxs)(n.p,{children:["Multiple versions within the section title are ",(0,o.jsx)(n.strong,{children:"not"})," allowed. However, developers may note the Moodle versions that the change applies to within the upgrade note text itself."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-txt",metastring:'title="Example 3a: master (4.1dev)"',children:"== 4.1 ==\nAn API change to empower educators! (This was fixed in 4.1 and 4.0.2)\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-txt",metastring:'title="Example 3b: MOODLE_400_STABLE"',children:"== 4.0.2 ==\nAn API change to empower educators! (This was fixed in 4.1 and 4.0.2)\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-txt",metastring:'title="Example 3c: (INCORRECT) Multiple versions on the section title"',children:"== 4.1, 4.0.2 ==\nAn API change to empower educators!\n"})}),"\n",(0,o.jsx)(n.h4,{id:"exception-during-parallel-development",children:"Exception during parallel development"}),"\n",(0,o.jsx)(n.p,{children:"When Moodle is developing two major versions in parallel, for example Moodle 3.11.0, and Moodle 4.0.0, then the\nversion in the earliest of the major version development branches will be used for both branches."}),"\n",(0,o.jsxs)(n.p,{children:["For example, given we are in a parallel development situation with ",(0,o.jsx)(n.strong,{children:"MOODLE_311_STABLE"})," (3.11dev) and ",(0,o.jsx)(n.strong,{children:"master"})," (4.0dev), with Moodle 3.11 as the next upcoming major Moodle version. If an API change is applied to ",(0,o.jsx)(n.strong,{children:"MOODLE_311_STABLE"}),", the version number on the section title will be ",(0,o.jsx)(n.strong,{children:"3.11"})," for both ",(0,o.jsx)(n.strong,{children:"master"})," and ",(0,o.jsx)(n.strong,{children:"MOODLE_400_STABLE"})," branches."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-txt",metastring:'title="Example 4a: master (4.0dev)"',children:"== 3.11 ==\nAn API change to empower educators!\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-txt",metastring:'title="Example 4b: MOODLE_311_STABLE (3.11dev)"',children:"== 3.11 ==\nAn API change to empower educators!\n"})})]})}function Ce(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(ke,{...e})}):ke(e)}const Ne=e=>(0,o.jsx)(t.ul,{recommended:!0,filepath:"/*/upgrade.txt",defaultDescription:Ce,summary:"Significant changes for each version of your plugin",...e});function Se(e){const n={li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"The version.php contains metadata about the plugin."}),"\n",(0,o.jsx)(n.p,{children:"It is used during the installation and upgrade of the plugin."}),"\n",(0,o.jsx)(n.p,{children:"This file contains metadata used to describe the plugin, and includes information such as:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"the version number"}),"\n",(0,o.jsx)(n.li,{children:"a list of dependencies"}),"\n",(0,o.jsx)(n.li,{children:"the minimum Moodle version required"}),"\n",(0,o.jsx)(n.li,{children:"maturity of the plugin"}),"\n"]})]})}function Re(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(Se,{...e})}):Se(e)}const De="defined('MOODLE_INTERNAL') || die();\n\n$plugin->version = TODO;\n$plugin->requires = TODO;\n$plugin->supported = TODO;   // Available as of Moodle 3.9.0 or later.\n$plugin->incompatible = TODO;   // Available as of Moodle 3.9.0 or later.\n$plugin->component = 'TODO_FRANKENSTYLE';\n$plugin->maturity = MATURITY_STABLE;\n$plugin->release = 'TODO';\n\n$plugin->dependencies = [\n    'mod_forum' => 2022042100,\n    'mod_data' => 2022042100\n];\n";function Le(e){return(0,o.jsx)(t.ul,{required:!0,filepath:"/version.php",filetype:"php",summary:"Version metadata",examplePurpose:"Version metadata",defaultDescription:Re,defaultExample:De,...e})}function Fe(e){const n={a:"a",admonition:"admonition",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["In older versions of Moodle, JavaScript was written in the YUI format. This is being phased out in favour of ",(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/guides/javascript/modules",children:"JavaScript Modules"}),", although some older uses still remain in Moodle core."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/guides/javascript/yui/modules",children:"YUI/Modules"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/guides/javascript/yui/",children:"YUI"})}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsxs)(n.p,{children:["New YUI code will not be accepted into Moodle core, except for new plugins for the ",(0,o.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/apis/plugintypes/atto/",children:"Atto editor"}),"."]})})]})}function Oe(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(Fe,{...e})}):Fe(e)}const $e=e=>(0,o.jsx)(t.ul,{legacy:!0,refreshedDuringPurge:!0,defaultDescription:Oe,filepath:"/yui/",examplePurpose:"YUI JavaScript Modules",summary:"YUI JavaScript Modules",...e})},555:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var t=i(74848),o=i(28453),s=i(78924);i(8328);const r={title:"TinyMCE Editor Plugins",tags:["editor_tiny","tiny","Editor","Text editor","HTML editor","WYSIWYG","TinyMCE"]},a=void 0,l={id:"apis/plugintypes/tiny/index",title:"TinyMCE Editor Plugins",description:"Moodle includes the TinyMCE text editor as standard from Moodle 4.1, and it can be installed from the plugins database for Moodle versions 3.11, and 4.0.",source:"@site/versioned_docs/version-4.3/apis/plugintypes/tiny/index.md",sourceDirName:"apis/plugintypes/tiny",slug:"/apis/plugintypes/tiny/",permalink:"/moodledevdocs/docs/4.3/apis/plugintypes/tiny/",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/versioned_docs/version-4.3/apis/plugintypes/tiny/index.md",tags:[{label:"editor_tiny",permalink:"/moodledevdocs/docs/4.3/tags/editor-tiny"},{label:"tiny",permalink:"/moodledevdocs/docs/4.3/tags/tiny"},{label:"Editor",permalink:"/moodledevdocs/docs/4.3/tags/editor"},{label:"Text editor",permalink:"/moodledevdocs/docs/4.3/tags/text-editor"},{label:"HTML editor",permalink:"/moodledevdocs/docs/4.3/tags/html-editor"},{label:"WYSIWYG",permalink:"/moodledevdocs/docs/4.3/tags/wysiwyg"},{label:"TinyMCE",permalink:"/moodledevdocs/docs/4.3/tags/tiny-mce"}],version:"4.3",lastUpdatedBy:"Sara Arjona",lastUpdatedAt:1697795601e3,frontMatter:{title:"TinyMCE Editor Plugins",tags:["editor_tiny","tiny","Editor","Text editor","HTML editor","WYSIWYG","TinyMCE"]},sidebar:"docs",previous:{title:"Repository plugins",permalink:"/moodledevdocs/docs/4.3/apis/plugintypes/repository/"},next:{title:"Legacy TinyMCE Editor plugins",permalink:"/moodledevdocs/docs/4.3/apis/plugintypes/tiny/legacy"}},d={},c=[{value:"File structure",id:"file-structure",level:2},{value:"Creating a new plugin",id:"creating-a-new-plugin",level:2},{value:"Generating the plugin skeleton",id:"generating-the-plugin-skeleton",level:3},{value:"Key files",id:"key-files",level:2},{value:"common.js",id:"commonjs",level:3},{value:"plugin.js",id:"pluginjs",level:3},{value:"The default export",id:"the-default-export",level:4},{value:"Preparation",id:"preparation",level:4},{value:"Registration of the plugin",id:"registration-of-the-plugin",level:4},{value:"commands.js",id:"commandsjs",level:3},{value:"<code>handleAction(editor)</code>",id:"handleactioneditor",level:4},{value:"<code>getSetup()</code>",id:"getsetup",level:4},{value:"The curried setup function",id:"the-curried-setup-function",level:4},{value:"Plugin options - <code>options.js</code> and <code>plugininfo.php</code>",id:"plugin-options---optionsjs-and-plugininfophp",level:3},{value:"Editor configuration - <code>configuration.js</code>",id:"editor-configuration---configurationjs",level:3}];function p(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components},{Details:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.A,{frontMatter:r,metadata:l}),"\n",(0,t.jsx)(n.p,{children:"Moodle includes the TinyMCE text editor as standard from Moodle 4.1, and it can be installed from the plugins database for Moodle versions 3.11, and 4.0."}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"editor_tiny"})," editor supports the inclusion of subplugins, which have the namespace ",(0,t.jsx)(n.code,{children:"tiny_[pluginname]"}),"."]}),"\n","\n",(0,t.jsx)(n.h2,{id:"file-structure",children:"File structure"}),"\n",(0,t.jsxs)(n.p,{children:["TinyMCE subplugins are located in the ",(0,t.jsx)(n.code,{children:"/lib/editor/tiny/plugins"})," directory. A plugin should not include any custom files outside of its own plugin folder."]}),"\n",(0,t.jsxs)(n.p,{children:["Each plugin is in a separate subdirectory and consists of a number of ",(0,t.jsx)(n.em,{children:"mandatory files"})," and any other files the developer is going to use."]}),"\n",(0,t.jsx)(n.admonition,{type:"important",children:(0,t.jsxs)(n.p,{children:["Some of the important files are described below. See the ",(0,t.jsx)(n.a,{href:"/moodledevdocs/docs/4.3/apis/commonfiles/",children:"common plugin files"})," documentation for details of other files which may be useful in your plugin."]})}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsxs)("summary",{children:["The directory layout for the ",(0,t.jsx)(n.code,{children:"tiny_example"})," plugin."]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-console",children:"lib/editor/tiny/plugins/example\n\u251c\u2500\u2500 amd\n\u2502\xa0\xa0 \u251c\u2500\u2500 build\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 commands.min.js\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 commands.min.js.map\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 common.min.js\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 common.min.js.map\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 configuration.min.js\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 configuration.min.js.map\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 options.min.js\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 options.min.js.map\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 plugin.min.js\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 plugin.min.js.map\n\u2502\xa0\xa0 \u2514\u2500\u2500 src\n\u2502\xa0\xa0     \u251c\u2500\u2500 commands.js\n\u2502\xa0\xa0     \u251c\u2500\u2500 common.js\n\u2502\xa0\xa0     \u251c\u2500\u2500 configuration.js\n\u2502\xa0\xa0     \u251c\u2500\u2500 options.js\n\u2502\xa0\xa0     \u2514\u2500\u2500 plugin.js\n\u251c\u2500\u2500 classes\n\u2502\xa0\xa0 \u251c\u2500\u2500 plugininfo.php\n\u2502\xa0\xa0 \u2514\u2500\u2500 privacy\n\u2502\xa0\xa0     \u2514\u2500\u2500 provider.php\n\u251c\u2500\u2500 lang\n\u2502\xa0\xa0 \u2514\u2500\u2500 en\n\u2502\xa0\xa0     \u2514\u2500\u2500 tiny_example.php\n\u251c\u2500\u2500 settings.php\n\u2514\u2500\u2500 version.php\n"})})]}),"\n",(0,t.jsxs)(n.admonition,{type:"info",children:[(0,t.jsx)(n.p,{children:"You will notice that the JavaScript is broken down into a number of source files."}),(0,t.jsx)(n.p,{children:"This separation is optional, but fits a convention demonstrate in the TinyMCE codebase, and make the code easier to read and understand."})]}),"\n",(0,t.jsx)(n.h2,{id:"creating-a-new-plugin",children:"Creating a new plugin"}),"\n",(0,t.jsxs)(n.p,{children:["We highly recommend using the ",(0,t.jsx)(n.a,{href:"https://moodle.org/plugins/tool_pluginskel",children:"Plugin Skeleton Generator"})," when creating a new plugin."]}),"\n",(0,t.jsx)(n.p,{children:"For the sake of simplicity, this documentation assumes that you have created a new Plugin using the following skeleton configuration:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yml",metastring:'title="tiny_example.yml"',children:"component: tiny_example\nname: Example Plugin\nrelease: \"0.1.0\"\ncopyright: 2022 Andrew Lyons <andrew@nicols.co.uk>\nfeatures:\n  settings: true\nprivacy:\n  haspersonaldata: false\n  uselegacypolyfill: false\ntiny_features:\n  buttons:\n    - name: startdemo\n      category:  content\n      text: Start demo\n  menuitems:\n    - name: startdemo\n      category: file\n      text: 'Start the demo'\n  options:\n    - name: myFirstProperty\n      type: string\n"})}),"\n",(0,t.jsx)(n.h3,{id:"generating-the-plugin-skeleton",children:"Generating the plugin skeleton"}),"\n",(0,t.jsxs)(n.p,{children:["Once you have created a plugin skeleton configuration, you can generate your plugin using the ",(0,t.jsx)(n.code,{children:"cli/generate.php"})," command:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-console",children:"php admin/tool/pluginskel/cli/generate.php tiny_example.yml\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This will generate a working skeleton file for your plugin. Remember that you component name must start with ",(0,t.jsx)(n.code,{children:"tiny_"}),"."]}),"\n",(0,t.jsxs)(n.admonition,{title:"Compiled JavaScript",type:"note",children:[(0,t.jsxs)(n.p,{children:["The plugin skeleton only produces source files for JavaScript. You will need to run ",(0,t.jsx)(n.code,{children:"grunt"})," to compile this code."]}),(0,t.jsxs)(n.p,{children:["We highly recommend using ",(0,t.jsx)(n.code,{children:"grunt watch"})," during development to simplify your workflow."]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-console",children:"cd lib/editor/tiny/plugins/example && npx grunt amd && cd -\n"})})]}),"\n",(0,t.jsx)(n.h2,{id:"key-files",children:"Key files"}),"\n",(0,t.jsx)(n.p,{children:"There are a number of key files within the generated plugin skeleton, described below."}),"\n",(0,t.jsx)(n.h3,{id:"commonjs",children:"common.js"}),"\n",(0,t.jsx)(n.p,{children:"The common.js file is used to store a set of variables used by other parts of the plugin."}),"\n",(0,t.jsx)(n.p,{children:"Its usage is optional, but recommended as it reduces code duplication, and the potential for typos and mistakes. It also makes it easier to refactor code later."}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:" An example common.js file generated by the plugin skeleton generator "}),(0,t.jsx)(n.p,{children:"This example includes:"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["the plugin name (",(0,t.jsx)(n.code,{children:"tiny_example/plugin"}),");"]}),"\n",(0,t.jsxs)(n.li,{children:["an icon, whose name is ",(0,t.jsx)(n.code,{children:"tiny_example"}),";"]}),"\n",(0,t.jsxs)(n.li,{children:["a button for the start demo action, whose name is ",(0,t.jsx)(n.code,{children:"tiny_example_startdemo"}),"; and"]}),"\n",(0,t.jsxs)(n.li,{children:["a menu item for the start demo action, whose name is ",(0,t.jsx)(n.code,{children:"tiny_example_startdemo"}),"."]}),"\n"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="commons=.js"',children:"const component = 'tiny_example';\n\nexport default {\n    component,\n    pluginName: `${component}/plugin`,\n    icon: component,\n    startdemoButtonName: `${component}_startdemo`,\n    startdemoMenuItemName: `${component}_startdemo`,\n};\n"})})]}),"\n",(0,t.jsx)(n.p,{children:"Typically this file will be included in other JS files in the plugin, usually only fetching the required variables, for example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"import {component, pluginName} from './common';\n"})}),"\n",(0,t.jsx)(n.h3,{id:"pluginjs",children:"plugin.js"}),"\n",(0,t.jsx)(n.p,{children:"The plugin.js is the entrypoint to the plugin code. It is primarily responsible for registering the plugin with the TinyMCE API, and the Moodle Integration of the Editor."}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:" An example plugin.js file generated by the plugin skeleton generator "}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="plugin.js"',children:"import {getTinyMCE} from 'editor_tiny/loader';\nimport {getPluginMetadata} from 'editor_tiny/utils';\n\nimport {component, pluginName} from './common';\nimport {register as registerOptions} from './options';\nimport {getSetup as getCommandSetup} from './commands';\nimport * as Configuration from './configuration';\n\n// Setup the tiny_example Plugin.\nexport default new Promise(async(resolve) => {\n    // Note: The PluginManager.add function does not support asynchronous configuration.\n    // Perform any asynchronous configuration here, and then call the PluginManager.add function.\n    const [\n        tinyMCE,\n        pluginMetadata,\n        setupCommands,\n    ] = await Promise.all([\n        getTinyMCE(),\n        getPluginMetadata(component, pluginName),\n        getCommandSetup(),\n    ]);\n\n    // Reminder: Any asynchronous code must be run before this point.\n    tinyMCE.PluginManager.add(pluginName, (editor) => {\n        // Register any options that your plugin has\n        registerOptions(editor);\n\n        // Setup any commands such as buttons, menu items, and so on.\n        setupCommands(editor);\n\n        // Return the pluginMetadata object. This is used by TinyMCE to display a help link for your plugin.\n        return pluginMetadata;\n    });\n\n    resolve([pluginName, Configuration]);\n});\n"})})]}),"\n",(0,t.jsx)(n.p,{children:"The plugin can be broadly broken down into several different areas:"}),"\n",(0,t.jsx)(n.h4,{id:"the-default-export",children:"The default export"}),"\n",(0,t.jsx)(n.p,{children:"Every plugin must return a default export containing a new Promise."}),"\n",(0,t.jsx)(n.p,{children:"This allows the API to load multiple plugins in parallel with minimal blocking."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// Imports go here.\nexport default new Promise(async(resolve) => {\n    // Configure the plugin here.\n\n    // Resolve when the plugin has been configured.\n    resolve([pluginName, Configuration]);\n});\n"})}),"\n",(0,t.jsx)(n.h4,{id:"preparation",children:"Preparation"}),"\n",(0,t.jsx)(n.p,{children:"The TinyMCE API does not support asynchronous code in the plugin registration. Therefore any asynchronous tasks must be complete before registering the plugin with the TinyMCE API, and before resolving the Promise."}),"\n",(0,t.jsx)(n.p,{children:"In the following example, we fetch the tinyMCE API, a set of plugin metadata to use, and a command setup function to call later on."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// Note: The PluginManager.add function does not support asynchronous configuration.\n// Perform any asynchronous configuration here, and then call the PluginManager.add function.\nconst [\n    tinyMCE,\n    pluginMetadata,\n    setupCommands,\n] = await Promise.all([\n    getTinyMCE(),\n    getPluginMetadata(component, pluginName),\n    getCommandSetup(),\n]);\n"})}),"\n",(0,t.jsx)(n.h4,{id:"registration-of-the-plugin",children:"Registration of the plugin"}),"\n",(0,t.jsx)(n.p,{children:"Once all of the dependencies are available, we can register the plugin with the TinyMCE PluginManager API."}),"\n",(0,t.jsxs)(n.p,{children:["In this example, we register a plugin whose name is represented as a string in the ",(0,t.jsx)(n.code,{children:"pluginName"})," variable."]}),"\n",(0,t.jsxs)(n.p,{children:["Whenever a new editor instance is created, it will call the callback providing the ",(0,t.jsx)(n.code,{children:"editor"})," argument."]}),"\n",(0,t.jsxs)(n.p,{children:["At the end of the plugin instantiation, it returns a ",(0,t.jsx)(n.code,{children:"pluginMetadata"})," object, which contains information about the plugin displayed in the help dialogue for the plugin."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// Reminder: Any asynchronous code must be run before this point.\ntinyMCE.PluginManager.add(pluginName, (editor) => {\n    // Register any options that your plugin has\n    registerOptions(editor);\n\n    // Setup any commands such as buttons, menu items, and so on.\n    setupCommands(editor);\n\n    // Return the pluginMetadata object. This is used by TinyMCE to display a help link for your plugin.\n    return pluginMetadata;\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["In this example, the plugin describes a set of options which will be passed from the PHP description of the plugin - these are handled by the ",(0,t.jsx)(n.code,{children:"registerOptions(editor)"})," call."]}),"\n",(0,t.jsx)(n.p,{children:"It also has a set of 'commands', which are a generic term used to describe any Buttons, MenuItems, and related UI features of the editor."}),"\n",(0,t.jsx)(n.h3,{id:"commandsjs",children:"commands.js"}),"\n",(0,t.jsxs)(n.p,{children:["TinyMCE supports a range of commands. These are further defined in the TinyMCE API: ",(0,t.jsx)(n.a,{href:"https://www.tiny.cloud/docs/tinymce/6/apis/tinymce.editor.ui.registry/",children:"tinymce.editor.ui.Registry"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Most plugins will make use of one or more of the following commands, but others are also available:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.tiny.cloud/docs/tinymce/6/apis/tinymce.editor.ui.registry/#addIcon",children:"addIcon"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.tiny.cloud/docs/tinymce/6/apis/tinymce.editor.ui.registry/#addButton",children:"addButton"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.tiny.cloud/docs/tinymce/6/apis/tinymce.editor.ui.registry/#addToggleButton",children:"addToggleButton"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.tiny.cloud/docs/tinymce/6/apis/tinymce.editor.ui.registry/#addMenuItem",children:"addMenuItem"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.tiny.cloud/docs/tinymce/6/apis/tinymce.editor.ui.registry/#addToggleMenuItem",children:"addToggleMenuItem"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Plugins may use any parts of the TinyMCE API that they need."}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:" An example commands.js file generated by the plugin skeleton generator "}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'tilte="commands.js"',children:"import {getButtonImage} from 'editor_tiny/utils';\nimport {get_string as getString} from 'core/str';\nimport {\n    component,\n    startdemoButtonName,\n    startdemoMenuItemName,\n    icon,\n} from './common';\n\n/**\n * Handle the action for your plugin.\n * @param {TinyMCE.editor} editor The tinyMCE editor instance.\n */\nconst handleAction = (editor) => {\n    // TODO Handle the action.\n    window.console.log(editor);\n};\n\nexport const getSetup = async() => {\n    const [\n        startdemoButtonNameTitle,\n        startdemoMenuItemNameTitle,\n        buttonImage,\n    ] = await Promise.all([\n        getString('button_startdemo', component),\n        getString('menuitem_startdemo', component),\n        getButtonImage('icon', component),\n    ]);\n\n    return (editor) => {\n        // Register the Moodle SVG as an icon suitable for use as a TinyMCE toolbar button.\n        editor.ui.registry.addIcon(icon, buttonImage.html);\n\n        // Register the startdemo Toolbar Button.\n        editor.ui.registry.addButton(startdemoButtonName, {\n            icon,\n            tooltip: startdemoButtonNameTitle,\n            onAction: () => handleAction(editor),\n        });\n\n        // Add the startdemo Menu Item.\n        // This allows it to be added to a standard menu, or a context menu.\n        editor.ui.registry.addMenuItem(startdemoMenuItemName, {\n            icon,\n            text: startdemoMenuItemNameTitle,\n            onAction: () => handleAction(editor),\n        });\n    };\n};\n"})})]}),"\n",(0,t.jsxs)(n.admonition,{title:"A note about synchronicity",type:"important",children:[(0,t.jsxs)(n.p,{children:["The TinyMCE ",(0,t.jsx)(n.code,{children:"PluginManager.add"})," function requires all code to be called synchronously - that is to say that all Promises must be resolved before it is called."]}),(0,t.jsxs)(n.p,{children:["See more information on the Editor instance in the ",(0,t.jsx)(n.a,{href:"https://www.tiny.cloud/docs/tinymce/6/apis/tinymce.editor/",children:"tinymce.Editor"})," API documentation."]})]}),"\n",(0,t.jsx)(n.h4,{id:"handleactioneditor",children:(0,t.jsx)(n.code,{children:"handleAction(editor)"})}),"\n",(0,t.jsx)(n.p,{children:"The handleAction function is an example of one way in which the various buttons and menu items can handle their activation."}),"\n",(0,t.jsxs)(n.p,{children:["The action passes a reference to the ",(0,t.jsx)(n.em,{children:"instance"})," of the TinyMCE editor in the ",(0,t.jsx)(n.code,{children:"editor"})," variable."]}),"\n",(0,t.jsx)(n.p,{children:"It should be possible to interact with all required parts fo the TinyMCE API using this value."}),"\n",(0,t.jsx)(n.h4,{id:"getsetup",children:(0,t.jsx)(n.code,{children:"getSetup()"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"getSetup()"})," function in the example above is an asynchronous function which returns a synchronous function."]}),"\n",(0,t.jsx)(n.p,{children:"This is important because the TinyMCE PluginManager API requires all code to be synchronous and already exist."}),"\n",(0,t.jsx)(n.p,{children:"In this example strings are fetched fro the button and menu titles, and the icon is fetched using a Mustache Template. All of these functions return a Promise and therefore we must wait for them to resolve before returning the function which uses them."}),"\n",(0,t.jsx)(n.h4,{id:"the-curried-setup-function",children:"The curried setup function"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"getSetup()"})," function returns a new function which is called from ",(0,t.jsx)(n.code,{children:"plugin.js"})," during the instantiation of ",(0,t.jsx)(n.em,{children:"each editor instance"}),". If you have five editors on a page, then this function is called five times - once per editor instance."]}),"\n",(0,t.jsxs)(n.p,{children:["This function is passed a partially-configured ",(0,t.jsx)(n.a,{href:"https://www.tiny.cloud/docs/tinymce/6/apis/tinymce.editor/",children:"tinymce.Editor"})," instance on which it can call the registry commands to define the various buttons."]}),"\n",(0,t.jsxs)(n.h3,{id:"plugin-options---optionsjs-and-plugininfophp",children:["Plugin options - ",(0,t.jsx)(n.code,{children:"options.js"})," and ",(0,t.jsx)(n.code,{children:"plugininfo.php"})]}),"\n",(0,t.jsx)(n.p,{children:"There are often times that you will want to pass options, or values stored in Moodle's PHP API, to the JavaScript API in your plugin. TinyMCE has a detailed API to support parsing and validation of per-instance options which make this relatively easy."}),"\n",(0,t.jsx)(n.p,{children:"To help make this easier, several helpers exist."}),"\n",(0,t.jsxs)(n.p,{children:["On the PHP side of the API, the ",(0,t.jsx)(n.code,{children:"plugininfo.php"})," file can implement an optional ",(0,t.jsx)(n.code,{children:"plugin_with_configuration"})," interface and define a ",(0,t.jsx)(n.code,{children:"get_plugin_configuration_for_context"})," function:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",metastring:'title="lib/editor/tiny/plugins/example/classes/plugininfo.php"',children:"<?php\n\nnamespace tiny_example;\n\nuse context;\nuse editor_tiny\\plugin;\nuse editor_tiny\\plugin_with_configuration;\n\nclass plugininfo extends plugin implements plugin_with_configuration {\n    public static function get_plugin_configuration_for_context(\n        context $context,\n        array $options,\n        array $fpoptions,\n        ?\\editor_tiny\\editor $editor = null\n    ): array {\n        return [\n            // Your values go here.\n            // These will be mapped to a namespaced EditorOption in Tiny.\n            'myFirstProperty' => 'TODO Calculate your values here',\n        ];\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The values passed in may come from location including as site configuration values (that is ",(0,t.jsx)(n.code,{children:"get_config()"}),"), values based on capabilities, or values based on the ",(0,t.jsx)(n.code,{children:"$options"})," passed in."]}),"\n",(0,t.jsxs)(n.p,{children:["On the JavaScript side of the API, an ",(0,t.jsx)(n.code,{children:"options.js"})," file is used to handle parsing, validation, and fetching of the values."]}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:"A complete example of the options.js implementation"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="lib/editor/tiny/plugins/example/amd/src/options.js"',children:"import {getPluginOptionName} from 'editor_tiny/options';\nimport {pluginName} from './common';\n\n// Helper variables for the option names.\nconst myFirstPropertyName = getPluginOptionName(pluginName, 'myFirstProperty');\n\n/**\n * Options registration function.\n *\n * @param {tinyMCE} editor\n */\nexport const register = (editor) => {\n    const registerOption = editor.options.register;\n\n    // For each option, register it with the editor.\n    // Valid type are defined in https://www.tiny.cloud/docs/tinymce/6/apis/tinymce.editoroptions/\n    registerOption(myFirstPropertyName, {\n        processor: 'number',\n    });\n};\n\n/**\n * Fetch the myFirstProperty value for this editor instance.\n *\n * @param {tinyMCE} editor The editor instance to fetch the value for\n * @returns {object} The value of the myFirstProperty option\n */\nexport const getMyFirstProperty = (editor) => editor.options.get(myFirstPropertyName);\n"})})]}),"\n",(0,t.jsxs)(n.p,{children:["After being passed from the PHP API, the Moodle integration names properties according to the plugin from which they originate. In order to fetch the value out, you must use the ",(0,t.jsx)(n.code,{children:"getPluginOptionName()"})," function to translate this value."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="Getting the namespaced option name"',children:"const myFirstPropertyName = getPluginOptionName(pluginName, 'myFirstProperty');\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Before being set, or fetched back out, each property must be registered with the TinyMCE API. This is done for each ",(0,t.jsx)(n.em,{children:"instance"})," of the editor:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="Registering the option"',children:"export const register = (editor) => {\n    const registerOption = editor.options.register;\n\n    // For each option, register it with the editor.\n    // Valid type are defined in https://www.tiny.cloud/docs/tinymce/6/apis/tinymce.editoroptions/\n    registerOption(myFirstPropertyName, {\n        processor: 'string',\n    });\n};\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["See the ",(0,t.jsx)(n.a,{href:"https://www.tiny.cloud/docs/tinymce/6/apis/tinymce.editoroptions/",children:"tinymce.EditorOptions"})," API documentation for further details on the ",(0,t.jsx)(n.code,{children:"register"})," method."]})}),"\n",(0,t.jsx)(n.p,{children:"Finally, it is recommended that you then create helpers to fetch the values back out."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="Retrieving the stored value"',children:"export const getMyFirstProperty = (editor) => editor.options.get(myFirstPropertyName);\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["Editor options are specific to an ",(0,t.jsx)(n.em,{children:"instance"})," of the editor, therefore the ",(0,t.jsx)(n.code,{children:"editor"})," must be passed as an argument."]})}),"\n",(0,t.jsx)(n.p,{children:"You may have multiple helpers, for example you may have a helper to process the value and return a boolean state of the value."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="Processing an option"',children:"export const hasMyFirstProperty = (editor) => editor.options.isSet(myFirstPropertyName);\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"editor-configuration---configurationjs",children:["Editor configuration - ",(0,t.jsx)(n.code,{children:"configuration.js"})]}),"\n",(0,t.jsx)(n.p,{children:"The TinyMCE Editor only allows for very minimal configuration by administrators. This is a deliberate decision made to reduce the complexity of the User Interface, and to encourage consistency."}),"\n",(0,t.jsx)(n.p,{children:"To support this, for a plugin to place commands (that is buttons, and menu items) in the User Interface, they must modify the TinyMCE configuration."}),"\n",(0,t.jsxs)(n.p,{children:["The TinyMCE ",(0,t.jsx)(n.a,{href:"https://www.tiny.cloud/docs/tinymce/6/menus-configuration-options/#menu",children:"Menus"})," and ",(0,t.jsx)(n.a,{href:"https://www.tiny.cloud/docs/tinymce/6/toolbar-configuration-options/",children:"Toolbar"})," configuration describes the expected format of this configuration."]}),"\n",(0,t.jsxs)(n.p,{children:["In order to make your configuration changes you must create a ",(0,t.jsx)(n.code,{children:"Configuration"})," object, which contains a ",(0,t.jsx)(n.code,{children:"configure()"})," function. This value should be resolved at the end of your ",(0,t.jsx)(n.code,{children:"plugin.js"})," file, for example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="Defining a Configuration"',children:"import * as Configuration from './configuration';\n\nexport default new Promise(async(resolve) => {\n    // ... Plugin code goes here.\n\n    resolve([pluginName, Configuration]);\n})\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The Moodle TinyMCE Integration will call ",(0,t.jsx)(n.code,{children:"Configuration.configure"})," after the initial editor configuration has been put in place."]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"configure"})," function is passed the current configuration and must return an object which is merged into the configuration."]}),"\n",(0,t.jsxs)(n.p,{children:["For example, to add an item to the 'content' toolbar region, you would define your ",(0,t.jsx)(n.code,{children:"configure"})," function return an Object containing the ",(0,t.jsx)(n.code,{children:"toolbar"})," key:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="configuration.js"',children:"export const configure = (instanceConfig) => {\n    return {\n        toolbar: addToolbarButtons(instanceConfig.toolbar, 'content', buttonName),\n    };\n};\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This is used to replace any matching keys in the existing ",(0,t.jsx)(n.code,{children:"instanceConfig"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["The above example makes use of a helper from the ",(0,t.jsx)(n.code,{children:"editor_tiny/utils"})," module, which contains a number of useful helpers."]})}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:"A complete example of configuring a menu and toolbar for tiny_example"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="configuration.js"',children:"\nimport {\n    startdemoButtonName,\n    startdemoMenuItemName,\n} from './common';\n\nimport {\n    addMenubarItem,\n    addToolbarButtons,\n} from 'editor_tiny/utils';\n\nconst getToolbarConfiguration = (instanceConfig) => {\n    let toolbar = instanceConfig.toolbar;\n    toolbar = addToolbarButtons(toolbar, 'content', [\n        startdemoButtonName,\n    ]);\n\n    return toolbar;\n};\n\nconst getMenuConfiguration = (instanceConfig) => {\n    let menu = instanceConfig.menu;\n    menu = addMenubarItem(menu, 'file', [\n        startdemoMenuItemName,\n    ].join(' '));\n\n    return menu;\n};\n\nexport const configure = (instanceConfig) => {\n    return {\n        toolbar: getToolbarConfiguration(instanceConfig),\n        menu: getMenuConfiguration(instanceConfig),\n    };\n};\n"})})]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}}}]);