"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[66338],{55929:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>s,default:()=>g,frontMatter:()=>i,metadata:()=>r,toc:()=>d});var o=t(74848),l=t(28453),a=t(78924);const i={title:"Groups Selector",tags:["Moodle App"]},s=void 0,r={id:"app/development/plugins-development-guide/examples/groups-selector",title:"Groups Selector",description:"If you have an activity that uses groups, you may want to implement a group selector to filter the rendered content. There are many ways to achieve this, and we're going to outline some of them in this example.",source:"@site/general/app/development/plugins-development-guide/examples/groups-selector.md",sourceDirName:"app/development/plugins-development-guide/examples",slug:"/app/development/plugins-development-guide/examples/groups-selector",permalink:"/moodledevdocs/general/app/development/plugins-development-guide/examples/groups-selector",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/general/app/development/plugins-development-guide/examples/groups-selector.md",tags:[{label:"Moodle App",permalink:"/moodledevdocs/general/tags/moodle-app"}],version:"current",lastUpdatedBy:"Noel De Martin",lastUpdatedAt:1715004871e3,frontMatter:{title:"Groups Selector",tags:["Moodle App"]},sidebar:"moodleapp",previous:{title:"Forms",permalink:"/moodledevdocs/general/app/development/plugins-development-guide/examples/forms"},next:{title:"Link Handlers",permalink:"/moodledevdocs/general/app/development/plugins-development-guide/examples/link-handlers"}},p={},d=[{value:"Using Angular",id:"using-angular",level:2},{value:"Loading new content",id:"loading-new-content",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.A,{frontMatter:i,metadata:r}),"\n",(0,o.jsx)(n.p,{children:"If you have an activity that uses groups, you may want to implement a group selector to filter the rendered content. There are many ways to achieve this, and we're going to outline some of them in this example."}),"\n",(0,o.jsxs)(n.p,{children:["However, before looking at the solutions, we're going to simplify the use-case. Normally, you'd use functions like ",(0,o.jsx)(n.code,{children:"groups_get_activity_allowed_groups"})," to get the list of groups; and filter content according to each group's permissions. But in this example, we're going to rely on a ",(0,o.jsx)(n.code,{children:"$groups"})," variable containing a list of items for each group:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"$groups = [\n    [\n        'name' => 'One',\n        'items' => [\n            ['name' => '1.1'],\n            ['name' => '1.2'],\n        ],\n    ],\n    [\n        'name' => 'Two',\n        'items' => [\n            ['name' => '2.1'],\n            ['name' => '2.2'],\n            ['name' => '2.3'],\n        ],\n    ],\n];\n"})}),"\n",(0,o.jsx)(n.p,{children:"The UI we're going to implement will show a groups selector with the list of items below. With this, you should learn the intricacies of App development without getting into the weeds of group management."}),"\n",(0,o.jsx)(n.h2,{id:"using-angular",children:"Using Angular"}),"\n",(0,o.jsxs)(n.p,{children:["One approach is to send all the relevant data through ",(0,o.jsx)(n.code,{children:"otherdata"}),", and filter the content using Angular:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",metastring:'title="Content response"',children:"return [\n    'templates' => [\n        [\n            'id' => 'main',\n            'html' => $OUTPUT->render_from_template('local_sample/groups', []),\n        ],\n    ],\n    'otherdata' => [\n        'groups' => json_encode($groups),\n        'selectedGroup' => 0,\n    ],\n];\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-html",metastring:'ng2 title="Template"',children:'{{=<% %>=}}\n<ion-list>\n    <ion-item>\n        <ion-select label="Group" [(ngModel)]="CONTENT_OTHERDATA.selectedGroup">\n            <ion-select-option\n                *ngFor="let group of CONTENT_OTHERDATA.groups; index as index"\n                [value]="index"\n            >\n                {{ group.name }}\n            </ion-select-option>\n        </ion-select>\n    </ion-item>\n    <ion-item *ngFor="let item of CONTENT_OTHERDATA.groups[CONTENT_OTHERDATA.selectedGroup].items">\n        <ion-label>{{ item.name }}</ion-label>\n    </ion-item>\n</ion-list>\n'})}),"\n",(0,o.jsx)(n.p,{children:"One advantage of this approach is that it can work completely offline, once the template has been downloaded it can be cached and the selector will work without requesting new information. However, it will require performing a PTR (Pull-To-Refresh) to get the latest information."}),"\n",(0,o.jsx)(n.h2,{id:"loading-new-content",children:"Loading new content"}),"\n",(0,o.jsxs)(n.p,{children:["If we want to render new content every time the selector is changed, we can take advantage of the ",(0,o.jsx)(n.a,{href:"/moodledevdocs/general/app/development/plugins-development-guide/api-reference#functions",children:"functions available in templates"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",metastring:'title="Content response"',children:"$group = $args['group'] ?? 'One';\n$groupnames = array_map(fn ($group) => $group['name'], $groups);\n$selectedgroup = array_search($group, $groupnames) || 0;\n\nreturn [\n    'templates' => [\n        [\n            'id' => 'main',\n            'html' => $OUTPUT->render_from_template('local_sample/groups', [\n                'groups' => $groups,\n                'selectedgroup' => $groups[$selectedgroup],\n            ]),\n        ],\n    ],\n];\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-html",metastring:'ng2 title="Template"',children:'{{=<% %>=}}\n<ion-list>\n    <ion-item>\n        <ion-select\n            label="Group"\n            (ionChange)="updateContent({ group: $event.target.value })"\n            value="<% selectedgroup.name %>"\n        >\n            <%# groups %>\n                <ion-select-option value="<% name %>">\n                    <% name %>\n                </ion-select-option>\n            <%/ groups %>\n        </ion-select>\n    </ion-item>\n    <%# selectedgroup.items %>\n        <ion-item>\n            <ion-label><% name %></ion-label>\n        </ion-item>\n    <%/ selectedgroup.items %>\n</ion-list>\n'})}),"\n",(0,o.jsxs)(n.p,{children:["In this case, we're only sending the rendered UI and all the filtering happens in the server. Using the ",(0,o.jsx)(n.code,{children:"ionChange"})," listener, we can call the ",(0,o.jsx)(n.code,{children:"updateContent"})," function to reload the content with a different group selected. We got the value of the selected option using the special ",(0,o.jsx)(n.code,{children:"$event"})," variable that references the change event."]}),"\n",(0,o.jsxs)(n.p,{children:["Also, make sure to set the ",(0,o.jsx)(n.code,{children:"value"})," attribute in the ",(0,o.jsx)(n.code,{children:"ion-select"})," element, so that the initial group is the correct one."]})]})}function g(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);