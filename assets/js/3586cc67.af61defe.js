"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[57018],{59805:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>d,toc:()=>m});var t=s(74848),i=s(28453),r=s(78924);const a={title:"Time API",tags:["API","Time"]},o=void 0,d={id:"apis/subsystems/time/index",title:"Time API",description:"Internally Moodle always stores all times in unixtime format (number of seconds since epoch) which is independent of timezones.",source:"@site/docs/apis/subsystems/time/index.md",sourceDirName:"apis/subsystems/time",slug:"/apis/subsystems/time/",permalink:"/moodledevdocs/docs/4.4/apis/subsystems/time/",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/docs/apis/subsystems/time/index.md",tags:[{label:"API",permalink:"/moodledevdocs/docs/4.4/tags/api"},{label:"Time",permalink:"/moodledevdocs/docs/4.4/tags/time"}],version:"current",lastUpdatedBy:"Mathew May",lastUpdatedAt:1657082217e3,frontMatter:{title:"Time API",tags:["API","Time"]},sidebar:"docs",previous:{title:"Scheduled tasks",permalink:"/moodledevdocs/docs/4.4/apis/subsystems/task/scheduled"},next:{title:"xAPI (Experience API)",permalink:"/moodledevdocs/docs/4.4/apis/subsystems/xapi/"}},l={},m=[{value:"Functions",id:"functions",level:2},{value:"Glossary",id:"glossary",level:2},{value:"Timezone",id:"timezone",level:3},{value:"Location",id:"location",level:3},{value:"DST",id:"dst",level:3},{value:"Examples",id:"examples",level:2},{value:"Create DateTime with date/time from a unixtime (number of seconds)",id:"create-datetime-with-datetime-from-a-unixtime-number-of-seconds",level:3},{value:"Time API&#39;s for current user",id:"time-apis-for-current-user",level:3},{value:"System Time API",id:"system-time-api",level:3},{value:"See also",id:"see-also",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.A,{frontMatter:a,metadata:d}),"\n",(0,t.jsx)(n.p,{children:"Internally Moodle always stores all times in unixtime format (number of seconds since epoch) which is independent of timezones."}),"\n",(0,t.jsx)(n.p,{children:"The Time API is used to display proper date-time depending on user or site timezones."}),"\n",(0,t.jsx)(n.h2,{id:"functions",children:"Functions"}),"\n",(0,t.jsx)(n.p,{children:"There is a class in Moodle to handle most needs of working with times. There are 2 cases to consider when working with time:"}),"\n",(0,t.jsx)(n.p,{children:"System Time"}),"\n",(0,t.jsx)(n.p,{children:"This is when you are dealing with dates on the server e.g. executing scheduled tasks, performing background tasks - anything which does not depend on the timezone of any specific user."}),"\n",(0,t.jsx)(n.p,{children:"User Time"}),"\n",(0,t.jsx)(n.p,{children:"This is when you are manipulating dates and times and you need to display them to the user in their current timezone (which may be different for each user)."}),"\n",(0,t.jsx)(n.p,{children:'The main API for time is in the class "core_date" which will give you php DateTimeZone objects for either user time or server time as needed. You can then use the php datetime classes to manipulate the time. When finished manipulating the time, get a timestamp with DateTime::getTimestamp().'}),"\n",(0,t.jsx)(n.p,{children:"Example: Get the current server time + 1 day."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'$tomorrow = new DateTime("1 day", core_date::get_server_timezone_object());\n'})}),"\n",(0,t.jsx)(n.p,{children:"Get a timestamp for storing in the database:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$tomorrowint = $tomorrow->getTimestamp();\n"})}),"\n",(0,t.jsx)(n.p,{children:"Get a timestamp for 3pm tomorrow in the current users timezone."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'$time = new DateTime("now", core_date::get_user_timezone_object());\n$time->add(new DateInterval("P1D"));\n$time->setTime(15, 0, 0);\n\n$timestamp = $time->getTimestamp();\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"danger",children:(0,t.jsx)(n.p,{children:"Never add or subtract timestamps for any reason - you will get it wrong (DST is a killer)!"})}),"\n",(0,t.jsx)(n.p,{children:"Other functions related to time api can be found in lib/moodlelib.php."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Time API's for current user","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"make_timestamp"})," - Given date-time, it produces a GMT timestamp for current user."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"userdate"})," - Gets formatted string that represents a date in user time (note that the format required by this function is the ",(0,t.jsx)(n.a,{href:"https://www.php.net/manual/en/function.strftime.php",children:"strftime()"})," format, not the more common format used by date())"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"usertime"})," - Given a GMT timestamp (seconds since epoch), offsets it by the timezone.  eg 3pm in India is 3pm GMT - 5.5 * 3600 seconds"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"usergetdate"})," - Given a timestamp in GMT, returns an array that represents the date-time in user time"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"usergetmidnight"})," - Given a date, return the GMT timestamp of the most recent midnight for the current user."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"usertimezone"})," - Returns current user's timezone"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["System Time API","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"format_time"})," - Format a date/time (seconds) as weeks, days, hours etc as needed"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"dst_offset_on"})," - Calculates the Daylight Saving Offset for a given date/time (timestamp)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"find_day_in_month"})," - Calculates when the day appears in specific month"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"days_in_month"})," - Calculate number of days in a given month"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"dayofweek"})," - Calculate the position in the week of a specific calendar day"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Older legacy date/time functions. Do not use in new code.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"usertime"})," - Appends the users timezone offset to an integer timestamp"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"get_timezone_offset"})," - Systems's timezone difference from GMT in seconds"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"get_user_timezone_offset"})," - Returns user's timezone difference from GMT in hours"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"dst_changes_for_year"})," -  Calculates the required DST change and returns a Timestamp Array"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"glossary",children:"Glossary"}),"\n",(0,t.jsx)(n.h3,{id:"timezone",children:"Timezone"}),"\n",(0,t.jsx)(n.p,{children:"Moodle supports following timezone formats:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"UTC (specifically UTC\u221211 to UTC+11)"}),"\n",(0,t.jsx)(n.li,{children:"Time offsets from UTC (int +-(0-13) or float +-(0.5-12.5))"}),"\n",(0,t.jsx)(n.li,{children:"World timezones (Australia/Perth)"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"location",children:"Location"}),"\n",(0,t.jsxs)(n.p,{children:["Timezone depends on ",(0,t.jsx)(n.a,{href:"https://docs.moodle.org/en/Location",children:"Location"})," of the user and can be forced upon by administrator."]}),"\n",(0,t.jsx)(n.h3,{id:"dst",children:"DST"}),"\n",(0,t.jsxs)(n.p,{children:["DST is abbreviation of ",(0,t.jsx)(n.strong,{children:"Daylight Saving Time"}),' (also known as "Day light saving" and "Summer Time"). Many countries, and sometimes just certain regions of countries, adopt daylight saving time during part of the year. Moodle automatically calculates DST for current user, depending on user location.']}),"\n",(0,t.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(n.h3,{id:"create-datetime-with-datetime-from-a-unixtime-number-of-seconds",children:"Create DateTime with date/time from a unixtime (number of seconds)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$date = new DateTime();\n$date->setTimestamp(intval($unixtime);\necho userdate($date->getTimestamp());\n"})}),"\n",(0,t.jsx)(n.h3,{id:"time-apis-for-current-user",children:"Time API's for current user"}),"\n",(0,t.jsx)(n.p,{children:"Prints the current date and time in the user's timezone:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$now = time();\necho userdate($now);\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To manually specify the display format, use one of the formatting strings defined in the ",(0,t.jsx)("tt",{children:"core_langconfig"})," component of the user's language. For example, to display just the date without the time, use:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"echo userdate(time(), get_string('strftimedaydate', 'core_langconfig'));\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You can also use the ",(0,t.jsx)("tt",{children:"DateTime"})," class to obtain the timestamp:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$date = new DateTime(\"tomorrow\", core_date::get_user_timezone_object());\n$date->setTime(0, 0, 0);\necho userdate($date->getTimestamp(), get_string('strftimedatefullshort', 'core_langconfig'));\n"})}),"\n",(0,t.jsx)(n.h3,{id:"system-time-api",children:"System Time API"}),"\n",(0,t.jsx)(n.p,{children:"Find the day of the week for the first day in this month."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$now = new DateTime(\"now\", core_date::get_server_timezone_object());\n\n$year = $now->format('Y');\n$month = $now->format('m');\n\n$now->setDate($year, $month, 1);\n$dayofweek = $now->format('N');\necho $dayofweek;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"see-also",children:"See also"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.php.net/manual/en/class.datetime",children:"Php DateTime class"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/moodledevdocs/docs/4.4/apis",children:"Core APIs"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);