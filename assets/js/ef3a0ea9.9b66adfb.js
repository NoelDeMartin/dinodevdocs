"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[17053],{75644:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>x,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var t=s(74848),r=s(28453),l=s(78924);const i={title:"Moodle 4.2 developer update",tags:["Core development","Moodle 4.2"]},d=void 0,o={id:"devupdate",title:"Moodle 4.2 developer update",description:"This page highlights the important changes that are coming in Moodle 4.2 for developers.",source:"@site/versioned_docs/version-4.2/devupdate.md",sourceDirName:".",slug:"/devupdate",permalink:"/moodledevdocs/docs/4.2/devupdate",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/versioned_docs/version-4.2/devupdate.md",tags:[{label:"Core development",permalink:"/moodledevdocs/docs/4.2/tags/core-development"},{label:"Moodle 4.2",permalink:"/moodledevdocs/docs/4.2/tags/moodle-4-2"}],version:"4.2",lastUpdatedBy:"Andrew Nicols",lastUpdatedAt:1713332374e3,frontMatter:{title:"Moodle 4.2 developer update",tags:["Core development","Moodle 4.2"]},sidebar:"docs",previous:{title:"xAPI (Experience API)",permalink:"/moodledevdocs/docs/4.2/apis/subsystems/xapi/"}},a={},c=[{value:"External API",id:"external-api",level:2},{value:"Delayed deprecation",id:"delayed-deprecation",level:3},{value:"Renamed External API classes",id:"renamed-external-api-classes",level:3},{value:"Renamed External API functions",id:"renamed-external-api-functions",level:3},{value:"Validation of <code>$required</code> parameter",id:"validation-of-required-parameter",level:3},{value:"Quiz activity",id:"quiz-activity",level:2},{value:"Developer tip - handling changes to base class names, while supporting multiple Moodle versions",id:"developer-tip---handling-changes-to-base-class-names-while-supporting-multiple-moodle-versions",level:3},{value:"Font Awesome 6",id:"font-awesome-6",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components},{CodeExample:s,InvalidExample:d,ValidExample:a}=n;return s||p("CodeExample",!0),d||p("InvalidExample",!0),a||p("ValidExample",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.A,{frontMatter:i,metadata:o}),"\n",(0,t.jsx)(n.p,{children:"This page highlights the important changes that are coming in Moodle 4.2 for developers."}),"\n",(0,t.jsx)(n.h2,{id:"external-api",children:"External API"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"external_api"})," class, and all related classes have been moved from ",(0,t.jsx)(n.code,{children:"lib/externallib.php"})," to namespaced classes within the ",(0,t.jsxs)(n.a,{href:"/moodledevdocs/docs/4.2/apis/subsystems/external/",children:[(0,t.jsx)(n.code,{children:"core_external"})," subsystem"]}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"delayed-deprecation",children:"Delayed deprecation"}),"\n",(0,t.jsxs)(n.p,{children:["The old class locations have been aliased for backwards compatibility and will emit a deprecation notice in a ",(0,t.jsx)(n.em,{children:"future"})," release. Please remember to add ",(0,t.jsx)(n.code,{children:"require_once($CFG->dirroot . '/lib/externallib.php');"})," to your external service classes to make the aliases work."]}),"\n",(0,t.jsx)(n.p,{children:"If you are writing a Moodle plugin which has a single codebase shared with older versions of Moodle, you should continue to use the old API locations at this time."}),"\n",(0,t.jsxs)(n.admonition,{type:"important",children:[(0,t.jsxs)(n.mdxAdmonitionTitle,{children:["Important now about requiring ",(0,t.jsx)(n.code,{children:"lib/externallib.php"})]}),(0,t.jsxs)(n.p,{children:["If you are making use of the delayed deprecation, please note that you ",(0,t.jsx)(n.strong,{children:"must"})," call the following ",(0,t.jsx)(n.strong,{children:"in the class file of your method definitions"}),":"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",metastring:'title="mod/example/classes/external/get_example.php"',children:"<?php\n\nnamespace mod_example\\external;\n\nrequire_once($CFG->dirroot . '/lib/externallib.php');\n\nclass get_example {\n    // ...\n}\n"})}),(0,t.jsxs)(n.p,{children:["You ",(0,t.jsx)(n.strong,{children:"must not"})," include the legacy ",(0,t.jsx)(n.code,{children:"lib/externallib.php"})," file anywhere else."]}),(0,t.jsxs)(n.p,{children:["You ",(0,t.jsx)(n.strong,{children:"must"})," also use either the ",(0,t.jsx)(n.a,{href:"https://docs.phpunit.de/en/9.6/annotations.html#runtestsinseparateprocesses",children:(0,t.jsx)(n.code,{children:"@runTestsInSeparateProcesses"})})," or the ",(0,t.jsx)(n.a,{href:"https://docs.phpunit.de/en/9.6/annotations.html#runinseparateprocess",children:(0,t.jsx)(n.code,{children:"@runInSeparateProcess"})})," annotations in any unit test related to the external API methods."]})]}),"\n",(0,t.jsxs)(n.p,{children:["The following parts of the external API have been moved to the ",(0,t.jsx)(n.code,{children:"core_external"})," subsystem."]}),"\n",(0,t.jsx)(n.h3,{id:"renamed-external-api-classes",children:"Renamed External API classes"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Old class name"}),(0,t.jsx)(n.th,{children:"New class name"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_api"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\external_api"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_description"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\external_description"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_files"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\files"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_format_value"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\external_format_value"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_function_parameters"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\external_function_parameters"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_multiple_structure"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\external_multiple_structure"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_settings"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\external_settings"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_single_structure"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\external_single_structure"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_util"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\util"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_value"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\external_value"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_warnings"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\external_warnings"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"restricted_context_exception"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\restricted_context_exception"})})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"renamed-external-api-functions",children:"Renamed External API functions"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Old function name"}),(0,t.jsx)(n.th,{children:"New function name"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_format_string()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\util::format_string()"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_format_text()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\util::format_text()"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_create_service_token()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\util::generate_token()"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_generate_token()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\util::generate_token()"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_generate_token_for_current_user()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\util::generate_token_for_current_user()"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"external_log_token_request()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"core_external\\util::log_token_request()"})})]})]})]}),"\n",(0,t.jsxs)(n.h3,{id:"validation-of-required-parameter",children:["Validation of ",(0,t.jsx)(n.code,{children:"$required"})," parameter"]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"$required"})," parameter in ",(0,t.jsx)(n.code,{children:"\\core_external\\external_description"})," is now being validated. This is in order to prevent accidentally passing incorrect parameters to the ",(0,t.jsx)(n.code,{children:"external_description"}),"'s and its subclasses' constructors."]}),"\n",(0,t.jsxs)(d,{children:[(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"'contentformat' => new external_format_value('content', 'Content format'),\n"})}),(0,t.jsxs)(n.p,{children:["In this example, the field description has been accidentally passed for the ",(0,t.jsx)(n.code,{children:"$required"})," parameter in ",(0,t.jsx)(n.code,{children:"external_format_value"}),"'s constructor. A debugging notice will be shown about the value ",(0,t.jsx)(n.code,{children:"Content format"})," as an invalid value for the ",(0,t.jsx)(n.code,{children:"$required"})," parameter."]})]}),"\n",(0,t.jsxs)(a,{children:[(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"'contentformat' => new external_format_value('content', VALUE_REQUIRED, 'Content format'),\n"})}),(0,t.jsxs)(n.p,{children:["The value for the ",(0,t.jsx)(n.code,{children:"$required"})," parameter must either be set to either one of the ",(0,t.jsx)(n.code,{children:"VALUE_DEFAULT"}),", ",(0,t.jsx)(n.code,{children:"VALUE_REQUIRED"}),", or ",(0,t.jsx)(n.code,{children:"VALUE_OPTIONAL"})," constants."]})]}),"\n",(0,t.jsx)(n.h2,{id:"quiz-activity",children:"Quiz activity"}),"\n",(0,t.jsxs)(n.p,{children:["At the moment, this is just a placeholder to say that there are significant changes in the Quiz activity (",(0,t.jsx)(n.code,{children:"mod_quiz"}),") in Moodle 4.2.\nA lot of the quiz code is being updated to modern Moodle coding standards while we add features in Epic ",(0,t.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-74607",children:"MDL-74607"}),".\nTherefore, if you have made customisations to the core quiz code, you will have work to do, and if you have made quiz sub-plugins\n(reports or access rules) you may have a small amount of work to do."]}),"\n",(0,t.jsxs)(n.p,{children:["I will write a more coherent summary once the changes are complete, but\n",(0,t.jsx)(n.a,{href:"https://github.com/moodle/moodle/blob/master/mod/quiz/upgrade.txt",children:"mod/quiz/upgrade.txt"})," lists all the changes so far."]}),"\n",(0,t.jsx)(n.h3,{id:"developer-tip---handling-changes-to-base-class-names-while-supporting-multiple-moodle-versions",children:"Developer tip - handling changes to base class names, while supporting multiple Moodle versions"}),"\n",(0,t.jsx)(n.p,{children:"Thanks to Luca B\xf6sch for working this out. If you want a single version of your plugin to support multiple version of Moodle\nwithout developer debug warnings, you can do it like this:"}),"\n",(0,t.jsx)(s,{type:"warning",title:"Work-around to support multiple base class names",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"\n// This work-around is required until Moodle 4.2 is the lowest version we support.\nif (class_exists('quiz_default_report')) {\n    class_alias('quiz_default_report', 'quiz_archive_parent_class_alias');\n} else {\n    class_alias('mod_quiz\\local\\reports\\report_base', 'quiz_archive_parent_class_alias');\n}\n\nclass quiz_archive_report extends quiz_archive_parent_class_alias {\n    // Contents of your class unchanged.\n}\n"})})}),"\n",(0,t.jsxs)(n.p,{children:["There is a slightly messier real example of updating a quiz access rule sub-plugin here: ",(0,t.jsx)(n.a,{href:"https://github.com/moodleou/moodle-quizaccess_honestycheck/commit/a2f38f6587ff57ebef7b56191c216e2ffe309e87",children:"https://github.com/moodleou/moodle-quizaccess_honestycheck/commit/a2f38f6587ff57ebef7b56191c216e2ffe309e87"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"font-awesome-6",children:"Font Awesome 6"}),"\n",(0,t.jsxs)(n.p,{children:["The Font Awesome third-party library has been upgraded from 4.7 to 6.3.0 in ",(0,t.jsx)(n.a,{href:"https://tracker.moodle.org/browse/MDL-76989",children:"MDL-76989"}),". The syntax has slightly changed. The free version included in Moodle only supports the solid and regular styles:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-css",metastring:'title="Version 4\'s syntax"',children:'<i class="fa fa-star"></i>\n<i class="fa fa-star-o"></i>\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-css",metastring:'title="Version 6\'s syntax"',children:'<i class="fa-regular fa-star"></i>\n<i class="fa-solid fa-star"></i>\n'})}),"\n",(0,t.jsx)(n.p,{children:"Font Awesome 6 is backwards compatible (because a shim has been included too), so the old syntax still works."}),"\n",(0,t.jsx)(n.p,{children:"In the SCSS/CSS files some changes needs to be done to display the icons properly:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The attribute ",(0,t.jsx)(n.code,{children:"content: $fa-var-xxx"})," needs to be converted to ",(0,t.jsx)(n.code,{children:"content: fa-content($fa-var-xxx)"})]}),"\n",(0,t.jsxs)(n.li,{children:["The regular style is used by default. When the solid styled icon needs to be used, the following must be added: ",(0,t.jsx)(n.code,{children:"@extend .fa-solid"}),". There are other ways to achieve the same. More information can be found in ",(0,t.jsx)(n.a,{href:"https://fontawesome.com/v6/docs/web/use-with/scss#a-more-manual-custom-css-approach",children:"this page"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"@include fa-icons()"})," is not required anymore (when it's used, the icons are not displayed properly)."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["More information about the changes between 4 and 6, including any icons which have been renamed, can be found in ",(0,t.jsx)(n.a,{href:"https://fontawesome.com/docs/web/setup/upgrade/upgrade-from-v4",children:"https://fontawesome.com/docs/web/setup/upgrade/upgrade-from-v4"})]})]})}function x(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}function p(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}}}]);