"use strict";(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[37052],{57469:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>p});var i=t(74848),s=t(28453),o=t(78924);const l={title:"Link Handlers",tags:["Moodle App"]},a=void 0,r={id:"app/development/plugins-development-guide/examples/link-handlers",title:"Link Handlers",description:"You can create a link handler to intercept what happens when links are clicked using the CoreContentLinksDelegate.",source:"@site/general/app/development/plugins-development-guide/examples/link-handlers.md",sourceDirName:"app/development/plugins-development-guide/examples",slug:"/app/development/plugins-development-guide/examples/link-handlers",permalink:"/moodledevdocs/general/app/development/plugins-development-guide/examples/link-handlers",draft:!1,unlisted:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/general/app/development/plugins-development-guide/examples/link-handlers.md",tags:[{label:"Moodle App",permalink:"/moodledevdocs/general/tags/moodle-app"}],version:"current",lastUpdatedBy:"Noel De Martin",lastUpdatedAt:1715004871e3,frontMatter:{title:"Link Handlers",tags:["Moodle App"]},sidebar:"moodleapp",previous:{title:"Groups Selector",permalink:"/moodledevdocs/general/app/development/plugins-development-guide/examples/groups-selector"},next:{title:"Prefetch Handlers",permalink:"/moodledevdocs/general/app/development/plugins-development-guide/examples/prefetch-handlers"}},d={},p=[{value:"Using patterns",id:"using-patterns",level:2},{value:"Setting a priority",id:"setting-a-priority",level:2},{value:"Performing multiple actions",id:"performing-multiple-actions",level:2},{value:"Complex example",id:"complex-example",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.A,{frontMatter:l,metadata:r}),"\n",(0,i.jsxs)(n.p,{children:["You can create a link handler to intercept what happens when links are clicked using the ",(0,i.jsx)(n.a,{href:"/moodledevdocs/general/app/development/plugins-development-guide/api-reference#corecontentlinksdelegate",children:"CoreContentLinksDelegate"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"The Moodle app automatically creates two link handlers for module plugins, so you don't need to create them in your plugin's JavaScript code anymore:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A handler to treat links to ",(0,i.jsx)(n.code,{children:"mod/pluginname/view.php?id=X"}),". When this link is clicked, it will open your module in the app."]}),"\n",(0,i.jsxs)(n.li,{children:["A handler to treat links to ",(0,i.jsx)(n.code,{children:"mod/pluginname/index.php?id=X"}),". When this link is clicked, it will open a page in the app listing all the modules of your type inside a certain course."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"If these aren't sufficient, link handlers have some advanced features that allow you to change how links behave under different conditions."}),"\n",(0,i.jsxs)(n.p,{children:["In order to implement a custom link handler, you should register an object implementing the ",(0,i.jsx)(n.a,{href:"https://github.com/moodlehq/moodleapp/blob/main/src/core/features/contentlinks/services/contentlinks-delegate.ts#L27..L95",children:"CoreContentLinksHandler interface"})," in the delegate. You can also achieve this extending the ",(0,i.jsx)(n.a,{href:"https://github.com/moodlehq/moodleapp/blob/latest/src/core/features/contentlinks/classes/base-handler.ts",children:"CoreContentLinksHandlerBase class"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"class AddonModFooLinkHandler extends this.CoreContentLinksHandlerBase {}\n\nthis.CoreContentLinksDelegate.registerHandler(new AddonModFooLinkHandler());\n"})}),"\n",(0,i.jsx)(n.h2,{id:"using-patterns",children:"Using patterns"}),"\n",(0,i.jsx)(n.p,{children:"You'll most likely need to match only certain links. You can define a Regular Expression pattern to filter clicks:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"class AddonModFooLinkHandler extends this.CoreContentLinksHandlerBase {\n\n    constructor() {\n        super();\n\n        this.pattern = RegExp('\\/mod\\/foo\\/specialpage.php');\n    }\n\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"setting-a-priority",children:"Setting a priority"}),"\n",(0,i.jsx)(n.p,{children:"Multiple link handlers may apply to a given link. You can define the order of precedence by setting the priority; the handler with the highest priority will be used."}),"\n",(0,i.jsx)(n.p,{children:"Handlers have a priority default priority of 0, so 1 or higher will override the default:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"class AddonModFooLinkHandler extends this.CoreContentLinksHandlerBase {\n\n    constructor() {\n        super();\n\n        this.priority = 1;\n    }\n\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"performing-multiple-actions",children:"Performing multiple actions"}),"\n",(0,i.jsxs)(n.p,{children:["Once a link has been matched, the handler's ",(0,i.jsx)(n.code,{children:"getActions()"})," method determines what the link should do. This method has access to the URL and its parameters."]}),"\n",(0,i.jsx)(n.p,{children:"Different actions can be returned depending on different conditions:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"class AddonModFooLinkHandler extends this.CoreContentLinksHandlerBase {\n\n    getActions(siteIds, url, params) {\n        return [\n            {\n                action: function(siteId, navCtrl) {\n                    // The actual behaviour of the link goes here.\n                },\n                sites: [\n                    // ...\n                ],\n            },\n            {\n                // ...\n            },\n        ];\n    }\n\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Once handlers have been matched for a link, the actions will be fetched for all them and sorted by priority. The first valid action will be used to open the link."}),"\n",(0,i.jsxs)(n.p,{children:["If your handler is matched with a link, but a condition assessed in the ",(0,i.jsx)(n.code,{children:"getActions()"})," method determines that you want to skip it, you can invalidate it by setting its sites property to an empty array."]}),"\n",(0,i.jsx)(n.h2,{id:"complex-example",children:"Complex example"}),"\n",(0,i.jsxs)(n.p,{children:["This will match all URLs containing ",(0,i.jsx)(n.code,{children:"/mod/foo/"}),", and force those with an id parameter that's not in the ",(0,i.jsx)(n.code,{children:"supportedModFoos"})," array to open in the user's browser, rather than the app:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const that = this;\nconst supportedModFoos = [...];\n\nclass AddonModFooLinkHandler extends this.CoreContentLinksHandlerBase {\n\n    constructor() {\n        super();\n\n        this.pattern = new RegExp('\\/mod\\/foo\\/');\n        this.name = 'AddonModFooLinkHandler';\n        this.priority = 1;\n    }\n\n    getActions(siteIds, url, params) {\n        const action = {\n            action() {\n                that.CoreUtilsProvider.openInBrowser(url);\n            },\n        };\n\n        if (supportedModFoos.indexOf(parseInt(params.id)) !== -1) {\n            action.sites = [];\n        }\n\n        return [action];\n    }\n\n}\n\nthis.CoreContentLinksDelegate.registerHandler(new AddonModFooLinkHandler());\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);